{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/images/payway/alipay.jpg","path":"images/payway/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","path":"lib/needsharebutton/needsharebutton.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","path":"lib/needsharebutton/font-embedded.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","path":"lib/needsharebutton/needsharebutton.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/images/payway/wechatpay.jpg","path":"images/payway/wechatpay.jpg","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","path":"lib/Han/dist/font/han.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1534063472116},{"_id":"themes/next/.gitignore","hash":"0b5c2ffd41f66eb1849d6426ba8cf9649eeed329","modified":1534063472117},{"_id":"source/CNAME","hash":"40f5326962ae3d5a25304617df5afac115c66b62","modified":1539589588567},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1534063472116},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1534063472116},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1534063472117},{"_id":"themes/next/.javascript_ignore","hash":"8a224b381155f10e6eb132a4d815c5b52962a9d1","modified":1534063472117},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1534063472117},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1534063472118},{"_id":"themes/next/LICENSE","hash":"f293bcfcdc06c0b77ba13570bb8af55eb5c059fd","modified":1534063472118},{"_id":"themes/next/.travis.yml","hash":"d60d4a5375fea23d53b2156b764a99b2e56fa660","modified":1534063472118},{"_id":"themes/next/bower.json","hash":"0674f11d3d514e087a176da0e1d85c2286aa5fba","modified":1534063472119},{"_id":"themes/next/gulpfile.coffee","hash":"031bffc483e417b20e90eceb6cf358e7596d2e69","modified":1534063472119},{"_id":"themes/next/README.cn.md","hash":"2c766b3369ed477bce134a5450dab45bef161504","modified":1534063472118},{"_id":"themes/next/_config.yml","hash":"641e0fa1996fc15fcfa8b01543fa964a299bd194","modified":1541658744876},{"_id":"themes/next/README.md","hash":"8ce60ce578963eb4e1eb5e33e1efc2fc4779af9c","modified":1534063472118},{"_id":"themes/next/package.json","hash":"036d3a1346203d2f1a3958024df7f74e7ac07bfe","modified":1534063472135},{"_id":"source/_posts/dataStructure-AVL.md","hash":"3a605858b89e315006088510faa286f5bc410e67","modified":1542964885231},{"_id":"source/_posts/java-BTrace.md","hash":"217b3eb25b0ba1f871dac614f7d82003afccb529","modified":1539257467314},{"_id":"source/_posts/java-AQS-01.md","hash":"b5d7d75588ae14fb1a73459759df9e4d5fe03397","modified":1541485027838},{"_id":"source/_posts/java-ThisEscape.md","hash":"38dfc2bf6ab88527416dc8e8d2e8ccfbe0576f89","modified":1541663149430},{"_id":"source/_posts/java-IdentityHashmap.md","hash":"4cf69fc3e6697464cbf1aa633322bf2278c53ba1","modified":1539257107193},{"_id":"source/_posts/java-AQS-02.md","hash":"8db758a1e6df1395138c9fd742581dc1a289d4d2","modified":1540799636909},{"_id":"source/_posts/java-EnumMap.md","hash":"c52f442de0956ea4586b4700fc26b88d07d78b19","modified":1539257033626},{"_id":"source/_posts/java-WeakHashMap.md","hash":"e299860fc805177970bfeb644afb3c87d1d8a495","modified":1539257107196},{"_id":"source/_posts/java-ThreadLocalExecutor.md","hash":"ad88ade342beb037e8c2e303cadf0c7997a7a5ee","modified":1539255082124},{"_id":"source/_posts/java-stateMachine.md","hash":"1fb15f4f00b22928992536e26c6a2c2d95d2d954","modified":1534063472083},{"_id":"source/about/index.md","hash":"2a09ddc7b81e3081cad4f7577d371a81f0444d8f","modified":1534063472083},{"_id":"source/_posts/spring-IOC.md","hash":"160ba8a5c919f66fb480502b0c036e0806d47a51","modified":1534753770571},{"_id":"source/categories/index.md","hash":"b10826c80365903af8ad9c3a560101444789476a","modified":1534063472083},{"_id":"source/tags/index.md","hash":"77a1e4167b9d70b4bbe9b7d1409eacfc2f33b187","modified":1534063472092},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"3b5eafd32abb718e56ccf8d1cee0607ad8ce611d","modified":1534063472116},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"352093a1b210c72136687fd2eee649244cee402c","modified":1534063472116},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"902f627155a65099e0a37842ff396a58d0dc306f","modified":1534063472117},{"_id":"themes/next/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1534063472117},{"_id":"themes/next/languages/de.yml","hash":"057e7df11ddeb1c8c15a5d7c5ff29430d725ec6b","modified":1534063472119},{"_id":"themes/next/languages/default.yml","hash":"44ef3f26917f467459326c2c8be2f73e4d947f35","modified":1534063472120},{"_id":"themes/next/languages/en.yml","hash":"7e680d9bb8f3a3a9d1ba1c9d312b3d257183dded","modified":1534063472120},{"_id":"themes/next/languages/fr-FR.yml","hash":"7e4eb7011b8feee641cfb11c6e73180b0ded1c0f","modified":1534063472120},{"_id":"themes/next/languages/ja.yml","hash":"3c76e16fd19b262864475faa6854b718bc08c4d8","modified":1534063472120},{"_id":"themes/next/languages/it.yml","hash":"aa595f2bda029f73ef7bfa104b4c55c3f4e9fb4c","modified":1534063472120},{"_id":"themes/next/languages/ko.yml","hash":"ea5b46056e73ebcee121d5551627af35cbffc900","modified":1534063472120},{"_id":"themes/next/languages/id.yml","hash":"b5de1ea66dd9ef54cac9a1440eaa4e3f5fc011f5","modified":1534063472120},{"_id":"themes/next/languages/nl-NL.yml","hash":"edca4f3598857dbc3cbf19ed412213329b6edd47","modified":1534063472121},{"_id":"themes/next/languages/pt-BR.yml","hash":"b1694ae766ed90277bcc4daca4b1cfa19cdcb72b","modified":1534063472121},{"_id":"themes/next/languages/pt.yml","hash":"44b61f2d085b827b507909a0b8f8ce31c6ef5d04","modified":1534063472121},{"_id":"themes/next/languages/ru.yml","hash":"98ec6f0b7183282e11cffc7ff586ceb82400dd75","modified":1534063472121},{"_id":"themes/next/languages/vi.yml","hash":"fd08d3c8d2c62965a98ac420fdaf95e54c25d97c","modified":1534063472121},{"_id":"themes/next/languages/zh-Hans.yml","hash":"16ef56d0dea94638de7d200984c90ae56f26b4fe","modified":1534063472121},{"_id":"themes/next/languages/zh-tw.yml","hash":"50b71abb3ecc0686f9739e179e2f829cd074ecd9","modified":1534063472122},{"_id":"themes/next/languages/zh-hk.yml","hash":"9396f41ae76e4fef99b257c93c7354e661f6e0fa","modified":1534063472121},{"_id":"themes/next/layout/_layout.swig","hash":"da0929166674ea637e0ad454f85ad0d7bac4aff2","modified":1534063472122},{"_id":"themes/next/layout/archive.swig","hash":"f0a8225feafd971419837cdb4bcfec98a4a59b2f","modified":1534063472134},{"_id":"themes/next/layout/index.swig","hash":"783611349c941848a0e26ee2f1dc44dd14879bd1","modified":1534063472134},{"_id":"themes/next/layout/category.swig","hash":"4472255f4a3e3dd6d79201523a9526dcabdfbf18","modified":1534063472134},{"_id":"themes/next/layout/page.swig","hash":"969caaee05bdea725e99016eb63d810893a73e99","modified":1534063472135},{"_id":"themes/next/layout/post.swig","hash":"b3589a8e46288a10d20e41c7a5985d2493725aec","modified":1534063472135},{"_id":"themes/next/layout/schedule.swig","hash":"d86f8de4e118f8c4d778b285c140474084a271db","modified":1534063472135},{"_id":"themes/next/layout/tag.swig","hash":"7e0a7d7d832883eddb1297483ad22c184e4368de","modified":1534063472135},{"_id":"themes/next/scripts/merge-configs.js","hash":"81e86717ecfb775986b945d17f0a4ba27532ef07","modified":1534063472135},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1534063472136},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1534063472185},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1534063472185},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1534063472185},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472156},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1534063472122},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1534063472122},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"31322a7f57936cf2dc62e824af5490da5354cf02","modified":1534063472123},{"_id":"themes/next/layout/_macro/my-copyright.swig","hash":"7b2710bf55b7961dd9a39c0f6e0c847e0bd3e381","modified":1534063472123},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"665a928604f99d2ba7dc4a4a9150178229568cc6","modified":1534063472123},{"_id":"themes/next/layout/_macro/passage-end-tag.swig","hash":"f29b50d83bcdc9e70696b6a8a8917d8b2ad4be10","modified":1534063472123},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"39852700e4084ecccffa6d4669168e5cc0514c9e","modified":1534063472124},{"_id":"themes/next/layout/_macro/reward.swig","hash":"56e8d8556cf474c56ae1bef9cb7bbd26554adb07","modified":1534063472124},{"_id":"themes/next/layout/_partials/comments.swig","hash":"4a6f5b1792b2e5262b7fdab9a716b3108e2f09c7","modified":1534063472124},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"6a54c3c85ff6b19d275827a327abbf4bd99b2ebf","modified":1534063472124},{"_id":"themes/next/layout/_partials/footer.swig","hash":"5ce60c9dde042bac0c393fa37c830cf2dd29ea68","modified":1534063472124},{"_id":"themes/next/layout/_macro/post.swig","hash":"c80caed88b110640e280b70ca4503a1ddd15f7e1","modified":1534063472123},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"1efd925d34a5d4ba2dc0838d9c86ba911e705fc9","modified":1534063472125},{"_id":"themes/next/layout/_partials/header.swig","hash":"ed042be6252848058c90109236ec988e392d91d4","modified":1534063472125},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1534063472125},{"_id":"themes/next/layout/_partials/head.swig","hash":"6b94fe8f3279daea5623c49ef4bb35917ba57510","modified":1534063472124},{"_id":"themes/next/layout/_partials/search.swig","hash":"9dbd378e94abfcb3f864a5b8dbbf18d212ca2ee0","modified":1534063472125},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1534063472127},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1534063472127},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"a266f96ad06ee87bdeae6e105a4b53cd587bbd04","modified":1534063472128},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"6d25596d6a7c57700d37b607f8d9a62d89708683","modified":1534063472132},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"7c04a42319d728be356746363aff8ea247791d24","modified":1534063472132},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"5fe0447cc88a5a63b530cf0426f93c4634811876","modified":1534063472132},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1534063472132},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"fc93b1a7e6aed0dddb1f3910142b48d8ab61174e","modified":1534063472132},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1534063472133},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"1ddb2336a1a19b47af3017047012c01ec5f54529","modified":1534063472133},{"_id":"themes/next/scripts/tags/button.js","hash":"d023f10a00077f47082b0517e2ad666e6e994f60","modified":1534063472136},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1534063472136},{"_id":"themes/next/scripts/tags/exturl.js","hash":"8d7e60f60779bde050d20fd76f6fdc36fc85e06d","modified":1534063472136},{"_id":"themes/next/scripts/tags/full-image.js","hash":"8eeb3fb89540299bdbb799edfdfdac3743b50596","modified":1534063472137},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1534063472137},{"_id":"themes/next/scripts/tags/label.js","hash":"2f8f41a7316372f0d1ed6b51190dc4acd3e16fff","modified":1534063472137},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"eeeabede68cf263de9e6593ecf682f620da16f0a","modified":1534063472137},{"_id":"themes/next/scripts/tags/note.js","hash":"64de4e9d01cf3b491ffc7d53afdf148ee5ad9779","modified":1534063472137},{"_id":"themes/next/scripts/tags/tabs.js","hash":"5786545d51c38e8ca38d1bfc7dd9e946fc70a316","modified":1534063472137},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1534063472157},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1534063472156},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1534063472157},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1534063472157},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1534063472157},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1534063472157},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1534063472157},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1534063472158},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1534063472158},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1534063472158},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1534063472158},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1534063472158},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1534063472158},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1534063472159},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1534063472158},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1534063472160},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1534063472160},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1534063472160},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1534063472160},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472128},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472128},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472151},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472151},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472152},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472156},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534063472156},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1534063472125},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1534063472125},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1534063472126},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1534063472126},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1534063472126},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1534063472126},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1534063472126},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1534063472126},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1534063472127},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"048fd5e98149469f8c28c21ba3561a7a67952c9b","modified":1534063472127},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1534063472127},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1534063472128},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"98df9d72e37dd071e882f2d5623c9d817815b139","modified":1534063472128},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1534063472128},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1534063472128},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"18e7bef8923d83ea42df6c97405e515a876cede4","modified":1534063472129},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"a234c5cd1f75ca5731e814d0dbb92fdcf9240d1b","modified":1534063472129},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1534063472129},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"1cd01c6e92ab1913d48e556a92bb4f28b6dc4996","modified":1534063472129},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"5d9943d74cc2e0a91badcf4f755c6de77eab193a","modified":1534063472129},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"5e9bb24c750b49513d9a65799e832f07410002ac","modified":1534063472129},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"fc65b9c98a0a8ab43a5e7aabff6c5f03838e09c8","modified":1534063472130},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1534063472130},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"0ddc94ed4ba0c19627765fdf1abc4d8efbe53d5a","modified":1534063472130},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1534063472130},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1534063472130},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"c316758546dc9ba6c60cb4d852c17ca6bb6d6724","modified":1534063472130},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"a356b2185d40914447fde817eb3d358ab6b3e4c3","modified":1534063472131},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"3e8dc5c6c912628a37e3b5f886bec7b2e5ed14ea","modified":1534063472131},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"aa0629277d751c55c6d973e7691bf84af9b17a60","modified":1534063472131},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"8a2e393d2e49f7bf560766d8a07cd461bf3fce4f","modified":1534063472131},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"fcabbb241f894c9a6309c44e126cf3e8fea81fd4","modified":1534063472131},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"8b6650f77fe0a824c8075b2659e0403e0c78a705","modified":1534063472132},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"3b51dc50ea210a2de99da8f5663d7aceb372e766","modified":1541582786556},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1534063472133},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1534063472134},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1534063472134},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"385c066af96bee30be2459dbec8aae1f15d382f5","modified":1534063472134},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1534063472151},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1534063472151},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"9ab65361ba0a12a986edd103e56492644c2db0b8","modified":1534063472151},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"82f9055955920ed88a2ab6a20ab02169abb2c634","modified":1534063472152},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1534063472156},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"99fbb4686ea9a3e03a4726ed7cf4d8f529034452","modified":1534063472156},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"f29165e36489a87ba32d17dddfd2720d84e3f3ec","modified":1534063472156},{"_id":"themes/next/source/css/_variables/base.styl","hash":"29c261fa6b4046322559074d75239c6b272fb8a3","modified":1534063472156},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1534063472160},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1534063472161},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"034bc8113e0966fe2096ba5b56061bbf10ef0512","modified":1534063472161},{"_id":"themes/next/source/images/payway/alipay.jpg","hash":"fe3c33a8e3c185d62d89e64b5ca50eb6b769290e","modified":1534063472159},{"_id":"themes/next/source/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1534063472161},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1534063472161},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1534063472161},{"_id":"themes/next/source/js/src/motion.js","hash":"754b294394f102c8fd9423a1789ddb1201677898","modified":1534063472161},{"_id":"themes/next/source/js/src/post-details.js","hash":"a13f45f7aa8291cf7244ec5ba93907d119c5dbdd","modified":1534063472161},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1534063472162},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1534063472162},{"_id":"themes/next/source/js/src/utils.js","hash":"9b1325801d27213083d1487a12b1a62b539ab6f8","modified":1534063472162},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1534063472167},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"ff5915eb2596e890a2fc6697c864f861a1995ec0","modified":1534063472167},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1534063472165},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1534063472170},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1534063472170},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1534063472170},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1534063472170},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1534063472171},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1534063472171},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1534063472171},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1534063472171},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1534063472171},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1534063472176},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1534063472176},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1534063472175},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1534063472176},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1534063472177},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1534063472176},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1534063472177},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","hash":"3ef0020a1815ca6151ea4886cd0d37421ae3695c","modified":1534063472177},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1534063472178},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1534063472178},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","hash":"c39d37278c1e178838732af21bd26cd0baeddfe0","modified":1534063472177},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","hash":"9885fd9bea5e7ebafc5b1de9d17be5e106248d96","modified":1534063472177},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1534063472178},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1534063472178},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1534063472178},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1534063472178},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1534063472178},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1534063472179},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1534063472178},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1534063472179},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1534063472179},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1534063472179},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1534063472179},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1534063472179},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1534063472180},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1534063472180},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1534063472183},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1534063472183},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1534063472180},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1534063472185},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1534063472185},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1534063472185},{"_id":"themes/next/source/images/payway/wechatpay.jpg","hash":"b741074ddafaf0d7c8c81921f28cc01b794b77b3","modified":1534063472160},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1534063472176},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"28ff4ed6714c59124569ffcbd10f1173d53ca923","modified":1534063472133},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1534063472133},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"4719ce717962663c5c33ef97b1119a0b3a4ecdc3","modified":1534063472138},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1534063472138},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1534063472150},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"7e509c7c28c59f905b847304dd3d14d94b6f3b8e","modified":1534063472138},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1534063472138},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1534063472138},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"c5d48863f332ff8ce7c88dec2c893f709d7331d3","modified":1534063472141},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1534063472146},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1534063472150},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"47a46583a1f3731157a3f53f80ed1ed5e2753e8e","modified":1534063472150},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1534063472150},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1534063472150},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1534063472151},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"f7c44b0ee46cf2cf82a4c9455ba8d8b55299976f","modified":1534063472150},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"18c3336ee3d09bd2da6a876e1336539f03d5a973","modified":1534063472152},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1534063472152},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1534063472152},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1534063472153},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1534063472152},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"3b25edfa187d1bbbd0d38b50dd013cef54758abf","modified":1534063472153},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1534063472153},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1534063472153},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1534063472154},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1534063472154},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"4aac01962520d60b03b23022ab601ad4bd19c08c","modified":1534063472154},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1534063472154},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1534063472155},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c4ed249798296f60bda02351fe6404fb3ef2126f","modified":1534063472155},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"5b93958239d3d2bf9aeaede44eced2434d784462","modified":1534063472155},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"215de948be49bcf14f06d500cef9f7035e406a43","modified":1534063472155},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1534063472155},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"9d16fa3c14ed76b71229f022b63a02fd0f580958","modified":1534063472155},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"69ecd6c97e7cdfd822ac8102b45ad0ede85050db","modified":1534063472156},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"8050a5b2683d1d77238c5762b6bd89c543daed6e","modified":1534063472162},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1534063472164},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1534063472163},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1534063472167},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1534063472167},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1534063472164},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1534063472168},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1534063472168},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1534063472168},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1534063472167},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1534063472169},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1534063472169},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1534063472169},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1534063472170},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1534063472170},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1534063472171},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1534063472171},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1534063472172},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1534063472183},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1534063472183},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1534063472164},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1534063472175},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1534063472175},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1534063472184},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"7905a7f625702b45645d8be1268cb8af3f698c70","modified":1534063472139},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1534063472139},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"8a2421cb9005352905fae9d41a847ae56957247e","modified":1534063472139},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1534063472139},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1534063472140},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1534063472139},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1534063472139},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"25dc25f61a232f03ca72472b7852f882448ec185","modified":1534063472140},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"f5aa2ba3bfffc15475e7e72a55b5c9d18609fdf5","modified":1534063472140},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1534063472141},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1534063472140},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"2039590632bba3943c39319d80ef630af7928185","modified":1534063472141},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1534063472141},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1534063472141},{"_id":"themes/next/source/css/_common/components/post/my-post-copyright.styl","hash":"1a510f995e665b28d85ba4d169b824276c40e4f3","modified":1534063472141},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1534063472142},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"0f7f522cc6bfb3401d5afd62b0fcdf48bb2d604b","modified":1534063472142},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1534063472142},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1534063472142},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"535b3b4f8cb1eec2558e094320e7dfb01f94c0e7","modified":1534063472142},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1534063472142},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"aea21141015ca8c409d8b33e3e34ec505f464e93","modified":1534063472143},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"36332c8a91f089f545f3c3e8ea90d08aa4d6e60c","modified":1534063472143},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"a5d8617a24d7cb6c5ad91ea621183ca2c0917331","modified":1534063472143},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1534063472143},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1534063472143},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"d5a4e4fc17f1f7e7c3a61b52d8e2e9677e139de7","modified":1534063472143},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1534063472144},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"e4055a0d2cd2b0ad9dc55928e2f3e7bd4e499da3","modified":1534063472144},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"90d78b7270739eaab5b054226b684631a319011a","modified":1534063472144},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"0a6c0efffdf18bddbc1d1238feaed282b09cd0fe","modified":1534063472144},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1534063472144},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"89dd4f8b1f1cce3ad46cf2256038472712387d02","modified":1534063472144},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1534063472145},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1534063472145},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1534063472145},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"12937cae17c96c74d5c58db6cb29de3b2dfa14a2","modified":1534063472145},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"50305b6ad7d09d2ffa4854e39f41ec1f4fe984fd","modified":1534063472146},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1534063472145},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1534063472146},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1534063472146},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"1b3cc9f4e5a7f6e05b4100e9990b37b20d4a2005","modified":1534063472146},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"37e951e734a252fe8a81f452b963df2ba90bfe90","modified":1534063472146},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1534063472147},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1534063472147},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"ee7528900578ef4753effe05b346381c40de5499","modified":1534063472147},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1534063472147},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1534063472147},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"ead0d0f2321dc71505788c7f689f92257cf14947","modified":1534063472147},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fd42777b9125fd8969dc39d4f15473e2b91b4142","modified":1534063472148},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1534063472148},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1534063472148},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1534063472148},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"34935b40237c074be5f5e8818c14ccfd802b7439","modified":1534063472148},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"cce6772e2cdb4db85d35486ae4c6c59367fbdd40","modified":1534063472148},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1534063472149},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1534063472149},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"a5e3e6b4b4b814a9fe40b34d784fed67d6d977fa","modified":1534063472149},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"1ccfbd4d0f5754b2dc2719a91245c95f547a7652","modified":1534063472149},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1534063472153},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1534063472154},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1534063472155},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1534063472163},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1534063472163},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1534063472163},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1534063472163},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1534063472163},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1534063472168},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1534063472168},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1534063472168},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1534063472168},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1534063472169},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1534063472169},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1534063472173},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1534063472174},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1534063472172},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1534063472166},{"_id":"themes/next/source/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1534063472182},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1534063472174},{"_id":"public/about/index.html","hash":"2dee1e67a328e612abd22f63a90f274c8c73a8ec","modified":1542964997371},{"_id":"public/categories/index.html","hash":"b75377a457375137cb4ebdc9c3c970eefa4cbd08","modified":1542964997371},{"_id":"public/tags/index.html","hash":"e108917513926f3a449fecc75bc8ed65b8b438bd","modified":1542964997371},{"_id":"public/archives/page/2/index.html","hash":"5e20c44b5127790bee419b0ce2aa9183d5a61d63","modified":1542964997371},{"_id":"public/archives/2018/page/2/index.html","hash":"55e129619a4c8af89c44cbdfaa443e6f1a2bd846","modified":1542964997371},{"_id":"public/archives/2018/04/index.html","hash":"182fe374d1278fa6a941e4ada90fc1fa7849b339","modified":1542964997371},{"_id":"public/archives/2018/05/index.html","hash":"537694ff3c75cb65de5d024ad85562fba58e1960","modified":1542964997371},{"_id":"public/archives/2018/08/index.html","hash":"71df020344225a934c1bda4ed9c7df22fefbbf73","modified":1542964997371},{"_id":"public/archives/2018/10/index.html","hash":"89674dd06a7ec4c7f51486b08a74bb7fc630944a","modified":1542964997371},{"_id":"public/archives/2018/11/index.html","hash":"31f9ad91130999344d7061625bb21b6b1d112d3e","modified":1542964997371},{"_id":"public/categories/dataStructure/index.html","hash":"75d1feeb6e460c66ce494e981d7fb83964f75582","modified":1542964997371},{"_id":"public/categories/spring/index.html","hash":"143c9ca42dc60c5365eea2cd05cc59df4e23b69d","modified":1542964997372},{"_id":"public/page/2/index.html","hash":"78a81f021a992b93502f3c37cad65ed87d7532e3","modified":1542964997372},{"_id":"public/tags/dataStructure/index.html","hash":"37a758ea864af12e80c9008ab56691f8a7e97ba0","modified":1542964997372},{"_id":"public/tags/spring/index.html","hash":"c35389fd704222624f2b6a34bd486209d45e737c","modified":1542964997372},{"_id":"public/2018/11/23/dataStructure-AVL/index.html","hash":"7f7cc7873a9894955c594f2f761c98b379df8baf","modified":1542964997372},{"_id":"public/2018/11/08/java-ThisEscape/index.html","hash":"2127b502096dba3bbe9ec6470e548074f37cb9a5","modified":1542964997372},{"_id":"public/2018/10/29/java-AQS-02/index.html","hash":"88e49efe0b94baf0c2c47f1e599c4a4de2b59540","modified":1542964997373},{"_id":"public/2018/10/15/java-AQS-01/index.html","hash":"d42560377db15de0ad6a844e74a39e1c28eaaf3f","modified":1542964997373},{"_id":"public/2018/08/20/spring-IOC/index.html","hash":"0b2b554cb4959045aed803c44e2437a0e513d299","modified":1542964997373},{"_id":"public/2018/08/12/java-ThreadLocalExecutor/index.html","hash":"f114227e74e32773d51b062e169d1baae63a8cca","modified":1542964997373},{"_id":"public/2018/08/05/java-BTrace/index.html","hash":"68f7f0accb8d8126ae39d7902ec4e587e98a7263","modified":1542964997373},{"_id":"public/2018/05/05/java-WeakHashMap/index.html","hash":"cfd060e76eb22333799709a5959165ae7d5c6ee0","modified":1542964997373},{"_id":"public/2018/04/30/java-IdentityHashmap/index.html","hash":"ebf2c78e4caf1df9e060788b358a4a47161cc160","modified":1542964997373},{"_id":"public/2018/04/22/java-stateMachine/index.html","hash":"5f0e96f99a839f3853ff9421e8981862e24aceaa","modified":1542964997373},{"_id":"public/2018/04/19/java-EnumMap/index.html","hash":"b3c033e7d7f7ed3dcde3789dc3f09c117ffe0bed","modified":1542964997373},{"_id":"public/archives/index.html","hash":"10c04c74312afdb66dae6076f5472f0ff15b5e86","modified":1542964997373},{"_id":"public/archives/2018/index.html","hash":"0044e659eb8df583e8298db394581db9d6e83f57","modified":1542964997373},{"_id":"public/categories/java/index.html","hash":"7a716eeffcd810cc62bd706b408f901659ce49e0","modified":1542964997373},{"_id":"public/index.html","hash":"f051c1dd82f79d9a38110b9d9847c5a12927f5f7","modified":1542964997374},{"_id":"public/tags/java/index.html","hash":"8cd6b6e6b3b12a1dbf3fa04c768503b0e4f47aa8","modified":1542964997374},{"_id":"public/CNAME","hash":"40f5326962ae3d5a25304617df5afac115c66b62","modified":1542964997410},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1542964997410},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1542964997410},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1542964997410},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1542964997410},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1542964997410},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1542964997410},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1542964997411},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1542964997411},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1542964997411},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1542964997411},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1542964997411},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1542964997411},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1542964997411},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1542964997411},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1542964997411},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1542964997411},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1542964997411},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1542964997411},{"_id":"public/images/payway/alipay.jpg","hash":"fe3c33a8e3c185d62d89e64b5ca50eb6b769290e","modified":1542964997411},{"_id":"public/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1542964997411},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1542964997411},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1542964997411},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1542964997411},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1542964997412},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1542964997412},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1542964997412},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1542964997412},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1542964997412},{"_id":"public/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1542964997412},{"_id":"public/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1542964997412},{"_id":"public/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1542964997412},{"_id":"public/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1542964997412},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1542964997412},{"_id":"public/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1542964997412},{"_id":"public/images/payway/wechatpay.jpg","hash":"b741074ddafaf0d7c8c81921f28cc01b794b77b3","modified":1542964997798},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1542964997801},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1542964997807},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1542964997815},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1542964997815},{"_id":"public/js/src/bootstrap.js","hash":"034bc8113e0966fe2096ba5b56061bbf10ef0512","modified":1542964997815},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1542964997815},{"_id":"public/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1542964997815},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1542964997815},{"_id":"public/js/src/post-details.js","hash":"a13f45f7aa8291cf7244ec5ba93907d119c5dbdd","modified":1542964997816},{"_id":"public/js/src/motion.js","hash":"754b294394f102c8fd9423a1789ddb1201677898","modified":1542964997816},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1542964997816},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1542964997816},{"_id":"public/js/src/utils.js","hash":"9b1325801d27213083d1487a12b1a62b539ab6f8","modified":1542964997816},{"_id":"public/lib/canvas-ribbon/canvas-ribbon.js","hash":"ff5915eb2596e890a2fc6697c864f861a1995ec0","modified":1542964997816},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1542964997816},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1542964997816},{"_id":"public/lib/fastclick/README.html","hash":"da3c74d484c73cc7df565e8abbfa4d6a5a18d4da","modified":1542964997816},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1542964997816},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1542964997816},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"a6358170d346af13b1452ac157b60505bec7015c","modified":1542964997816},{"_id":"public/lib/jquery_lazyload/README.html","hash":"bde24335f6bc09d8801c0dcd7274f71b466552bd","modified":1542964997816},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1542964997816},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1542964997816},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1542964997816},{"_id":"public/lib/needsharebutton/needsharebutton.css","hash":"3ef0020a1815ca6151ea4886cd0d37421ae3695c","modified":1542964997816},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1542964997816},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1542964997816},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1542964997816},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1542964997816},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1542964997816},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1542964997816},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1542964997817},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1542964997817},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1542964997817},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1542964997817},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1542964997817},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1542964997817},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1542964997817},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1542964997817},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1542964997817},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1542964997817},{"_id":"public/js/src/schemes/pisces.js","hash":"8050a5b2683d1d77238c5762b6bd89c543daed6e","modified":1542964997817},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1542964997817},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1542964997817},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1542964997817},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1542964997817},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1542964997817},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1542964997817},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1542964997817},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1542964997817},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1542964997817},{"_id":"public/css/main.css","hash":"496d782d38b2032644ba2dd95f63f3f0fdcee7cb","modified":1542964997817},{"_id":"public/lib/needsharebutton/font-embedded.css","hash":"c39d37278c1e178838732af21bd26cd0baeddfe0","modified":1542964997817},{"_id":"public/lib/needsharebutton/needsharebutton.js","hash":"9885fd9bea5e7ebafc5b1de9d17be5e106248d96","modified":1542964997817},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1542964997818},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1542964997818},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1542964997818},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1542964997818},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1542964997818},{"_id":"public/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1542964997818},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1542964997818},{"_id":"public/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1542964997818},{"_id":"public/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1542964997818},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1542964997818},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1542964997818},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1542964997818},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1542964997818},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1542964997818},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1542964997818},{"_id":"public/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1542964997819},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1542964997819},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1542964997819},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1542964997819},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1542964997819},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1542964997819},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1542964997827}],"Category":[{"name":"dataStructure","_id":"cjottiq2b0001m9cgyjs8ylfl"},{"name":"java","_id":"cjottiq690009m9cg80vrs96h"},{"name":"spring","_id":"cjottiq6p000zm9cgp2tw77e2"}],"Data":[],"Page":[{"title":"","date":"2018-04-14T03:46:20.000Z","type":"about","_content":"\n### About\n> \n> :XanderXu\n\n### Education\n\n> 2014 - 2018, , , \n\n\n### Work Experience\n\n>  (20182 - ) \n   \n   \n   \n> (20174 - 201710)\n  \n     \n  \n\n### Gmail\n> xuxiaofei4519@gmail.com\n\n\n","source":"about/index.md","raw":"---\ntitle: \ndate: 2018-04-14 11:46:20\ntype: \"about\"\n---\n\n### About\n> \n> :XanderXu\n\n### Education\n\n> 2014 - 2018, , , \n\n\n### Work Experience\n\n>  (20182 - ) \n   \n   \n   \n> (20174 - 201710)\n  \n     \n  \n\n### Gmail\n> xuxiaofei4519@gmail.com\n\n\n","updated":"2018-08-12T08:44:32.083Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjottiq650006m9cgx8jq7rpj","content":"<h3 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h3><blockquote>\n<p><br>:XanderXu</p>\n</blockquote>\n<h3 id=\"Education\"><a href=\"#Education\" class=\"headerlink\" title=\"Education\"></a>Education</h3><blockquote>\n<p>2014 - 2018, , , </p>\n</blockquote>\n<h3 id=\"Work-Experience\"><a href=\"#Work-Experience\" class=\"headerlink\" title=\"Work Experience\"></a>Work Experience</h3><blockquote>\n<p> (20182 - )<br>  <br>   </p>\n</blockquote>\n<blockquote>\n<p>(20174 - 201710)<br>  <br>     </p>\n</blockquote>\n<h3 id=\"Gmail\"><a href=\"#Gmail\" class=\"headerlink\" title=\"Gmail\"></a>Gmail</h3><blockquote>\n<p><a href=\"mailto:xuxiaofei4519@gmail.com\" target=\"_blank\" rel=\"noopener\">xuxiaofei4519@gmail.com</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h3><blockquote>\n<p><br>:XanderXu</p>\n</blockquote>\n<h3 id=\"Education\"><a href=\"#Education\" class=\"headerlink\" title=\"Education\"></a>Education</h3><blockquote>\n<p>2014 - 2018, , , </p>\n</blockquote>\n<h3 id=\"Work-Experience\"><a href=\"#Work-Experience\" class=\"headerlink\" title=\"Work Experience\"></a>Work Experience</h3><blockquote>\n<p> (20182 - )<br>  <br>   </p>\n</blockquote>\n<blockquote>\n<p>(20174 - 201710)<br>  <br>     </p>\n</blockquote>\n<h3 id=\"Gmail\"><a href=\"#Gmail\" class=\"headerlink\" title=\"Gmail\"></a>Gmail</h3><blockquote>\n<p><a href=\"mailto:xuxiaofei4519@gmail.com\" target=\"_blank\" rel=\"noopener\">xuxiaofei4519@gmail.com</a></p>\n</blockquote>\n"},{"title":"","date":"2018-04-14T02:53:49.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: \ndate: 2018-04-14 10:53:49\ntype: \"categories\"\n---\n","updated":"2018-08-12T08:44:32.083Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjottiq670008m9cgg1q6yhh7","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"","date":"2018-04-14T02:46:38.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: \ndate: 2018-04-14 10:46:38\ntype: \"tags\"\n---\n","updated":"2018-08-12T08:44:32.092Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjottiq6b000cm9cge4nb5qoi","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"(AVL)","date":"2018-11-23T09:12:09.000Z","copyright":true,"_content":"\n\n{% cq %} \nAVL\n\n{% endcq %}\n<!-- more -->\n\n* * *\n\n>\n\n#### \n```java\n/**\n *  AVL\n */\npublic class AVLBalanceTree {\n\n    //\n    private AVLNode root;\n    //\n    private Integer size;\n\n    public AVLBalanceTree() {\n    }\n\n    public AVLBalanceTree(AVLNode root) {\n        this.root = root;\n    }\n\n\n    /**\n     * \n     */\n    @Data\n    private static class AVLNode{\n        //\n        private Integer value;\n        //\n        private Integer height;\n        //\n        private AVLNode leftNode;\n        //\n        private AVLNode rightNode;\n\n        public AVLNode(Integer value) {\n            //0\n            new AVLNode(value,0,null,null);\n        }\n\n        public AVLNode(Integer value, Integer height, AVLNode leftNode, AVLNode rightNode) {\n            this.value = value;\n            this.height = height;\n            this.leftNode = leftNode;\n            this.rightNode = rightNode;\n        }\n\n    }\n\n    /**\n     * \n     * @param value  Integer\n     */\n    public void insert(Integer value) throws Exception {\n        if (null == this.root){\n            initRoot(value);\n            size++;\n            return;\n        }\n        if (!constains(value))\n            throw new Exception(\"\");\n\n\n    }\n\n    /**\n     * \n     */\n    private void initRoot(Integer value){\n        this.root = new AVLNode(value);\n        System.out.println(\"root:\" + this.root.getValue());\n    }\n\n\n    /**\n     * val\n     * @param val\n     * @return boolean\n     */\n    private boolean constains(Integer val){\n        AVLNode currentNode = root;\n        if (null == currentNode)\n            return false;\n\n        while (null != currentNode){\n            if (val > currentNode.getValue()){\n                currentNode = currentNode.getRightNode();\n            } else if (val < currentNode.getValue()){\n                currentNode = currentNode.getLeftNode();\n            } else {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * \n     */\n    private AVLNode insert(AVLNode parent,Integer val){\n        if (parent == null){\n            return createSimpleNode(val);\n        }\n\n        if (val < parent.getValue()){\n            parent.setLeftNode(insert(parent.getLeftNode(), val));\n\n            //\n            // \n            if (height(parent.getLeftNode()) - height(parent.getRightNode()) > 1){\n                //parentvalvalparent\n                Integer compareVal = parent.getLeftNode().getValue();\n\n\n                if (val < compareVal){ // valparent()\n                    leftLeftRotate(parent);\n                }else { // valparent()\n                    leftRightRotate(parent);\n                }\n            }\n        }\n        if (val > parent.getValue()){\n            parent.setRightNode(insert(parent.getRightNode(), val));\n            // \n            if (height(parent.getRightNode()) - height(parent.getLeftNode()) > 1){\n                //parentvalvalparent\n                Integer compareVal = parent.getRightNode().getValue();\n\n\n                if (val > compareVal){  // valparent()\n                    rightRightRotate(parent);\n                }else { // valparent()\n                    rightLeftRotate(parent);\n                }\n            }\n        }\n\n        /**\n         * parent1\n         */\n        parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n        return parent;\n    }\n\n    public AVLNode remove(AVLNode parent, Integer val){\n        if (val < parent.getValue()){\n            //\n            parent.setLeftNode(remove(parent.getLeftNode(), val));\n            //\n            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n            //1\n            if (height(parent.getRightNode()) - height(parent.getLeftNode()) > 1){\n                //ifparent\n\n                //parent\n                AVLNode tempNode = parent.getRightNode();\n                if (height(tempNode.getLeftNode()) > height(tempNode.getRightNode())){\n                    rightLeftRotate(parent);\n                }else {\n                    rightRightRotate(parent);\n                }\n            }\n            //++\n        }else if (val > parent.getValue()){\n            //\n            parent.setRightNode(remove(parent.getRightNode(), val));\n            //\n            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n            //\n            if (height(parent.getLeftNode()) - height(parent.getRightNode()) > 1){\n                //ifparent\n\n                //parent\n                AVLNode tempNode = parent.getLeftNode();\n                if (height(tempNode.getRightNode()) > height(tempNode.getLeftNode())){\n                    leftRightRotate(parent);\n                }else {\n                    leftLeftRotate(parent);\n                }\n            }\n            //++\n        }else {\n            //\n\n            //\n            if (parent.getLeftNode() != null && parent.getRightNode() != null){\n                // \n                // 1.parent()parent().\n                // 2.parent()parent()\n                // \n                // \n                //    \n                //    ()\n\n\n\n                if (height(parent.getLeftNode()) > height(parent.getRightNode())){\n                    //parent>parent\n                    //(maxNode)(parent)\n\n                    //\n                    AVLNode maxValue = getMaxNode(parent.getLeftNode());\n                    //\n                    parent.setLeftNode(remove(parent.getLeftNode(), maxValue.getValue()));\n                    //parent\n                    maxValue.setLeftNode(parent.getLeftNode());\n                    maxValue.setRightNode(parent.getRightNode());\n                    //\n                    maxValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n                    //\n                    return maxValue;\n                }else {\n                    //parent<=parent\n                    //(minNode)(parent)\n\n                    //\n                    AVLNode minValue = getMinNode(parent.getRightNode());\n                    //\n                    parent.setRightNode(remove(parent.getRightNode(), minValue.getValue()));\n                    //parent\n                    minValue.setLeftNode(parent.getLeftNode());\n                    minValue.setRightNode(parent.getRightNode());\n                    //\n                    minValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n                    //\n                    return minValue;\n                }\n            }else {\n                // \n                if (parent.getLeftNode() != null || parent.getRightNode() != null) {\n                    parent = parent.getLeftNode() == null ? parent.getRightNode() : parent.getLeftNode();\n                }else {\n                    parent = null;\n                }\n            }\n        }\n\n        return parent;\n    }\n\n    /**\n     * \n     */\n    private AVLNode getMaxNode(AVLNode currentNode){\n        if (currentNode != null){\n            currentNode = getMaxNode(currentNode.getRightNode());\n        }\n        return currentNode;\n    }\n\n    /**\n     * \n     */\n    private AVLNode getMinNode(AVLNode currentNode){\n        if (currentNode != null) {\n            currentNode = getMinNode(currentNode.getLeftNode());\n        }\n        return currentNode;\n    }\n\n    private AVLNode createSimpleNode(Integer val){\n        return new AVLNode(val);\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private Integer height(AVLNode avlNode){\n        //-1\n        return avlNode == null ? -1 : avlNode.getHeight();\n    }\n\n    /**\n     * \n     * @param leftNodo \n     * @param rightNode \n     * @return \n     */\n    private Integer maxHeight(AVLNode leftNodo, AVLNode rightNode){\n        return height(leftNodo) > height(rightNode) ? height(leftNodo) : height(rightNode);\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode leftLeftRotate(AVLNode avlNode){\n        //node\n        AVLNode newAvlNode = avlNode.getLeftNode();\n        avlNode.setLeftNode(newAvlNode.getRightNode());\n        newAvlNode.setRightNode(avlNode);\n\n        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + 1);\n        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + 1);\n        return newAvlNode;\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode rightRightRotate(AVLNode avlNode){\n        AVLNode newAvlNode = avlNode.getRightNode();\n        avlNode.setRightNode(newAvlNode.getLeftNode());\n        newAvlNode.setLeftNode(newAvlNode);\n\n        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + 1);\n        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + 1);\n        return newAvlNode;\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode leftRightRotate(AVLNode avlNode){\n        avlNode.setLeftNode(rightRightRotate(avlNode.getLeftNode()));\n        return leftLeftRotate(avlNode);\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode rightLeftRotate(AVLNode avlNode){\n        avlNode.setRightNode(leftLeftRotate(avlNode.getRightNode()));\n        return rightRightRotate(avlNode);\n    }\n\n}\n\n```","source":"_posts/dataStructure-AVL.md","raw":"---\ntitle: (AVL)\ndate: 2018-11-23 17:12:09\ncopyright: true\ntags:\n - dataStructure\ncategories:\n - dataStructure\n---\n\n\n{% cq %} \nAVL\n\n{% endcq %}\n<!-- more -->\n\n* * *\n\n>\n\n#### \n```java\n/**\n *  AVL\n */\npublic class AVLBalanceTree {\n\n    //\n    private AVLNode root;\n    //\n    private Integer size;\n\n    public AVLBalanceTree() {\n    }\n\n    public AVLBalanceTree(AVLNode root) {\n        this.root = root;\n    }\n\n\n    /**\n     * \n     */\n    @Data\n    private static class AVLNode{\n        //\n        private Integer value;\n        //\n        private Integer height;\n        //\n        private AVLNode leftNode;\n        //\n        private AVLNode rightNode;\n\n        public AVLNode(Integer value) {\n            //0\n            new AVLNode(value,0,null,null);\n        }\n\n        public AVLNode(Integer value, Integer height, AVLNode leftNode, AVLNode rightNode) {\n            this.value = value;\n            this.height = height;\n            this.leftNode = leftNode;\n            this.rightNode = rightNode;\n        }\n\n    }\n\n    /**\n     * \n     * @param value  Integer\n     */\n    public void insert(Integer value) throws Exception {\n        if (null == this.root){\n            initRoot(value);\n            size++;\n            return;\n        }\n        if (!constains(value))\n            throw new Exception(\"\");\n\n\n    }\n\n    /**\n     * \n     */\n    private void initRoot(Integer value){\n        this.root = new AVLNode(value);\n        System.out.println(\"root:\" + this.root.getValue());\n    }\n\n\n    /**\n     * val\n     * @param val\n     * @return boolean\n     */\n    private boolean constains(Integer val){\n        AVLNode currentNode = root;\n        if (null == currentNode)\n            return false;\n\n        while (null != currentNode){\n            if (val > currentNode.getValue()){\n                currentNode = currentNode.getRightNode();\n            } else if (val < currentNode.getValue()){\n                currentNode = currentNode.getLeftNode();\n            } else {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * \n     */\n    private AVLNode insert(AVLNode parent,Integer val){\n        if (parent == null){\n            return createSimpleNode(val);\n        }\n\n        if (val < parent.getValue()){\n            parent.setLeftNode(insert(parent.getLeftNode(), val));\n\n            //\n            // \n            if (height(parent.getLeftNode()) - height(parent.getRightNode()) > 1){\n                //parentvalvalparent\n                Integer compareVal = parent.getLeftNode().getValue();\n\n\n                if (val < compareVal){ // valparent()\n                    leftLeftRotate(parent);\n                }else { // valparent()\n                    leftRightRotate(parent);\n                }\n            }\n        }\n        if (val > parent.getValue()){\n            parent.setRightNode(insert(parent.getRightNode(), val));\n            // \n            if (height(parent.getRightNode()) - height(parent.getLeftNode()) > 1){\n                //parentvalvalparent\n                Integer compareVal = parent.getRightNode().getValue();\n\n\n                if (val > compareVal){  // valparent()\n                    rightRightRotate(parent);\n                }else { // valparent()\n                    rightLeftRotate(parent);\n                }\n            }\n        }\n\n        /**\n         * parent1\n         */\n        parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n        return parent;\n    }\n\n    public AVLNode remove(AVLNode parent, Integer val){\n        if (val < parent.getValue()){\n            //\n            parent.setLeftNode(remove(parent.getLeftNode(), val));\n            //\n            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n            //1\n            if (height(parent.getRightNode()) - height(parent.getLeftNode()) > 1){\n                //ifparent\n\n                //parent\n                AVLNode tempNode = parent.getRightNode();\n                if (height(tempNode.getLeftNode()) > height(tempNode.getRightNode())){\n                    rightLeftRotate(parent);\n                }else {\n                    rightRightRotate(parent);\n                }\n            }\n            //++\n        }else if (val > parent.getValue()){\n            //\n            parent.setRightNode(remove(parent.getRightNode(), val));\n            //\n            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n            //\n            if (height(parent.getLeftNode()) - height(parent.getRightNode()) > 1){\n                //ifparent\n\n                //parent\n                AVLNode tempNode = parent.getLeftNode();\n                if (height(tempNode.getRightNode()) > height(tempNode.getLeftNode())){\n                    leftRightRotate(parent);\n                }else {\n                    leftLeftRotate(parent);\n                }\n            }\n            //++\n        }else {\n            //\n\n            //\n            if (parent.getLeftNode() != null && parent.getRightNode() != null){\n                // \n                // 1.parent()parent().\n                // 2.parent()parent()\n                // \n                // \n                //    \n                //    ()\n\n\n\n                if (height(parent.getLeftNode()) > height(parent.getRightNode())){\n                    //parent>parent\n                    //(maxNode)(parent)\n\n                    //\n                    AVLNode maxValue = getMaxNode(parent.getLeftNode());\n                    //\n                    parent.setLeftNode(remove(parent.getLeftNode(), maxValue.getValue()));\n                    //parent\n                    maxValue.setLeftNode(parent.getLeftNode());\n                    maxValue.setRightNode(parent.getRightNode());\n                    //\n                    maxValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n                    //\n                    return maxValue;\n                }else {\n                    //parent<=parent\n                    //(minNode)(parent)\n\n                    //\n                    AVLNode minValue = getMinNode(parent.getRightNode());\n                    //\n                    parent.setRightNode(remove(parent.getRightNode(), minValue.getValue()));\n                    //parent\n                    minValue.setLeftNode(parent.getLeftNode());\n                    minValue.setRightNode(parent.getRightNode());\n                    //\n                    minValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + 1);\n                    //\n                    return minValue;\n                }\n            }else {\n                // \n                if (parent.getLeftNode() != null || parent.getRightNode() != null) {\n                    parent = parent.getLeftNode() == null ? parent.getRightNode() : parent.getLeftNode();\n                }else {\n                    parent = null;\n                }\n            }\n        }\n\n        return parent;\n    }\n\n    /**\n     * \n     */\n    private AVLNode getMaxNode(AVLNode currentNode){\n        if (currentNode != null){\n            currentNode = getMaxNode(currentNode.getRightNode());\n        }\n        return currentNode;\n    }\n\n    /**\n     * \n     */\n    private AVLNode getMinNode(AVLNode currentNode){\n        if (currentNode != null) {\n            currentNode = getMinNode(currentNode.getLeftNode());\n        }\n        return currentNode;\n    }\n\n    private AVLNode createSimpleNode(Integer val){\n        return new AVLNode(val);\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private Integer height(AVLNode avlNode){\n        //-1\n        return avlNode == null ? -1 : avlNode.getHeight();\n    }\n\n    /**\n     * \n     * @param leftNodo \n     * @param rightNode \n     * @return \n     */\n    private Integer maxHeight(AVLNode leftNodo, AVLNode rightNode){\n        return height(leftNodo) > height(rightNode) ? height(leftNodo) : height(rightNode);\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode leftLeftRotate(AVLNode avlNode){\n        //node\n        AVLNode newAvlNode = avlNode.getLeftNode();\n        avlNode.setLeftNode(newAvlNode.getRightNode());\n        newAvlNode.setRightNode(avlNode);\n\n        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + 1);\n        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + 1);\n        return newAvlNode;\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode rightRightRotate(AVLNode avlNode){\n        AVLNode newAvlNode = avlNode.getRightNode();\n        avlNode.setRightNode(newAvlNode.getLeftNode());\n        newAvlNode.setLeftNode(newAvlNode);\n\n        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + 1);\n        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + 1);\n        return newAvlNode;\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode leftRightRotate(AVLNode avlNode){\n        avlNode.setLeftNode(rightRightRotate(avlNode.getLeftNode()));\n        return leftLeftRotate(avlNode);\n    }\n\n    /**\n     * \n     * @param avlNode \n     * @return \n     */\n    private AVLNode rightLeftRotate(AVLNode avlNode){\n        avlNode.setRightNode(leftLeftRotate(avlNode.getRightNode()));\n        return rightRightRotate(avlNode);\n    }\n\n}\n\n```","slug":"dataStructure-AVL","published":1,"updated":"2018-11-23T09:21:25.231Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq270000m9cg0scxozmf","content":"<blockquote class=\"blockquote-center\"><p>AVL<br></p>\n</blockquote>\n<a id=\"more\"></a>\n<hr>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  AVL</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AVLBalanceTree</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> AVLNode root;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer size;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLBalanceTree</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLBalanceTree</span><span class=\"params\">(AVLNode root)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.root = root;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Data</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AVLNode</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> Integer value;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> Integer height;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> AVLNode leftNode;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> AVLNode rightNode;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLNode</span><span class=\"params\">(Integer value)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//0</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> AVLNode(value,<span class=\"number\">0</span>,<span class=\"keyword\">null</span>,<span class=\"keyword\">null</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLNode</span><span class=\"params\">(Integer value, Integer height, AVLNode leftNode, AVLNode rightNode)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.height = height;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.leftNode = leftNode;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.rightNode = rightNode;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value  Integer</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Integer value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == <span class=\"keyword\">this</span>.root)&#123;</span><br><span class=\"line\">            initRoot(value);</span><br><span class=\"line\">            size++;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!constains(value))</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Exception(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initRoot</span><span class=\"params\">(Integer value)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.root = <span class=\"keyword\">new</span> AVLNode(value);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"root:\"</span> + <span class=\"keyword\">this</span>.root.getValue());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * val</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> val</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">constains</span><span class=\"params\">(Integer val)</span></span>&#123;</span><br><span class=\"line\">        AVLNode currentNode = root;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == currentNode)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">null</span> != currentNode)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (val &gt; currentNode.getValue())&#123;</span><br><span class=\"line\">                currentNode = currentNode.getRightNode();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val &lt; currentNode.getValue())&#123;</span><br><span class=\"line\">                currentNode = currentNode.getLeftNode();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">insert</span><span class=\"params\">(AVLNode parent,Integer val)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (parent == <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> createSimpleNode(val);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val &lt; parent.getValue())&#123;</span><br><span class=\"line\">            parent.setLeftNode(insert(parent.getLeftNode(), val));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getLeftNode()) - height(parent.getRightNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//parentvalvalparent</span></span><br><span class=\"line\">                Integer compareVal = parent.getLeftNode().getValue();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (val &lt; compareVal)&#123; <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    leftLeftRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123; <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    leftRightRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val &gt; parent.getValue())&#123;</span><br><span class=\"line\">            parent.setRightNode(insert(parent.getRightNode(), val));</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getRightNode()) - height(parent.getLeftNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//parentvalvalparent</span></span><br><span class=\"line\">                Integer compareVal = parent.getRightNode().getValue();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (val &gt; compareVal)&#123;  <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    rightRightRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123; <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    rightLeftRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * parent1</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> parent;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> AVLNode <span class=\"title\">remove</span><span class=\"params\">(AVLNode parent, Integer val)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val &lt; parent.getValue())&#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setLeftNode(remove(parent.getLeftNode(), val));</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"comment\">//1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getRightNode()) - height(parent.getLeftNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//ifparent</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//parent</span></span><br><span class=\"line\">                AVLNode tempNode = parent.getRightNode();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (height(tempNode.getLeftNode()) &gt; height(tempNode.getRightNode()))&#123;</span><br><span class=\"line\">                    rightLeftRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    rightRightRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//++</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val &gt; parent.getValue())&#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setRightNode(remove(parent.getRightNode(), val));</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getLeftNode()) - height(parent.getRightNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//ifparent</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//parent</span></span><br><span class=\"line\">                AVLNode tempNode = parent.getLeftNode();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (height(tempNode.getRightNode()) &gt; height(tempNode.getLeftNode()))&#123;</span><br><span class=\"line\">                    leftRightRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    leftLeftRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//++</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (parent.getLeftNode() != <span class=\"keyword\">null</span> &amp;&amp; parent.getRightNode() != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// 1.parent()parent().</span></span><br><span class=\"line\">                <span class=\"comment\">// 2.parent()parent()</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">//    </span></span><br><span class=\"line\">                <span class=\"comment\">//    ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (height(parent.getLeftNode()) &gt; height(parent.getRightNode()))&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//parent&gt;parent</span></span><br><span class=\"line\">                    <span class=\"comment\">//(maxNode)(parent)</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    AVLNode maxValue = getMaxNode(parent.getLeftNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    parent.setLeftNode(remove(parent.getLeftNode(), maxValue.getValue()));</span><br><span class=\"line\">                    <span class=\"comment\">//parent</span></span><br><span class=\"line\">                    maxValue.setLeftNode(parent.getLeftNode());</span><br><span class=\"line\">                    maxValue.setRightNode(parent.getRightNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    maxValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> maxValue;</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//parent&lt;=parent</span></span><br><span class=\"line\">                    <span class=\"comment\">//(minNode)(parent)</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    AVLNode minValue = getMinNode(parent.getRightNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    parent.setRightNode(remove(parent.getRightNode(), minValue.getValue()));</span><br><span class=\"line\">                    <span class=\"comment\">//parent</span></span><br><span class=\"line\">                    minValue.setLeftNode(parent.getLeftNode());</span><br><span class=\"line\">                    minValue.setRightNode(parent.getRightNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    minValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> minValue;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (parent.getLeftNode() != <span class=\"keyword\">null</span> || parent.getRightNode() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    parent = parent.getLeftNode() == <span class=\"keyword\">null</span> ? parent.getRightNode() : parent.getLeftNode();</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    parent = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> parent;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">getMaxNode</span><span class=\"params\">(AVLNode currentNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentNode != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            currentNode = getMaxNode(currentNode.getRightNode());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> currentNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">getMinNode</span><span class=\"params\">(AVLNode currentNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentNode != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            currentNode = getMinNode(currentNode.getLeftNode());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> currentNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">createSimpleNode</span><span class=\"params\">(Integer val)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> AVLNode(val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Integer <span class=\"title\">height</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//-1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> avlNode == <span class=\"keyword\">null</span> ? -<span class=\"number\">1</span> : avlNode.getHeight();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> leftNodo </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> rightNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Integer <span class=\"title\">maxHeight</span><span class=\"params\">(AVLNode leftNodo, AVLNode rightNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> height(leftNodo) &gt; height(rightNode) ? height(leftNodo) : height(rightNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">leftLeftRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//node</span></span><br><span class=\"line\">        AVLNode newAvlNode = avlNode.getLeftNode();</span><br><span class=\"line\">        avlNode.setLeftNode(newAvlNode.getRightNode());</span><br><span class=\"line\">        newAvlNode.setRightNode(avlNode);</span><br><span class=\"line\"></span><br><span class=\"line\">        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> newAvlNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">rightRightRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        AVLNode newAvlNode = avlNode.getRightNode();</span><br><span class=\"line\">        avlNode.setRightNode(newAvlNode.getLeftNode());</span><br><span class=\"line\">        newAvlNode.setLeftNode(newAvlNode);</span><br><span class=\"line\"></span><br><span class=\"line\">        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> newAvlNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">leftRightRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        avlNode.setLeftNode(rightRightRotate(avlNode.getLeftNode()));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> leftLeftRotate(avlNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">rightLeftRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        avlNode.setRightNode(leftLeftRotate(avlNode.getRightNode()));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rightRightRotate(avlNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>AVL<br></p>\n</blockquote>","more":"<hr>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  AVL</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AVLBalanceTree</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> AVLNode root;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer size;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLBalanceTree</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLBalanceTree</span><span class=\"params\">(AVLNode root)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.root = root;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Data</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AVLNode</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> Integer value;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> Integer height;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> AVLNode leftNode;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> AVLNode rightNode;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLNode</span><span class=\"params\">(Integer value)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//0</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> AVLNode(value,<span class=\"number\">0</span>,<span class=\"keyword\">null</span>,<span class=\"keyword\">null</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AVLNode</span><span class=\"params\">(Integer value, Integer height, AVLNode leftNode, AVLNode rightNode)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.height = height;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.leftNode = leftNode;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.rightNode = rightNode;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value  Integer</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Integer value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == <span class=\"keyword\">this</span>.root)&#123;</span><br><span class=\"line\">            initRoot(value);</span><br><span class=\"line\">            size++;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!constains(value))</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Exception(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initRoot</span><span class=\"params\">(Integer value)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.root = <span class=\"keyword\">new</span> AVLNode(value);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"root:\"</span> + <span class=\"keyword\">this</span>.root.getValue());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * val</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> val</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">constains</span><span class=\"params\">(Integer val)</span></span>&#123;</span><br><span class=\"line\">        AVLNode currentNode = root;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == currentNode)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">null</span> != currentNode)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (val &gt; currentNode.getValue())&#123;</span><br><span class=\"line\">                currentNode = currentNode.getRightNode();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val &lt; currentNode.getValue())&#123;</span><br><span class=\"line\">                currentNode = currentNode.getLeftNode();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">insert</span><span class=\"params\">(AVLNode parent,Integer val)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (parent == <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> createSimpleNode(val);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val &lt; parent.getValue())&#123;</span><br><span class=\"line\">            parent.setLeftNode(insert(parent.getLeftNode(), val));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getLeftNode()) - height(parent.getRightNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//parentvalvalparent</span></span><br><span class=\"line\">                Integer compareVal = parent.getLeftNode().getValue();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (val &lt; compareVal)&#123; <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    leftLeftRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123; <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    leftRightRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val &gt; parent.getValue())&#123;</span><br><span class=\"line\">            parent.setRightNode(insert(parent.getRightNode(), val));</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getRightNode()) - height(parent.getLeftNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//parentvalvalparent</span></span><br><span class=\"line\">                Integer compareVal = parent.getRightNode().getValue();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (val &gt; compareVal)&#123;  <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    rightRightRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123; <span class=\"comment\">// valparent()</span></span><br><span class=\"line\">                    rightLeftRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * parent1</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> parent;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> AVLNode <span class=\"title\">remove</span><span class=\"params\">(AVLNode parent, Integer val)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val &lt; parent.getValue())&#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setLeftNode(remove(parent.getLeftNode(), val));</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"comment\">//1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getRightNode()) - height(parent.getLeftNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//ifparent</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//parent</span></span><br><span class=\"line\">                AVLNode tempNode = parent.getRightNode();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (height(tempNode.getLeftNode()) &gt; height(tempNode.getRightNode()))&#123;</span><br><span class=\"line\">                    rightLeftRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    rightRightRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//++</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val &gt; parent.getValue())&#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setRightNode(remove(parent.getRightNode(), val));</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            parent.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (height(parent.getLeftNode()) - height(parent.getRightNode()) &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//ifparent</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//parent</span></span><br><span class=\"line\">                AVLNode tempNode = parent.getLeftNode();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (height(tempNode.getRightNode()) &gt; height(tempNode.getLeftNode()))&#123;</span><br><span class=\"line\">                    leftRightRotate(parent);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    leftLeftRotate(parent);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//++</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (parent.getLeftNode() != <span class=\"keyword\">null</span> &amp;&amp; parent.getRightNode() != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// 1.parent()parent().</span></span><br><span class=\"line\">                <span class=\"comment\">// 2.parent()parent()</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">//    </span></span><br><span class=\"line\">                <span class=\"comment\">//    ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (height(parent.getLeftNode()) &gt; height(parent.getRightNode()))&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//parent&gt;parent</span></span><br><span class=\"line\">                    <span class=\"comment\">//(maxNode)(parent)</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    AVLNode maxValue = getMaxNode(parent.getLeftNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    parent.setLeftNode(remove(parent.getLeftNode(), maxValue.getValue()));</span><br><span class=\"line\">                    <span class=\"comment\">//parent</span></span><br><span class=\"line\">                    maxValue.setLeftNode(parent.getLeftNode());</span><br><span class=\"line\">                    maxValue.setRightNode(parent.getRightNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    maxValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> maxValue;</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//parent&lt;=parent</span></span><br><span class=\"line\">                    <span class=\"comment\">//(minNode)(parent)</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    AVLNode minValue = getMinNode(parent.getRightNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    parent.setRightNode(remove(parent.getRightNode(), minValue.getValue()));</span><br><span class=\"line\">                    <span class=\"comment\">//parent</span></span><br><span class=\"line\">                    minValue.setLeftNode(parent.getLeftNode());</span><br><span class=\"line\">                    minValue.setRightNode(parent.getRightNode());</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    minValue.setHeight(maxHeight(parent.getLeftNode(), parent.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> minValue;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (parent.getLeftNode() != <span class=\"keyword\">null</span> || parent.getRightNode() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    parent = parent.getLeftNode() == <span class=\"keyword\">null</span> ? parent.getRightNode() : parent.getLeftNode();</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    parent = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> parent;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">getMaxNode</span><span class=\"params\">(AVLNode currentNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentNode != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            currentNode = getMaxNode(currentNode.getRightNode());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> currentNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">getMinNode</span><span class=\"params\">(AVLNode currentNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentNode != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            currentNode = getMinNode(currentNode.getLeftNode());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> currentNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">createSimpleNode</span><span class=\"params\">(Integer val)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> AVLNode(val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Integer <span class=\"title\">height</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//-1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> avlNode == <span class=\"keyword\">null</span> ? -<span class=\"number\">1</span> : avlNode.getHeight();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> leftNodo </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> rightNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Integer <span class=\"title\">maxHeight</span><span class=\"params\">(AVLNode leftNodo, AVLNode rightNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> height(leftNodo) &gt; height(rightNode) ? height(leftNodo) : height(rightNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">leftLeftRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//node</span></span><br><span class=\"line\">        AVLNode newAvlNode = avlNode.getLeftNode();</span><br><span class=\"line\">        avlNode.setLeftNode(newAvlNode.getRightNode());</span><br><span class=\"line\">        newAvlNode.setRightNode(avlNode);</span><br><span class=\"line\"></span><br><span class=\"line\">        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> newAvlNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">rightRightRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        AVLNode newAvlNode = avlNode.getRightNode();</span><br><span class=\"line\">        avlNode.setRightNode(newAvlNode.getLeftNode());</span><br><span class=\"line\">        newAvlNode.setLeftNode(newAvlNode);</span><br><span class=\"line\"></span><br><span class=\"line\">        avlNode.setHeight(maxHeight(avlNode.getLeftNode(), avlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        newAvlNode.setHeight(maxHeight(newAvlNode.getLeftNode(), newAvlNode.getRightNode()) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> newAvlNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">leftRightRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        avlNode.setLeftNode(rightRightRotate(avlNode.getLeftNode()));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> leftLeftRotate(avlNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> avlNode </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> AVLNode <span class=\"title\">rightLeftRotate</span><span class=\"params\">(AVLNode avlNode)</span></span>&#123;</span><br><span class=\"line\">        avlNode.setRightNode(leftLeftRotate(avlNode.getRightNode()));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rightRightRotate(avlNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"BTrace","date":"2018-08-05T12:40:09.000Z","copyright":true,"_content":"\n{% cq %} \njavaBTraceBTrace\n{% endcq %}\n<!-- more -->\n\n### BTrace\n>Btrace (Byte Trace)sunjava BTraceAgentJavaBTraceJavaAgentBTrace\n\n### BTrace\n- [release](https://github.com/btraceio/btrace)\n- \n {% qnimg /java-BTrace/java-BTrace01.png %}\n- \n {% qnimg /java-BTrace/java-BTrace02.png %}\n \n### BTrace\n- ()\n {% qnimg /java-BTrace/java-BTrace03.png %}\n- \n {% qnimg /java-BTrace/java-BTrace04.png %}\n- \n {% qnimg /java-BTrace/java-BTrace05.png %}\n \n\n### BTraceAPI\n#### \n- Kind.ENTRY  \n- Kind.RETURN \n- Kind.THROW \n- Kind.LINE \n- Kind.Call \n \n### BTrace\n- \n- \n- \n- \n- \n- \n- \n- (for, while, do..while)\n- \n- \n- assert\n\n\n\n","source":"_posts/java-BTrace.md","raw":"---\ntitle: BTrace\ndate: 2018-08-05 20:40:09\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n\n{% cq %} \njavaBTraceBTrace\n{% endcq %}\n<!-- more -->\n\n### BTrace\n>Btrace (Byte Trace)sunjava BTraceAgentJavaBTraceJavaAgentBTrace\n\n### BTrace\n- [release](https://github.com/btraceio/btrace)\n- \n {% qnimg /java-BTrace/java-BTrace01.png %}\n- \n {% qnimg /java-BTrace/java-BTrace02.png %}\n \n### BTrace\n- ()\n {% qnimg /java-BTrace/java-BTrace03.png %}\n- \n {% qnimg /java-BTrace/java-BTrace04.png %}\n- \n {% qnimg /java-BTrace/java-BTrace05.png %}\n \n\n### BTraceAPI\n#### \n- Kind.ENTRY  \n- Kind.RETURN \n- Kind.THROW \n- Kind.LINE \n- Kind.Call \n \n### BTrace\n- \n- \n- \n- \n- \n- \n- \n- (for, while, do..while)\n- \n- \n- assert\n\n\n\n","slug":"java-BTrace","published":1,"updated":"2018-10-11T11:31:07.314Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq640005m9cgv0g9t37g","content":"<blockquote class=\"blockquote-center\"><p>javaBTraceBTrace</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><blockquote>\n<p>Btrace (Byte Trace)sunjava BTraceAgentJavaBTraceJavaAgentBTrace</p>\n</blockquote>\n<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><ul>\n<li><a href=\"https://github.com/btraceio/btrace\" target=\"_blank\" rel=\"noopener\">release</a></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace01.png\"></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace02.png\">\n</li>\n</ul>\n<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><ul>\n<li>()<img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace03.png\"></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace04.png\"></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace05.png\">\n</li>\n</ul>\n<h3 id=\"BTraceAPI\"><a href=\"#BTraceAPI\" class=\"headerlink\" title=\"BTraceAPI\"></a>BTraceAPI</h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li>Kind.ENTRY  </li>\n<li>Kind.RETURN </li>\n<li>Kind.THROW </li>\n<li>Kind.LINE </li>\n<li>Kind.Call </li>\n</ul>\n<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>(for, while, do..while)</li>\n<li></li>\n<li></li>\n<li>assert</li>\n</ul>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>javaBTraceBTrace</p>\n</blockquote>","more":"<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><blockquote>\n<p>Btrace (Byte Trace)sunjava BTraceAgentJavaBTraceJavaAgentBTrace</p>\n</blockquote>\n<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><ul>\n<li><a href=\"https://github.com/btraceio/btrace\" target=\"_blank\" rel=\"noopener\">release</a></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace01.png\"></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace02.png\">\n</li>\n</ul>\n<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><ul>\n<li>()<img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace03.png\"></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace04.png\"></li>\n<li><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-BTrace/java-BTrace05.png\">\n</li>\n</ul>\n<h3 id=\"BTraceAPI\"><a href=\"#BTraceAPI\" class=\"headerlink\" title=\"BTraceAPI\"></a>BTraceAPI</h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li>Kind.ENTRY  </li>\n<li>Kind.RETURN </li>\n<li>Kind.THROW </li>\n<li>Kind.LINE </li>\n<li>Kind.Call </li>\n</ul>\n<h3 id=\"BTrace\"><a href=\"#BTrace\" class=\"headerlink\" title=\"BTrace\"></a>BTrace</h3><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>(for, while, do..while)</li>\n<li></li>\n<li></li>\n<li>assert</li>\n</ul>"},{"title":"AQSReentrantLock","date":"2018-10-15T12:40:09.000Z","copyright":true,"_content":"{% cq %} \njavadoopReentrantLock\n{% endcq %}\n<!-- more -->\n\n#### \n{% qnimg /java-AQS-01/AQS_01.jpg %}\n* * *\n\n#### \n\n##### ReentrantLock\n```java\npublic ReentrantLock(boolean fair) {\n    sync = fair ? new FairSync() : new NonfairSync();\n}\n```\n- ReentrantLock\n\n##### AQSacquire\n```java\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) &&\n        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n```\n##### ReentrantLock\n```java\nstatic final class FairSync extends Sync {\n    private static final long serialVersionUID = -3000897897090466540L;\n\n    final void lock() {\n        acquire(1);\n    }\n\n    /**\n     * boolean\n     * true1.2.\n     */\n    protected final boolean tryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        // state == 0 \n        if (c == 0) {\n            // \n            // \n            if (!hasQueuedPredecessors() &&\n                // CAS\n                // \n                compareAndSetState(0, acquires)) {\n                \n                // \n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        // else ifstate=state+1\n        else if (current == getExclusiveOwnerThread()) {\n            int nextc = c + acquires;\n            if (nextc < 0)\n                throw new Error(\"Maximum lock count exceeded\");\n            setState(nextc);\n            return true;\n        }\n        // ifelse iftrue\n        // :\n        // if (!tryAcquire(arg) \n        //        && acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) \n        //     selfInterrupt();\n        // !tryAcquire(arg) == true,acquireQueued(addWaiter(Node.EXCLUSIVE), arg)\n        return false;\n    }\n}\n```\n\n##### addWaiter\n```java\n    // node\n    // modeNode.EXCLUSIVE\n    private Node addWaiter(Node mode) {\n        Node node = new Node(Thread.currentThread(), mode);\n        // Try the fast path of enq; backup to full enq on failure\n        // node\n        Node pred = tail;\n\n        // tail!=null => (tail==head)\n        if (pred != null) { \n            //  \n            node.prev = pred; \n            // CAS, tail == node\n            //  CAStailOffSettailnode\n            // predCASpredpredtailnode\n            if (compareAndSetTail(pred, node)) {\n                // node==tail, \n                //  node.prev = pred\n                // \n                pred.next = node;\n                // \n                return node;\n            }\n        }\n        // \n        //  pred==null()  CAS()\n        enq(node);\n        return node;\n    }\n```\n\n##### enq\n```java\n    // \n    // \n    // CAStail\n    private Node enq(final Node node) {\n        for (;;) {\n            Node t = tail;\n            // \n            if (t == null) { // Must initialize\n                // head\n                // headtailnull\n                // CAS\n                if (compareAndSetHead(new Node()))\n                    // headwaitStatus==0, new Node()\n\n                    // headtailnull\n                    // tailheadtail\n                    // tail=headreturnreturnreturn\n                    // forelse\n                    tail = head;\n            } else {\n                //  addWaiter \n                // \n                node.prev = t;\n                if (compareAndSetTail(t, node)) {\n                    t.next = node;\n                    return t;\n                }\n            }\n        }\n    }\n```\n\n#### acquireQueued\n```java\nfinal boolean acquireQueued(final Node node, int arg) {\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n                final Node p = node.predecessor();\n                // p == head head\n                // headheadhead\n                // \n                // \n                // headnode\n                // enq(node) headnew Node()\n                // head\n                // tryAcquire, CASstate\n                if (p == head && tryAcquire(arg)) {\n                    setHead(node);\n                    p.next = null; // help GC\n                    failed = false;\n                    return interrupted;\n                }\n                // ifnode\n                // tryAcquire(arg)\n                if (shouldParkAfterFailedAcquire(p, node) &&\n                    parkAndCheckInterrupt())\n                    interrupted = true;\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n\n```\n\n#### shouldParkAfterFailedAcquire\n```java\n    // \"\"\n    // \n    private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n        int ws = pred.waitStatus;\n        //  waitStatus == -1 true\n        // Node-1\n        if (ws == Node.SIGNAL)\n            /*\n             * This node has already set status asking a release\n             * to signal it, so it can safely park.\n             */\n            return true;\n\n        //  waitStatus0 0 \n        // \n        // prevwaitStatus<=0\n        // \n        // \n        if (ws > 0) {\n            /*\n             * Predecessor was cancelled. Skip over predecessors and\n             * indicate retry.\n             */\n            do {\n                node.prev = pred = pred.prev;\n            } while (pred.waitStatus > 0);\n            pred.next = node;\n        } else {\n            // \n            // waitStatus-110-2-3\n            // waitStatusnodewaitStatu0\n            // CASwaitStatusNode.SIGNAL(-1)\n            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n        }\n        return false;\n    }\n```\n\n#### shouldParkAfterFailedAcquire\n```java\n    // private static boolean shouldParkAfterFailedAcquire(Node pred, Node node)\n    // \n    // true, waitStatus==-1\n    //        \n    // false, \n\n    // \n    // if (shouldParkAfterFailedAcquire(p, node) &&\n    //                parkAndCheckInterrupt())\n    //                interrupted = true;\n\n    // 1. shouldParkAfterFailedAcquire(p, node)true\n    // parkAndCheckInterrupt():\n\n    // true\n    // LockSupport.park(this)=======\n    private final boolean parkAndCheckInterrupt() {\n        LockSupport.park(this);\n        return Thread.interrupted();\n    }\n```\n> shouldParkAfterFailedAcquire(p, node)false:\n  shouldParkAfterFailedAcquire(p, node)truewaitStatus=-1-1true-1\n  shouldParkAfterFailedAcquire(p, node)falsenodehead,for","source":"_posts/java-AQS-01.md","raw":"---\ntitle: AQSReentrantLock\ndate: 2018-10-15 20:40:09\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n{% cq %} \njavadoopReentrantLock\n{% endcq %}\n<!-- more -->\n\n#### \n{% qnimg /java-AQS-01/AQS_01.jpg %}\n* * *\n\n#### \n\n##### ReentrantLock\n```java\npublic ReentrantLock(boolean fair) {\n    sync = fair ? new FairSync() : new NonfairSync();\n}\n```\n- ReentrantLock\n\n##### AQSacquire\n```java\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) &&\n        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n```\n##### ReentrantLock\n```java\nstatic final class FairSync extends Sync {\n    private static final long serialVersionUID = -3000897897090466540L;\n\n    final void lock() {\n        acquire(1);\n    }\n\n    /**\n     * boolean\n     * true1.2.\n     */\n    protected final boolean tryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        // state == 0 \n        if (c == 0) {\n            // \n            // \n            if (!hasQueuedPredecessors() &&\n                // CAS\n                // \n                compareAndSetState(0, acquires)) {\n                \n                // \n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        // else ifstate=state+1\n        else if (current == getExclusiveOwnerThread()) {\n            int nextc = c + acquires;\n            if (nextc < 0)\n                throw new Error(\"Maximum lock count exceeded\");\n            setState(nextc);\n            return true;\n        }\n        // ifelse iftrue\n        // :\n        // if (!tryAcquire(arg) \n        //        && acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) \n        //     selfInterrupt();\n        // !tryAcquire(arg) == true,acquireQueued(addWaiter(Node.EXCLUSIVE), arg)\n        return false;\n    }\n}\n```\n\n##### addWaiter\n```java\n    // node\n    // modeNode.EXCLUSIVE\n    private Node addWaiter(Node mode) {\n        Node node = new Node(Thread.currentThread(), mode);\n        // Try the fast path of enq; backup to full enq on failure\n        // node\n        Node pred = tail;\n\n        // tail!=null => (tail==head)\n        if (pred != null) { \n            //  \n            node.prev = pred; \n            // CAS, tail == node\n            //  CAStailOffSettailnode\n            // predCASpredpredtailnode\n            if (compareAndSetTail(pred, node)) {\n                // node==tail, \n                //  node.prev = pred\n                // \n                pred.next = node;\n                // \n                return node;\n            }\n        }\n        // \n        //  pred==null()  CAS()\n        enq(node);\n        return node;\n    }\n```\n\n##### enq\n```java\n    // \n    // \n    // CAStail\n    private Node enq(final Node node) {\n        for (;;) {\n            Node t = tail;\n            // \n            if (t == null) { // Must initialize\n                // head\n                // headtailnull\n                // CAS\n                if (compareAndSetHead(new Node()))\n                    // headwaitStatus==0, new Node()\n\n                    // headtailnull\n                    // tailheadtail\n                    // tail=headreturnreturnreturn\n                    // forelse\n                    tail = head;\n            } else {\n                //  addWaiter \n                // \n                node.prev = t;\n                if (compareAndSetTail(t, node)) {\n                    t.next = node;\n                    return t;\n                }\n            }\n        }\n    }\n```\n\n#### acquireQueued\n```java\nfinal boolean acquireQueued(final Node node, int arg) {\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n                final Node p = node.predecessor();\n                // p == head head\n                // headheadhead\n                // \n                // \n                // headnode\n                // enq(node) headnew Node()\n                // head\n                // tryAcquire, CASstate\n                if (p == head && tryAcquire(arg)) {\n                    setHead(node);\n                    p.next = null; // help GC\n                    failed = false;\n                    return interrupted;\n                }\n                // ifnode\n                // tryAcquire(arg)\n                if (shouldParkAfterFailedAcquire(p, node) &&\n                    parkAndCheckInterrupt())\n                    interrupted = true;\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n\n```\n\n#### shouldParkAfterFailedAcquire\n```java\n    // \"\"\n    // \n    private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n        int ws = pred.waitStatus;\n        //  waitStatus == -1 true\n        // Node-1\n        if (ws == Node.SIGNAL)\n            /*\n             * This node has already set status asking a release\n             * to signal it, so it can safely park.\n             */\n            return true;\n\n        //  waitStatus0 0 \n        // \n        // prevwaitStatus<=0\n        // \n        // \n        if (ws > 0) {\n            /*\n             * Predecessor was cancelled. Skip over predecessors and\n             * indicate retry.\n             */\n            do {\n                node.prev = pred = pred.prev;\n            } while (pred.waitStatus > 0);\n            pred.next = node;\n        } else {\n            // \n            // waitStatus-110-2-3\n            // waitStatusnodewaitStatu0\n            // CASwaitStatusNode.SIGNAL(-1)\n            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n        }\n        return false;\n    }\n```\n\n#### shouldParkAfterFailedAcquire\n```java\n    // private static boolean shouldParkAfterFailedAcquire(Node pred, Node node)\n    // \n    // true, waitStatus==-1\n    //        \n    // false, \n\n    // \n    // if (shouldParkAfterFailedAcquire(p, node) &&\n    //                parkAndCheckInterrupt())\n    //                interrupted = true;\n\n    // 1. shouldParkAfterFailedAcquire(p, node)true\n    // parkAndCheckInterrupt():\n\n    // true\n    // LockSupport.park(this)=======\n    private final boolean parkAndCheckInterrupt() {\n        LockSupport.park(this);\n        return Thread.interrupted();\n    }\n```\n> shouldParkAfterFailedAcquire(p, node)false:\n  shouldParkAfterFailedAcquire(p, node)truewaitStatus=-1-1true-1\n  shouldParkAfterFailedAcquire(p, node)falsenodehead,for","slug":"java-AQS-01","published":1,"updated":"2018-11-06T06:17:07.838Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq660007m9cgikhbckhz","content":"<blockquote class=\"blockquote-center\"><p>javadoopReentrantLock</p>\n</blockquote>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-AQS-01/AQS_01.jpg\">\n<hr>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ReentrantLock</span><span class=\"params\">(<span class=\"keyword\">boolean</span> fair)</span> </span>&#123;</span><br><span class=\"line\">    sync = fair ? <span class=\"keyword\">new</span> FairSync() : <span class=\"keyword\">new</span> NonfairSync();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>ReentrantLock</li>\n</ul>\n<h5 id=\"AQSacquire\"><a href=\"#AQSacquire\" class=\"headerlink\" title=\"AQSacquire\"></a>AQSacquire</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">acquire</span><span class=\"params\">(<span class=\"keyword\">int</span> arg)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class=\"line\">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class=\"line\">        selfInterrupt();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FairSync</span> <span class=\"keyword\">extends</span> <span class=\"title\">Sync</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">3000897897090466540L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        acquire(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * boolean</span></span><br><span class=\"line\"><span class=\"comment\">     * true1.2.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">tryAcquire</span><span class=\"params\">(<span class=\"keyword\">int</span> acquires)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Thread current = Thread.currentThread();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> c = getState();</span><br><span class=\"line\">        <span class=\"comment\">// state == 0 </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!hasQueuedPredecessors() &amp;&amp;</span><br><span class=\"line\">                <span class=\"comment\">// CAS</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                compareAndSetState(<span class=\"number\">0</span>, acquires)) &#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                setExclusiveOwnerThread(current);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// else ifstate=state+1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> nextc = c + acquires;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (nextc &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Error(<span class=\"string\">\"Maximum lock count exceeded\"</span>);</span><br><span class=\"line\">            setState(nextc);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// ifelse iftrue</span></span><br><span class=\"line\">        <span class=\"comment\">// :</span></span><br><span class=\"line\">        <span class=\"comment\">// if (!tryAcquire(arg) </span></span><br><span class=\"line\">        <span class=\"comment\">//        &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) </span></span><br><span class=\"line\">        <span class=\"comment\">//     selfInterrupt();</span></span><br><span class=\"line\">        <span class=\"comment\">// !tryAcquire(arg) == true,acquireQueued(addWaiter(Node.EXCLUSIVE), arg)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"addWaiter\"><a href=\"#addWaiter\" class=\"headerlink\" title=\"addWaiter\"></a>addWaiter</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// node</span></span><br><span class=\"line\"><span class=\"comment\">// modeNode.EXCLUSIVE</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Node <span class=\"title\">addWaiter</span><span class=\"params\">(Node mode)</span> </span>&#123;</span><br><span class=\"line\">    Node node = <span class=\"keyword\">new</span> Node(Thread.currentThread(), mode);</span><br><span class=\"line\">    <span class=\"comment\">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class=\"line\">    <span class=\"comment\">// node</span></span><br><span class=\"line\">    Node pred = tail;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// tail!=null =&gt; (tail==head)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pred != <span class=\"keyword\">null</span>) &#123; </span><br><span class=\"line\">        <span class=\"comment\">//  </span></span><br><span class=\"line\">        node.prev = pred; </span><br><span class=\"line\">        <span class=\"comment\">// CAS, tail == node</span></span><br><span class=\"line\">        <span class=\"comment\">//  CAStailOffSettailnode</span></span><br><span class=\"line\">        <span class=\"comment\">// predCASpredpredtailnode</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// node==tail, </span></span><br><span class=\"line\">            <span class=\"comment\">//  node.prev = pred</span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            pred.next = node;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">//  pred==null()  CAS()</span></span><br><span class=\"line\">    enq(node);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"enq\"><a href=\"#enq\" class=\"headerlink\" title=\"enq\"></a>enq</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// CAStail</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Node <span class=\"title\">enq</span><span class=\"params\">(<span class=\"keyword\">final</span> Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        Node t = tail;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// Must initialize</span></span><br><span class=\"line\">            <span class=\"comment\">// head</span></span><br><span class=\"line\">            <span class=\"comment\">// headtailnull</span></span><br><span class=\"line\">            <span class=\"comment\">// CAS</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (compareAndSetHead(<span class=\"keyword\">new</span> Node()))</span><br><span class=\"line\">                <span class=\"comment\">// headwaitStatus==0, new Node()</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// headtailnull</span></span><br><span class=\"line\">                <span class=\"comment\">// tailheadtail</span></span><br><span class=\"line\">                <span class=\"comment\">// tail=headreturnreturnreturn</span></span><br><span class=\"line\">                <span class=\"comment\">// forelse</span></span><br><span class=\"line\">                tail = head;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//  addWaiter </span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            node.prev = t;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class=\"line\">                t.next = node;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> t;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"acquireQueued\"><a href=\"#acquireQueued\" class=\"headerlink\" title=\"acquireQueued\"></a>acquireQueued</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">acquireQueued</span><span class=\"params\">(<span class=\"keyword\">final</span> Node node, <span class=\"keyword\">int</span> arg)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">boolean</span> failed = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">boolean</span> interrupted = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> Node p = node.predecessor();</span><br><span class=\"line\">                <span class=\"comment\">// p == head head</span></span><br><span class=\"line\">                <span class=\"comment\">// headheadhead</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// headnode</span></span><br><span class=\"line\">                <span class=\"comment\">// enq(node) headnew Node()</span></span><br><span class=\"line\">                <span class=\"comment\">// head</span></span><br><span class=\"line\">                <span class=\"comment\">// tryAcquire, CASstate</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class=\"line\">                    setHead(node);</span><br><span class=\"line\">                    p.next = <span class=\"keyword\">null</span>; <span class=\"comment\">// help GC</span></span><br><span class=\"line\">                    failed = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> interrupted;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// ifnode</span></span><br><span class=\"line\">                <span class=\"comment\">// tryAcquire(arg)</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class=\"line\">                    parkAndCheckInterrupt())</span><br><span class=\"line\">                    interrupted = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (failed)</span><br><span class=\"line\">                cancelAcquire(node);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"shouldParkAfterFailedAcquire\"><a href=\"#shouldParkAfterFailedAcquire\" class=\"headerlink\" title=\"shouldParkAfterFailedAcquire\"></a>shouldParkAfterFailedAcquire</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// \"\"</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">shouldParkAfterFailedAcquire</span><span class=\"params\">(Node pred, Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ws = pred.waitStatus;</span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus == -1 true</span></span><br><span class=\"line\">    <span class=\"comment\">// Node-1</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ws == Node.SIGNAL)</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * This node has already set status asking a release</span></span><br><span class=\"line\"><span class=\"comment\">         * to signal it, so it can safely park.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus0 0 </span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// prevwaitStatus&lt;=0</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ws &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * Predecessor was cancelled. Skip over predecessors and</span></span><br><span class=\"line\"><span class=\"comment\">         * indicate retry.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            node.prev = pred = pred.prev;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (pred.waitStatus &gt; <span class=\"number\">0</span>);</span><br><span class=\"line\">        pred.next = node;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"comment\">// waitStatus-110-2-3</span></span><br><span class=\"line\">        <span class=\"comment\">// waitStatusnodewaitStatu0</span></span><br><span class=\"line\">        <span class=\"comment\">// CASwaitStatusNode.SIGNAL(-1)</span></span><br><span class=\"line\">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"shouldParkAfterFailedAcquire-1\"><a href=\"#shouldParkAfterFailedAcquire-1\" class=\"headerlink\" title=\"shouldParkAfterFailedAcquire\"></a>shouldParkAfterFailedAcquire</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// private static boolean shouldParkAfterFailedAcquire(Node pred, Node node)</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// true, waitStatus==-1</span></span><br><span class=\"line\"><span class=\"comment\">//        </span></span><br><span class=\"line\"><span class=\"comment\">// false, </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span></span><br><span class=\"line\"><span class=\"comment\">//                parkAndCheckInterrupt())</span></span><br><span class=\"line\"><span class=\"comment\">//                interrupted = true;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1. shouldParkAfterFailedAcquire(p, node)true</span></span><br><span class=\"line\"><span class=\"comment\">// parkAndCheckInterrupt():</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"comment\">// LockSupport.park(this)=======</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">parkAndCheckInterrupt</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    LockSupport.park(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Thread.interrupted();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>shouldParkAfterFailedAcquire(p, node)false:<br>  shouldParkAfterFailedAcquire(p, node)truewaitStatus=-1-1true-1<br>  shouldParkAfterFailedAcquire(p, node)falsenodehead,for</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>javadoopReentrantLock</p>\n</blockquote>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-AQS-01/AQS_01.jpg\">\n<hr>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ReentrantLock</span><span class=\"params\">(<span class=\"keyword\">boolean</span> fair)</span> </span>&#123;</span><br><span class=\"line\">    sync = fair ? <span class=\"keyword\">new</span> FairSync() : <span class=\"keyword\">new</span> NonfairSync();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>ReentrantLock</li>\n</ul>\n<h5 id=\"AQSacquire\"><a href=\"#AQSacquire\" class=\"headerlink\" title=\"AQSacquire\"></a>AQSacquire</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">acquire</span><span class=\"params\">(<span class=\"keyword\">int</span> arg)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class=\"line\">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class=\"line\">        selfInterrupt();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FairSync</span> <span class=\"keyword\">extends</span> <span class=\"title\">Sync</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">3000897897090466540L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        acquire(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * boolean</span></span><br><span class=\"line\"><span class=\"comment\">     * true1.2.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">tryAcquire</span><span class=\"params\">(<span class=\"keyword\">int</span> acquires)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Thread current = Thread.currentThread();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> c = getState();</span><br><span class=\"line\">        <span class=\"comment\">// state == 0 </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!hasQueuedPredecessors() &amp;&amp;</span><br><span class=\"line\">                <span class=\"comment\">// CAS</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                compareAndSetState(<span class=\"number\">0</span>, acquires)) &#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                setExclusiveOwnerThread(current);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// else ifstate=state+1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> nextc = c + acquires;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (nextc &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Error(<span class=\"string\">\"Maximum lock count exceeded\"</span>);</span><br><span class=\"line\">            setState(nextc);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// ifelse iftrue</span></span><br><span class=\"line\">        <span class=\"comment\">// :</span></span><br><span class=\"line\">        <span class=\"comment\">// if (!tryAcquire(arg) </span></span><br><span class=\"line\">        <span class=\"comment\">//        &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) </span></span><br><span class=\"line\">        <span class=\"comment\">//     selfInterrupt();</span></span><br><span class=\"line\">        <span class=\"comment\">// !tryAcquire(arg) == true,acquireQueued(addWaiter(Node.EXCLUSIVE), arg)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"addWaiter\"><a href=\"#addWaiter\" class=\"headerlink\" title=\"addWaiter\"></a>addWaiter</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// node</span></span><br><span class=\"line\"><span class=\"comment\">// modeNode.EXCLUSIVE</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Node <span class=\"title\">addWaiter</span><span class=\"params\">(Node mode)</span> </span>&#123;</span><br><span class=\"line\">    Node node = <span class=\"keyword\">new</span> Node(Thread.currentThread(), mode);</span><br><span class=\"line\">    <span class=\"comment\">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class=\"line\">    <span class=\"comment\">// node</span></span><br><span class=\"line\">    Node pred = tail;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// tail!=null =&gt; (tail==head)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pred != <span class=\"keyword\">null</span>) &#123; </span><br><span class=\"line\">        <span class=\"comment\">//  </span></span><br><span class=\"line\">        node.prev = pred; </span><br><span class=\"line\">        <span class=\"comment\">// CAS, tail == node</span></span><br><span class=\"line\">        <span class=\"comment\">//  CAStailOffSettailnode</span></span><br><span class=\"line\">        <span class=\"comment\">// predCASpredpredtailnode</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// node==tail, </span></span><br><span class=\"line\">            <span class=\"comment\">//  node.prev = pred</span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            pred.next = node;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">//  pred==null()  CAS()</span></span><br><span class=\"line\">    enq(node);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"enq\"><a href=\"#enq\" class=\"headerlink\" title=\"enq\"></a>enq</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// CAStail</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Node <span class=\"title\">enq</span><span class=\"params\">(<span class=\"keyword\">final</span> Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        Node t = tail;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// Must initialize</span></span><br><span class=\"line\">            <span class=\"comment\">// head</span></span><br><span class=\"line\">            <span class=\"comment\">// headtailnull</span></span><br><span class=\"line\">            <span class=\"comment\">// CAS</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (compareAndSetHead(<span class=\"keyword\">new</span> Node()))</span><br><span class=\"line\">                <span class=\"comment\">// headwaitStatus==0, new Node()</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// headtailnull</span></span><br><span class=\"line\">                <span class=\"comment\">// tailheadtail</span></span><br><span class=\"line\">                <span class=\"comment\">// tail=headreturnreturnreturn</span></span><br><span class=\"line\">                <span class=\"comment\">// forelse</span></span><br><span class=\"line\">                tail = head;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//  addWaiter </span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            node.prev = t;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class=\"line\">                t.next = node;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> t;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"acquireQueued\"><a href=\"#acquireQueued\" class=\"headerlink\" title=\"acquireQueued\"></a>acquireQueued</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">acquireQueued</span><span class=\"params\">(<span class=\"keyword\">final</span> Node node, <span class=\"keyword\">int</span> arg)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">boolean</span> failed = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">boolean</span> interrupted = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> Node p = node.predecessor();</span><br><span class=\"line\">                <span class=\"comment\">// p == head head</span></span><br><span class=\"line\">                <span class=\"comment\">// headheadhead</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"comment\">// headnode</span></span><br><span class=\"line\">                <span class=\"comment\">// enq(node) headnew Node()</span></span><br><span class=\"line\">                <span class=\"comment\">// head</span></span><br><span class=\"line\">                <span class=\"comment\">// tryAcquire, CASstate</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class=\"line\">                    setHead(node);</span><br><span class=\"line\">                    p.next = <span class=\"keyword\">null</span>; <span class=\"comment\">// help GC</span></span><br><span class=\"line\">                    failed = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> interrupted;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// ifnode</span></span><br><span class=\"line\">                <span class=\"comment\">// tryAcquire(arg)</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class=\"line\">                    parkAndCheckInterrupt())</span><br><span class=\"line\">                    interrupted = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (failed)</span><br><span class=\"line\">                cancelAcquire(node);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"shouldParkAfterFailedAcquire\"><a href=\"#shouldParkAfterFailedAcquire\" class=\"headerlink\" title=\"shouldParkAfterFailedAcquire\"></a>shouldParkAfterFailedAcquire</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// \"\"</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">shouldParkAfterFailedAcquire</span><span class=\"params\">(Node pred, Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ws = pred.waitStatus;</span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus == -1 true</span></span><br><span class=\"line\">    <span class=\"comment\">// Node-1</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ws == Node.SIGNAL)</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * This node has already set status asking a release</span></span><br><span class=\"line\"><span class=\"comment\">         * to signal it, so it can safely park.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus0 0 </span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// prevwaitStatus&lt;=0</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ws &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * Predecessor was cancelled. Skip over predecessors and</span></span><br><span class=\"line\"><span class=\"comment\">         * indicate retry.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            node.prev = pred = pred.prev;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (pred.waitStatus &gt; <span class=\"number\">0</span>);</span><br><span class=\"line\">        pred.next = node;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"comment\">// waitStatus-110-2-3</span></span><br><span class=\"line\">        <span class=\"comment\">// waitStatusnodewaitStatu0</span></span><br><span class=\"line\">        <span class=\"comment\">// CASwaitStatusNode.SIGNAL(-1)</span></span><br><span class=\"line\">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"shouldParkAfterFailedAcquire-1\"><a href=\"#shouldParkAfterFailedAcquire-1\" class=\"headerlink\" title=\"shouldParkAfterFailedAcquire\"></a>shouldParkAfterFailedAcquire</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// private static boolean shouldParkAfterFailedAcquire(Node pred, Node node)</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// true, waitStatus==-1</span></span><br><span class=\"line\"><span class=\"comment\">//        </span></span><br><span class=\"line\"><span class=\"comment\">// false, </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span></span><br><span class=\"line\"><span class=\"comment\">//                parkAndCheckInterrupt())</span></span><br><span class=\"line\"><span class=\"comment\">//                interrupted = true;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1. shouldParkAfterFailedAcquire(p, node)true</span></span><br><span class=\"line\"><span class=\"comment\">// parkAndCheckInterrupt():</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"comment\">// LockSupport.park(this)=======</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">parkAndCheckInterrupt</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    LockSupport.park(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Thread.interrupted();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>shouldParkAfterFailedAcquire(p, node)false:<br>  shouldParkAfterFailedAcquire(p, node)truewaitStatus=-1-1true-1<br>  shouldParkAfterFailedAcquire(p, node)falsenodehead,for</p>\n</blockquote>"},{"title":"this","date":"2018-11-08T06:20:09.000Z","copyright":true,"_content":"\n{% cq %} \n\n{% endcq %}\n<!-- more -->\n\n* * *\n\n#### this\nThisEscape\n```java\npublic class ThisEscape {  \n    private String name = null;  \n  \n    public ThisEscape(EventSource source) {  \n        source.registerListener(new EventListener() {  \n  \n            public void onEvent(Event event) {  \n                doSomething(event);  \n            }  \n  \n        });\n        //registerListenerlistener.onEvent\n        //onEventdosomethingname\n        //name.toStringthis\n        name = \"TEST\";  \n    }  \n  \n    /** \n     * \n     * @param event \n     */  \n    protected void doSomething(Event event) {  \n        System.out.println(name.toString());  \n    }  \n}  \n```\n##### EventListener\n```java\nimport java.awt.Event; \n\npublic interface EventListener {  \n    public void onEvent(Event event);  \n  \n} \n```\n##### EventSource\n```java\npublic class EventSource {  \n  \n    public void registerListener(EventListener listener) {  \n        listener.onEvent(null);  \n    }  \n  \n}  \n```\n##### main\n```java\npublic class Client {  \n  \n    /** \n     * \n     * @param args \n     * @throws InterruptedException \n     */  \n    public static void main(String[] args) throws InterruptedException {  \n        EventSource es = new EventSource();  \n        new ThisEscape(es);  \n    }  \n  \n}  \n```\n##### :\n{% qnimg /java-ThisEscape/java-ThisEscape-01.png %}\n> nameThisEscapethisnew EventListener(){}classclassclassthisthis\n\n#### \n> \n##### SafeListener\n```java\npublic class SafeListener {  \n    //final,\n    //EventListener,\n    private final EventListener listener;  \n    private String              name = null;  \n  \n    private SafeListener() {  \n        listener = new EventListener() {  \n  \n            public void onEvent(Event event) {  \n                doSomething();  \n            }  \n        };  \n        name = \"TEST\";  \n    }  \n  \n    public static SafeListener newInstance(EventSource eventSource) {  \n        SafeListener safeListener = new SafeListener();  \n        eventSource.registerListener(safeListener.listener);  \n        return safeListener;  \n    }  \n  \n    protected void doSomething() {  \n        System.out.println(name.toString());  \n    }  \n}  \n```\n##### client\n```java\npublic class Client {\n\n    public static void main(String[] args) throws InterruptedException {\n        EventSource es = new EventSource();\n//        new ThisEscape(es);\n        SafeListener.newInstance(es);\n    }\n}\n\n```\n##### :\n{% qnimg /java-ThisEscape/java-ThisEscape-02.png %}\n\n> ","source":"_posts/java-ThisEscape.md","raw":"---\ntitle: this\ndate: 2018-11-08 14:20:09\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n\n{% cq %} \n\n{% endcq %}\n<!-- more -->\n\n* * *\n\n#### this\nThisEscape\n```java\npublic class ThisEscape {  \n    private String name = null;  \n  \n    public ThisEscape(EventSource source) {  \n        source.registerListener(new EventListener() {  \n  \n            public void onEvent(Event event) {  \n                doSomething(event);  \n            }  \n  \n        });\n        //registerListenerlistener.onEvent\n        //onEventdosomethingname\n        //name.toStringthis\n        name = \"TEST\";  \n    }  \n  \n    /** \n     * \n     * @param event \n     */  \n    protected void doSomething(Event event) {  \n        System.out.println(name.toString());  \n    }  \n}  \n```\n##### EventListener\n```java\nimport java.awt.Event; \n\npublic interface EventListener {  \n    public void onEvent(Event event);  \n  \n} \n```\n##### EventSource\n```java\npublic class EventSource {  \n  \n    public void registerListener(EventListener listener) {  \n        listener.onEvent(null);  \n    }  \n  \n}  \n```\n##### main\n```java\npublic class Client {  \n  \n    /** \n     * \n     * @param args \n     * @throws InterruptedException \n     */  \n    public static void main(String[] args) throws InterruptedException {  \n        EventSource es = new EventSource();  \n        new ThisEscape(es);  \n    }  \n  \n}  \n```\n##### :\n{% qnimg /java-ThisEscape/java-ThisEscape-01.png %}\n> nameThisEscapethisnew EventListener(){}classclassclassthisthis\n\n#### \n> \n##### SafeListener\n```java\npublic class SafeListener {  \n    //final,\n    //EventListener,\n    private final EventListener listener;  \n    private String              name = null;  \n  \n    private SafeListener() {  \n        listener = new EventListener() {  \n  \n            public void onEvent(Event event) {  \n                doSomething();  \n            }  \n        };  \n        name = \"TEST\";  \n    }  \n  \n    public static SafeListener newInstance(EventSource eventSource) {  \n        SafeListener safeListener = new SafeListener();  \n        eventSource.registerListener(safeListener.listener);  \n        return safeListener;  \n    }  \n  \n    protected void doSomething() {  \n        System.out.println(name.toString());  \n    }  \n}  \n```\n##### client\n```java\npublic class Client {\n\n    public static void main(String[] args) throws InterruptedException {\n        EventSource es = new EventSource();\n//        new ThisEscape(es);\n        SafeListener.newInstance(es);\n    }\n}\n\n```\n##### :\n{% qnimg /java-ThisEscape/java-ThisEscape-02.png %}\n\n> ","slug":"java-ThisEscape","published":1,"updated":"2018-11-08T07:45:49.430Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6a000bm9cgwr7g808t","content":"<blockquote class=\"blockquote-center\"><p></p>\n</blockquote>\n<a id=\"more\"></a>\n<hr>\n<h4 id=\"this\"><a href=\"#this\" class=\"headerlink\" title=\"this\"></a>this</h4><p>ThisEscape<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThisEscape</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name = <span class=\"keyword\">null</span>;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThisEscape</span><span class=\"params\">(EventSource source)</span> </span>&#123;  </span><br><span class=\"line\">        source.registerListener(<span class=\"keyword\">new</span> EventListener() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onEvent</span><span class=\"params\">(Event event)</span> </span>&#123;  </span><br><span class=\"line\">                doSomething(event);  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//registerListenerlistener.onEvent</span></span><br><span class=\"line\">        <span class=\"comment\">//onEventdosomethingname</span></span><br><span class=\"line\">        <span class=\"comment\">//name.toStringthis</span></span><br><span class=\"line\">        name = <span class=\"string\">\"TEST\"</span>;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> event </span></span><br><span class=\"line\"><span class=\"comment\">     */</span>  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">(Event event)</span> </span>&#123;  </span><br><span class=\"line\">        System.out.println(name.toString());  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"EventListener\"><a href=\"#EventListener\" class=\"headerlink\" title=\"EventListener\"></a>EventListener</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.awt.Event; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">EventListener</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onEvent</span><span class=\"params\">(Event event)</span></span>;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"EventSource\"><a href=\"#EventSource\" class=\"headerlink\" title=\"EventSource\"></a>EventSource</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventSource</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerListener</span><span class=\"params\">(EventListener listener)</span> </span>&#123;  </span><br><span class=\"line\">        listener.onEvent(<span class=\"keyword\">null</span>);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"main\"><a href=\"#main\" class=\"headerlink\" title=\"main\"></a>main</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> InterruptedException </span></span><br><span class=\"line\"><span class=\"comment\">     */</span>  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;  </span><br><span class=\"line\">        EventSource es = <span class=\"keyword\">new</span> EventSource();  </span><br><span class=\"line\">        <span class=\"keyword\">new</span> ThisEscape(es);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h5><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-ThisEscape/java-ThisEscape-01.png\">\n<blockquote>\n<p>nameThisEscapethisnew EventListener(){}classclassclassthisthis</p>\n</blockquote>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><blockquote>\n<p></p>\n</blockquote>\n<h5 id=\"SafeListener\"><a href=\"#SafeListener\" class=\"headerlink\" title=\"SafeListener\"></a>SafeListener</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SafeListener</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"comment\">//final,</span></span><br><span class=\"line\">    <span class=\"comment\">//EventListener,</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> EventListener listener;  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String              name = <span class=\"keyword\">null</span>;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">SafeListener</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        listener = <span class=\"keyword\">new</span> EventListener() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onEvent</span><span class=\"params\">(Event event)</span> </span>&#123;  </span><br><span class=\"line\">                doSomething();  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">        &#125;;  </span><br><span class=\"line\">        name = <span class=\"string\">\"TEST\"</span>;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SafeListener <span class=\"title\">newInstance</span><span class=\"params\">(EventSource eventSource)</span> </span>&#123;  </span><br><span class=\"line\">        SafeListener safeListener = <span class=\"keyword\">new</span> SafeListener();  </span><br><span class=\"line\">        eventSource.registerListener(safeListener.listener);  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> safeListener;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        System.out.println(name.toString());  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"client\"><a href=\"#client\" class=\"headerlink\" title=\"client\"></a>client</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        EventSource es = <span class=\"keyword\">new</span> EventSource();</span><br><span class=\"line\"><span class=\"comment\">//        new ThisEscape(es);</span></span><br><span class=\"line\">        SafeListener.newInstance(es);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h5><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-ThisEscape/java-ThisEscape-02.png\">\n<blockquote>\n<p></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p></p>\n</blockquote>","more":"<hr>\n<h4 id=\"this\"><a href=\"#this\" class=\"headerlink\" title=\"this\"></a>this</h4><p>ThisEscape<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThisEscape</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name = <span class=\"keyword\">null</span>;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThisEscape</span><span class=\"params\">(EventSource source)</span> </span>&#123;  </span><br><span class=\"line\">        source.registerListener(<span class=\"keyword\">new</span> EventListener() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onEvent</span><span class=\"params\">(Event event)</span> </span>&#123;  </span><br><span class=\"line\">                doSomething(event);  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//registerListenerlistener.onEvent</span></span><br><span class=\"line\">        <span class=\"comment\">//onEventdosomethingname</span></span><br><span class=\"line\">        <span class=\"comment\">//name.toStringthis</span></span><br><span class=\"line\">        name = <span class=\"string\">\"TEST\"</span>;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> event </span></span><br><span class=\"line\"><span class=\"comment\">     */</span>  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">(Event event)</span> </span>&#123;  </span><br><span class=\"line\">        System.out.println(name.toString());  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"EventListener\"><a href=\"#EventListener\" class=\"headerlink\" title=\"EventListener\"></a>EventListener</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.awt.Event; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">EventListener</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onEvent</span><span class=\"params\">(Event event)</span></span>;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"EventSource\"><a href=\"#EventSource\" class=\"headerlink\" title=\"EventSource\"></a>EventSource</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventSource</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerListener</span><span class=\"params\">(EventListener listener)</span> </span>&#123;  </span><br><span class=\"line\">        listener.onEvent(<span class=\"keyword\">null</span>);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"main\"><a href=\"#main\" class=\"headerlink\" title=\"main\"></a>main</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> InterruptedException </span></span><br><span class=\"line\"><span class=\"comment\">     */</span>  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;  </span><br><span class=\"line\">        EventSource es = <span class=\"keyword\">new</span> EventSource();  </span><br><span class=\"line\">        <span class=\"keyword\">new</span> ThisEscape(es);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h5><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-ThisEscape/java-ThisEscape-01.png\">\n<blockquote>\n<p>nameThisEscapethisnew EventListener(){}classclassclassthisthis</p>\n</blockquote>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><blockquote>\n<p></p>\n</blockquote>\n<h5 id=\"SafeListener\"><a href=\"#SafeListener\" class=\"headerlink\" title=\"SafeListener\"></a>SafeListener</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SafeListener</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"comment\">//final,</span></span><br><span class=\"line\">    <span class=\"comment\">//EventListener,</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> EventListener listener;  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String              name = <span class=\"keyword\">null</span>;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">SafeListener</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        listener = <span class=\"keyword\">new</span> EventListener() &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onEvent</span><span class=\"params\">(Event event)</span> </span>&#123;  </span><br><span class=\"line\">                doSomething();  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">        &#125;;  </span><br><span class=\"line\">        name = <span class=\"string\">\"TEST\"</span>;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SafeListener <span class=\"title\">newInstance</span><span class=\"params\">(EventSource eventSource)</span> </span>&#123;  </span><br><span class=\"line\">        SafeListener safeListener = <span class=\"keyword\">new</span> SafeListener();  </span><br><span class=\"line\">        eventSource.registerListener(safeListener.listener);  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> safeListener;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        System.out.println(name.toString());  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"client\"><a href=\"#client\" class=\"headerlink\" title=\"client\"></a>client</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        EventSource es = <span class=\"keyword\">new</span> EventSource();</span><br><span class=\"line\"><span class=\"comment\">//        new ThisEscape(es);</span></span><br><span class=\"line\">        SafeListener.newInstance(es);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h5><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-ThisEscape/java-ThisEscape-02.png\">\n<blockquote>\n<p></p>\n</blockquote>"},{"title":"IdentityHashmap","date":"2018-04-30T09:10:06.000Z","copyright":true,"_content":"\n{% cq %}\nIdentityHashmap\n{% endcq %}\n\n<!-- more -->\n\n\n### **IdentityHashMap **\n\n{% qnimg /java-IdentityHashmap/java-IdentityHashmap01.png %}\n### **IdentityHashMap **\n\n{% qnimg /java-IdentityHashmap/java-IdentityHashmap02.png %}\n\n\n### **IdentityHashMap**\n\n- \n{% codeblock lang:java %}\n@Test\npublic void testIdentityHashMap(){\n   String xanderXu = new String(\"XanderXu\");\n   \n   Map<String, Object> identityHashMap = new IdentityHashMap<>();\n   identityHashMap.put(new String(\"XanderXu\"),\"666\");\n   identityHashMap.put(new String(\"XanderXu\"),\"777\");\n   identityHashMap.put(xanderXu, \"xiaofei\");\n   identityHashMap.put(xanderXu, \"xiaofei--2\");\n\n   System.out.println(identityHashMap);\n}\n{% endcodeblock %}\n\n- \n{% codeblock lang:java %}\n{XanderXu=666, XanderXu=xiaofei--2, XanderXu=777}\n{% endcodeblock %}\n> IdentityHashMapIdentityHashMapHashMap,MapIdentitHashMapHashMapIdentitHashMap\"equals\"truekey,\"==\"truekey\n\n### **IdentityHashMap **\n{% codeblock lang:java %}\n\n/**\n * \n */\nprivate static final int DEFAULT_CAPACITY = 32;\n\n/**\n * \n */\nprivate static final int MINIMUM_CAPACITY = 4;\n\n/**\n * \n */\nprivate static final int MAXIMUM_CAPACITY = 1 << 29;\n\n/**\n * \n */\ntransient Object[] table; // non-private to simplify nested class access\n\n/**\n * \n */\nint size;\n\n/**\n * ,\n */\ntransient int modCount;\n\n/**\n * NULL\n */\nstatic final Object NULL_KEY = new Object();\n{% endcodeblock %}\n> IdentityHashMapObject,32(init),,null(putnullnull)\n\n\n### ****\n\n- init\n{% codeblock lang:java %}\nprivate void init(int initCapacity) {\n    // assert (initCapacity & -initCapacity) == initCapacity; // power of 2\n    // assert initCapacity >= MINIMUM_CAPACITY;\n    // assert initCapacity <= MAXIMUM_CAPACITY;    \n    table = new Object[2 * initCapacity];\n}\n{% endcodeblock %}\n> IdentityHashMapkeyvalue(table),32642\n\n\n- hash\n{% codeblock lang:java %}\nprivate static int hash(Object x, int length) {\n    int h = System.identityHashCode(x);\n    // Multiply by -127, and left-shift to use least bit as part of hash\n    return ((h << 1) - (h << 8)) & (length - 1);\n}\n{% endcodeblock %}\n> identityHashCodeNative,hashlength2n,1key\n\n- nextKeyIndex\n{% codeblock lang:java %}\nprivate static int nextKeyIndex(int i, int len) {\n    return (i + 2 < len ? i + 2 : 0);\n}\n{% endcodeblock %}\n> key\n\n- resize\n{% codeblock lang:java %}\nprivate boolean resize(int newCapacity) {\n    // assert (newCapacity & -newCapacity) == newCapacity; // power of 2\n    int newLength = newCapacity * 2;\n\n    Object[] oldTable = table;\n    int oldLength = oldTable.length;\n    if (oldLength == 2 * MAXIMUM_CAPACITY) { // can't expand any further\n        if (size == MAXIMUM_CAPACITY - 1)\n            throw new IllegalStateException(\"Capacity exhausted.\");\n        return false;\n    }\n    if (oldLength >= newLength)\n        return false;\n\n    Object[] newTable = new Object[newLength];\n\n    for (int j = 0; j < oldLength; j += 2) {\n        Object key = oldTable[j];\n        if (key != null) {\n            Object value = oldTable[j+1];\n            oldTable[j] = null;\n            oldTable[j+1] = null;\n            int i = hash(key, newLength);\n            while (newTable[i] != null)\n                i = nextKeyIndex(i, newLength);\n            newTable[i] = key;\n            newTable[i + 1] = value;\n        }\n    }\n    table = newTable;\n    return true;\n}\n{% endcodeblock %}\n> ,hashtable\n\n\n- put\n{% codeblock lang:java %}\npublic V put(K key, V value) {\n    final Object k = maskNull(key);\n\n    retryAfterResize: for (;;) {\n        final Object[] tab = table;\n        final int len = tab.length;\n        int i = hash(k, len);\n\n        for (Object item; (item = tab[i]) != null;\n             i = nextKeyIndex(i, len)) {\n            if (item == k) {\n                @SuppressWarnings(\"unchecked\")\n                    V oldValue = (V) tab[i + 1];\n                tab[i + 1] = value;\n                return oldValue;\n            }\n        }\n\n        final int s = size + 1;\n        // Use optimized form of 3 * s.\n        // Next capacity is len, 2 * current capacity.\n        if (s + (s << 1) > len && resize(len))\n            continue retryAfterResize;\n\n        modCount++;\n        tab[i] = k;\n        tab[i + 1] = value;\n        size = s;\n        return null;\n    }\n}\n{% endcodeblock %}\n> hashkeyvaluekeynull(NULL_KEY)\n> table[i]null(i)\n> s + (s << 1) = s + (s * 2) = s(1=2) = 3s > len,\n\n- get\n{% codeblock lang:java %}\n@SuppressWarnings(\"unchecked\")\npublic V get(Object key) {\n    Object k = maskNull(key);\n    Object[] tab = table;\n    int len = tab.length;\n    int i = hash(k, len);\n    while (true) {\n        Object item = tab[i];\n        if (item == k)\n            return (V) tab[i + 1];\n        if (item == null)\n            return null;\n        i = nextKeyIndex(i, len);\n    }\n}\n{% endcodeblock %}\n> keynull,keykeykeynull\n\n\n\n- closeDeletion\n{% codeblock lang:java %}\nprivate void closeDeletion(int d) {\n    // Adapted from Knuth Section 6.4 Algorithm R\n    Object[] tab = table;\n    int len = tab.length;\n\n    // Look for items to swap into newly vacated slot\n    // starting at index immediately following deletion,\n    // and continuing until a null slot is seen, indicating\n    // the end of a run of possibly-colliding keys.\n    Object item;\n    for (int i = nextKeyIndex(d, len); (item = tab[i]) != null;\n         i = nextKeyIndex(i, len) ) {\n        // The following test triggers if the item at slot i (which\n        // hashes to be at slot r) should take the spot vacated by d.\n        // If so, we swap it in, and then continue with d now at the\n        // newly vacated i.  This process will terminate when we hit\n        // the null slot at the end of this run.\n        // The test is messy because we are using a circular table.\n        int r = hash(item, len);\n        if ((i < r && (r <= d || d <= i)) || (r <= d && d <= i)) {\n            tab[d] = item;\n            tab[d + 1] = tab[i + 1];\n            tab[i] = null;\n            tab[i + 1] = null;\n            d = i;\n        }\n    }\n}   \n{% endcodeblock %}\n> ,,keyifkeyhash,\n\n\n\n- remove\n{% codeblock lang:java %}\npublic V remove(Object key) {\n    Object k = maskNull(key);\n    Object[] tab = table;\n    int len = tab.length;\n    int i = hash(k, len);\n\n    while (true) {\n        Object item = tab[i];\n        if (item == k) {\n            modCount++;\n            size--;\n            @SuppressWarnings(\"unchecked\")\n                V oldValue = (V) tab[i + 1];\n            tab[i + 1] = null;\n            tab[i] = null;\n            closeDeletion(i);\n            return oldValue;\n        }\n        if (item == null)\n            return null;\n        i = nextKeyIndex(i, len);\n    }\n}\n{% endcodeblock %}\n> keyhash,key,closeDeletion\n\n\n\n### ****\n\n> 1IdentityHashMap nullnullMap \n  2IdentityHashMap null\n  3IdentityHashMap  32 \n  4IdentityHashMap map\n","source":"_posts/java-IdentityHashmap.md","raw":"---\ntitle: IdentityHashmap\ndate: 2018-04-30 17:10:06\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n\n{% cq %}\nIdentityHashmap\n{% endcq %}\n\n<!-- more -->\n\n\n### **IdentityHashMap **\n\n{% qnimg /java-IdentityHashmap/java-IdentityHashmap01.png %}\n### **IdentityHashMap **\n\n{% qnimg /java-IdentityHashmap/java-IdentityHashmap02.png %}\n\n\n### **IdentityHashMap**\n\n- \n{% codeblock lang:java %}\n@Test\npublic void testIdentityHashMap(){\n   String xanderXu = new String(\"XanderXu\");\n   \n   Map<String, Object> identityHashMap = new IdentityHashMap<>();\n   identityHashMap.put(new String(\"XanderXu\"),\"666\");\n   identityHashMap.put(new String(\"XanderXu\"),\"777\");\n   identityHashMap.put(xanderXu, \"xiaofei\");\n   identityHashMap.put(xanderXu, \"xiaofei--2\");\n\n   System.out.println(identityHashMap);\n}\n{% endcodeblock %}\n\n- \n{% codeblock lang:java %}\n{XanderXu=666, XanderXu=xiaofei--2, XanderXu=777}\n{% endcodeblock %}\n> IdentityHashMapIdentityHashMapHashMap,MapIdentitHashMapHashMapIdentitHashMap\"equals\"truekey,\"==\"truekey\n\n### **IdentityHashMap **\n{% codeblock lang:java %}\n\n/**\n * \n */\nprivate static final int DEFAULT_CAPACITY = 32;\n\n/**\n * \n */\nprivate static final int MINIMUM_CAPACITY = 4;\n\n/**\n * \n */\nprivate static final int MAXIMUM_CAPACITY = 1 << 29;\n\n/**\n * \n */\ntransient Object[] table; // non-private to simplify nested class access\n\n/**\n * \n */\nint size;\n\n/**\n * ,\n */\ntransient int modCount;\n\n/**\n * NULL\n */\nstatic final Object NULL_KEY = new Object();\n{% endcodeblock %}\n> IdentityHashMapObject,32(init),,null(putnullnull)\n\n\n### ****\n\n- init\n{% codeblock lang:java %}\nprivate void init(int initCapacity) {\n    // assert (initCapacity & -initCapacity) == initCapacity; // power of 2\n    // assert initCapacity >= MINIMUM_CAPACITY;\n    // assert initCapacity <= MAXIMUM_CAPACITY;    \n    table = new Object[2 * initCapacity];\n}\n{% endcodeblock %}\n> IdentityHashMapkeyvalue(table),32642\n\n\n- hash\n{% codeblock lang:java %}\nprivate static int hash(Object x, int length) {\n    int h = System.identityHashCode(x);\n    // Multiply by -127, and left-shift to use least bit as part of hash\n    return ((h << 1) - (h << 8)) & (length - 1);\n}\n{% endcodeblock %}\n> identityHashCodeNative,hashlength2n,1key\n\n- nextKeyIndex\n{% codeblock lang:java %}\nprivate static int nextKeyIndex(int i, int len) {\n    return (i + 2 < len ? i + 2 : 0);\n}\n{% endcodeblock %}\n> key\n\n- resize\n{% codeblock lang:java %}\nprivate boolean resize(int newCapacity) {\n    // assert (newCapacity & -newCapacity) == newCapacity; // power of 2\n    int newLength = newCapacity * 2;\n\n    Object[] oldTable = table;\n    int oldLength = oldTable.length;\n    if (oldLength == 2 * MAXIMUM_CAPACITY) { // can't expand any further\n        if (size == MAXIMUM_CAPACITY - 1)\n            throw new IllegalStateException(\"Capacity exhausted.\");\n        return false;\n    }\n    if (oldLength >= newLength)\n        return false;\n\n    Object[] newTable = new Object[newLength];\n\n    for (int j = 0; j < oldLength; j += 2) {\n        Object key = oldTable[j];\n        if (key != null) {\n            Object value = oldTable[j+1];\n            oldTable[j] = null;\n            oldTable[j+1] = null;\n            int i = hash(key, newLength);\n            while (newTable[i] != null)\n                i = nextKeyIndex(i, newLength);\n            newTable[i] = key;\n            newTable[i + 1] = value;\n        }\n    }\n    table = newTable;\n    return true;\n}\n{% endcodeblock %}\n> ,hashtable\n\n\n- put\n{% codeblock lang:java %}\npublic V put(K key, V value) {\n    final Object k = maskNull(key);\n\n    retryAfterResize: for (;;) {\n        final Object[] tab = table;\n        final int len = tab.length;\n        int i = hash(k, len);\n\n        for (Object item; (item = tab[i]) != null;\n             i = nextKeyIndex(i, len)) {\n            if (item == k) {\n                @SuppressWarnings(\"unchecked\")\n                    V oldValue = (V) tab[i + 1];\n                tab[i + 1] = value;\n                return oldValue;\n            }\n        }\n\n        final int s = size + 1;\n        // Use optimized form of 3 * s.\n        // Next capacity is len, 2 * current capacity.\n        if (s + (s << 1) > len && resize(len))\n            continue retryAfterResize;\n\n        modCount++;\n        tab[i] = k;\n        tab[i + 1] = value;\n        size = s;\n        return null;\n    }\n}\n{% endcodeblock %}\n> hashkeyvaluekeynull(NULL_KEY)\n> table[i]null(i)\n> s + (s << 1) = s + (s * 2) = s(1=2) = 3s > len,\n\n- get\n{% codeblock lang:java %}\n@SuppressWarnings(\"unchecked\")\npublic V get(Object key) {\n    Object k = maskNull(key);\n    Object[] tab = table;\n    int len = tab.length;\n    int i = hash(k, len);\n    while (true) {\n        Object item = tab[i];\n        if (item == k)\n            return (V) tab[i + 1];\n        if (item == null)\n            return null;\n        i = nextKeyIndex(i, len);\n    }\n}\n{% endcodeblock %}\n> keynull,keykeykeynull\n\n\n\n- closeDeletion\n{% codeblock lang:java %}\nprivate void closeDeletion(int d) {\n    // Adapted from Knuth Section 6.4 Algorithm R\n    Object[] tab = table;\n    int len = tab.length;\n\n    // Look for items to swap into newly vacated slot\n    // starting at index immediately following deletion,\n    // and continuing until a null slot is seen, indicating\n    // the end of a run of possibly-colliding keys.\n    Object item;\n    for (int i = nextKeyIndex(d, len); (item = tab[i]) != null;\n         i = nextKeyIndex(i, len) ) {\n        // The following test triggers if the item at slot i (which\n        // hashes to be at slot r) should take the spot vacated by d.\n        // If so, we swap it in, and then continue with d now at the\n        // newly vacated i.  This process will terminate when we hit\n        // the null slot at the end of this run.\n        // The test is messy because we are using a circular table.\n        int r = hash(item, len);\n        if ((i < r && (r <= d || d <= i)) || (r <= d && d <= i)) {\n            tab[d] = item;\n            tab[d + 1] = tab[i + 1];\n            tab[i] = null;\n            tab[i + 1] = null;\n            d = i;\n        }\n    }\n}   \n{% endcodeblock %}\n> ,,keyifkeyhash,\n\n\n\n- remove\n{% codeblock lang:java %}\npublic V remove(Object key) {\n    Object k = maskNull(key);\n    Object[] tab = table;\n    int len = tab.length;\n    int i = hash(k, len);\n\n    while (true) {\n        Object item = tab[i];\n        if (item == k) {\n            modCount++;\n            size--;\n            @SuppressWarnings(\"unchecked\")\n                V oldValue = (V) tab[i + 1];\n            tab[i + 1] = null;\n            tab[i] = null;\n            closeDeletion(i);\n            return oldValue;\n        }\n        if (item == null)\n            return null;\n        i = nextKeyIndex(i, len);\n    }\n}\n{% endcodeblock %}\n> keyhash,key,closeDeletion\n\n\n\n### ****\n\n> 1IdentityHashMap nullnullMap \n  2IdentityHashMap null\n  3IdentityHashMap  32 \n  4IdentityHashMap map\n","slug":"java-IdentityHashmap","published":1,"updated":"2018-10-11T11:25:07.193Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6c000dm9cgfml9vzv9","content":"<blockquote class=\"blockquote-center\"><p>IdentityHashmap</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-IdentityHashmap/java-IdentityHashmap01.png\">\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-IdentityHashmap/java-IdentityHashmap02.png\">\n<h3 id=\"IdentityHashMap\"><a href=\"#IdentityHashMap\" class=\"headerlink\" title=\"IdentityHashMap\"></a><strong>IdentityHashMap</strong></h3><ul>\n<li><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testIdentityHashMap</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">   String xanderXu = <span class=\"keyword\">new</span> String(<span class=\"string\">\"XanderXu\"</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   Map&lt;String, Object&gt; identityHashMap = <span class=\"keyword\">new</span> IdentityHashMap&lt;&gt;();</span><br><span class=\"line\">   identityHashMap.put(<span class=\"keyword\">new</span> String(<span class=\"string\">\"XanderXu\"</span>),<span class=\"string\">\"666\"</span>);</span><br><span class=\"line\">   identityHashMap.put(<span class=\"keyword\">new</span> String(<span class=\"string\">\"XanderXu\"</span>),<span class=\"string\">\"777\"</span>);</span><br><span class=\"line\">   identityHashMap.put(xanderXu, <span class=\"string\">\"xiaofei\"</span>);</span><br><span class=\"line\">   identityHashMap.put(xanderXu, <span class=\"string\">\"xiaofei--2\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   System.out.println(identityHashMap);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;XanderXu=<span class=\"number\">666</span>, XanderXu=xiaofei--<span class=\"number\">2</span>, XanderXu=<span class=\"number\">777</span>&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>IdentityHashMapIdentityHashMapHashMap,MapIdentitHashMapHashMapIdentitHashMapequalstruekey,==truekey</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DEFAULT_CAPACITY = <span class=\"number\">32</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MINIMUM_CAPACITY = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAXIMUM_CAPACITY = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">29</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Object[] table; <span class=\"comment\">// non-private to simplify nested class access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ,</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"keyword\">int</span> modCount;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * NULL</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object NULL_KEY = <span class=\"keyword\">new</span> Object();</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>IdentityHashMapObject,32(init),,null(putnullnull)</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><ul>\n<li>init<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">(<span class=\"keyword\">int</span> initCapacity)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert (initCapacity &amp; -initCapacity) == initCapacity; // power of 2</span></span><br><span class=\"line\">    <span class=\"comment\">// assert initCapacity &gt;= MINIMUM_CAPACITY;</span></span><br><span class=\"line\">    <span class=\"comment\">// assert initCapacity &lt;= MAXIMUM_CAPACITY;    </span></span><br><span class=\"line\">    table = <span class=\"keyword\">new</span> Object[<span class=\"number\">2</span> * initCapacity];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>IdentityHashMapkeyvalue(table),32642</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li><p>hash</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">hash</span><span class=\"params\">(Object x, <span class=\"keyword\">int</span> length)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = System.identityHashCode(x);</span><br><span class=\"line\">    <span class=\"comment\">// Multiply by -127, and left-shift to use least bit as part of hash</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ((h &lt;&lt; <span class=\"number\">1</span>) - (h &lt;&lt; <span class=\"number\">8</span>)) &amp; (length - <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>identityHashCodeNative,hashlength2n,1key</p>\n</blockquote>\n</li>\n<li><p>nextKeyIndex</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">nextKeyIndex</span><span class=\"params\">(<span class=\"keyword\">int</span> i, <span class=\"keyword\">int</span> len)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (i + <span class=\"number\">2</span> &lt; len ? i + <span class=\"number\">2</span> : <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>key</p>\n</blockquote>\n</li>\n<li><p>resize</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">resize</span><span class=\"params\">(<span class=\"keyword\">int</span> newCapacity)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert (newCapacity &amp; -newCapacity) == newCapacity; // power of 2</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> newLength = newCapacity * <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    Object[] oldTable = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldLength = oldTable.length;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldLength == <span class=\"number\">2</span> * MAXIMUM_CAPACITY) &#123; <span class=\"comment\">// can't expand any further</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == MAXIMUM_CAPACITY - <span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">\"Capacity exhausted.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldLength &gt;= newLength)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    Object[] newTable = <span class=\"keyword\">new</span> Object[newLength];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; oldLength; j += <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        Object key = oldTable[j];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (key != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            Object value = oldTable[j+<span class=\"number\">1</span>];</span><br><span class=\"line\">            oldTable[j] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            oldTable[j+<span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> i = hash(key, newLength);</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (newTable[i] != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                i = nextKeyIndex(i, newLength);</span><br><span class=\"line\">            newTable[i] = key;</span><br><span class=\"line\">            newTable[i + <span class=\"number\">1</span>] = value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    table = newTable;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,hashtable</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li><p>put</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Object k = maskNull(key);</span><br><span class=\"line\"></span><br><span class=\"line\">    retryAfterResize: <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Object[] tab = table;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = hash(k, len);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object item; (item = tab[i]) != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">             i = nextKeyIndex(i, len)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (item == k) &#123;</span><br><span class=\"line\">                <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\">                    V oldValue = (V) tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">                tab[i + <span class=\"number\">1</span>] = value;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> s = size + <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"comment\">// Use optimized form of 3 * s.</span></span><br><span class=\"line\">        <span class=\"comment\">// Next capacity is len, 2 * current capacity.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s + (s &lt;&lt; <span class=\"number\">1</span>) &gt; len &amp;&amp; resize(len))</span><br><span class=\"line\">            <span class=\"keyword\">continue</span> retryAfterResize;</span><br><span class=\"line\"></span><br><span class=\"line\">        modCount++;</span><br><span class=\"line\">        tab[i] = k;</span><br><span class=\"line\">        tab[i + <span class=\"number\">1</span>] = value;</span><br><span class=\"line\">        size = s;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>hashkeyvaluekeynull(NULL_KEY)<br>table[i]null(i)<br>s + (s &lt;&lt; 1) = s + (s * 2) = s(1=2) = 3s &gt; len,</p>\n</blockquote>\n</li>\n<li><p>get</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    Object[] tab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = hash(k, len);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">        Object item = tab[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == k)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (V) tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        i = nextKeyIndex(i, len);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>keynull,keykeykeynull</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>closeDeletion<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">closeDeletion</span><span class=\"params\">(<span class=\"keyword\">int</span> d)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Adapted from Knuth Section 6.4 Algorithm R</span></span><br><span class=\"line\">    Object[] tab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Look for items to swap into newly vacated slot</span></span><br><span class=\"line\">    <span class=\"comment\">// starting at index immediately following deletion,</span></span><br><span class=\"line\">    <span class=\"comment\">// and continuing until a null slot is seen, indicating</span></span><br><span class=\"line\">    <span class=\"comment\">// the end of a run of possibly-colliding keys.</span></span><br><span class=\"line\">    Object item;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = nextKeyIndex(d, len); (item = tab[i]) != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">         i = nextKeyIndex(i, len) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// The following test triggers if the item at slot i (which</span></span><br><span class=\"line\">        <span class=\"comment\">// hashes to be at slot r) should take the spot vacated by d.</span></span><br><span class=\"line\">        <span class=\"comment\">// If so, we swap it in, and then continue with d now at the</span></span><br><span class=\"line\">        <span class=\"comment\">// newly vacated i.  This process will terminate when we hit</span></span><br><span class=\"line\">        <span class=\"comment\">// the null slot at the end of this run.</span></span><br><span class=\"line\">        <span class=\"comment\">// The test is messy because we are using a circular table.</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> r = hash(item, len);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((i &lt; r &amp;&amp; (r &lt;= d || d &lt;= i)) || (r &lt;= d &amp;&amp; d &lt;= i)) &#123;</span><br><span class=\"line\">            tab[d] = item;</span><br><span class=\"line\">            tab[d + <span class=\"number\">1</span>] = tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">            tab[i] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            tab[i + <span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            d = i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;   </span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,,keyifkeyhash,</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>remove<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    Object[] tab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = hash(k, len);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">        Object item = tab[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == k) &#123;</span><br><span class=\"line\">            modCount++;</span><br><span class=\"line\">            size--;</span><br><span class=\"line\">            <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\">                V oldValue = (V) tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">            tab[i + <span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            tab[i] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            closeDeletion(i);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        i = nextKeyIndex(i, len);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>keyhash,key,closeDeletion</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><blockquote>\n<p>1IdentityHashMap nullnullMap<br>  2IdentityHashMap null<br>  3IdentityHashMap  32 <br>  4IdentityHashMap map</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>IdentityHashmap</p>\n</blockquote>","more":"<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-IdentityHashmap/java-IdentityHashmap01.png\">\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-IdentityHashmap/java-IdentityHashmap02.png\">\n<h3 id=\"IdentityHashMap\"><a href=\"#IdentityHashMap\" class=\"headerlink\" title=\"IdentityHashMap\"></a><strong>IdentityHashMap</strong></h3><ul>\n<li><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testIdentityHashMap</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">   String xanderXu = <span class=\"keyword\">new</span> String(<span class=\"string\">\"XanderXu\"</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   Map&lt;String, Object&gt; identityHashMap = <span class=\"keyword\">new</span> IdentityHashMap&lt;&gt;();</span><br><span class=\"line\">   identityHashMap.put(<span class=\"keyword\">new</span> String(<span class=\"string\">\"XanderXu\"</span>),<span class=\"string\">\"666\"</span>);</span><br><span class=\"line\">   identityHashMap.put(<span class=\"keyword\">new</span> String(<span class=\"string\">\"XanderXu\"</span>),<span class=\"string\">\"777\"</span>);</span><br><span class=\"line\">   identityHashMap.put(xanderXu, <span class=\"string\">\"xiaofei\"</span>);</span><br><span class=\"line\">   identityHashMap.put(xanderXu, <span class=\"string\">\"xiaofei--2\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   System.out.println(identityHashMap);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;XanderXu=<span class=\"number\">666</span>, XanderXu=xiaofei--<span class=\"number\">2</span>, XanderXu=<span class=\"number\">777</span>&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>IdentityHashMapIdentityHashMapHashMap,MapIdentitHashMapHashMapIdentitHashMapequalstruekey,==truekey</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DEFAULT_CAPACITY = <span class=\"number\">32</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MINIMUM_CAPACITY = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAXIMUM_CAPACITY = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">29</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Object[] table; <span class=\"comment\">// non-private to simplify nested class access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ,</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"keyword\">int</span> modCount;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * NULL</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object NULL_KEY = <span class=\"keyword\">new</span> Object();</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>IdentityHashMapObject,32(init),,null(putnullnull)</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><ul>\n<li>init<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">(<span class=\"keyword\">int</span> initCapacity)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert (initCapacity &amp; -initCapacity) == initCapacity; // power of 2</span></span><br><span class=\"line\">    <span class=\"comment\">// assert initCapacity &gt;= MINIMUM_CAPACITY;</span></span><br><span class=\"line\">    <span class=\"comment\">// assert initCapacity &lt;= MAXIMUM_CAPACITY;    </span></span><br><span class=\"line\">    table = <span class=\"keyword\">new</span> Object[<span class=\"number\">2</span> * initCapacity];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>IdentityHashMapkeyvalue(table),32642</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li><p>hash</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">hash</span><span class=\"params\">(Object x, <span class=\"keyword\">int</span> length)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = System.identityHashCode(x);</span><br><span class=\"line\">    <span class=\"comment\">// Multiply by -127, and left-shift to use least bit as part of hash</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ((h &lt;&lt; <span class=\"number\">1</span>) - (h &lt;&lt; <span class=\"number\">8</span>)) &amp; (length - <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>identityHashCodeNative,hashlength2n,1key</p>\n</blockquote>\n</li>\n<li><p>nextKeyIndex</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">nextKeyIndex</span><span class=\"params\">(<span class=\"keyword\">int</span> i, <span class=\"keyword\">int</span> len)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (i + <span class=\"number\">2</span> &lt; len ? i + <span class=\"number\">2</span> : <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>key</p>\n</blockquote>\n</li>\n<li><p>resize</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">resize</span><span class=\"params\">(<span class=\"keyword\">int</span> newCapacity)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert (newCapacity &amp; -newCapacity) == newCapacity; // power of 2</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> newLength = newCapacity * <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    Object[] oldTable = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldLength = oldTable.length;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldLength == <span class=\"number\">2</span> * MAXIMUM_CAPACITY) &#123; <span class=\"comment\">// can't expand any further</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == MAXIMUM_CAPACITY - <span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">\"Capacity exhausted.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldLength &gt;= newLength)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    Object[] newTable = <span class=\"keyword\">new</span> Object[newLength];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; oldLength; j += <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        Object key = oldTable[j];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (key != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            Object value = oldTable[j+<span class=\"number\">1</span>];</span><br><span class=\"line\">            oldTable[j] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            oldTable[j+<span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> i = hash(key, newLength);</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (newTable[i] != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                i = nextKeyIndex(i, newLength);</span><br><span class=\"line\">            newTable[i] = key;</span><br><span class=\"line\">            newTable[i + <span class=\"number\">1</span>] = value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    table = newTable;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,hashtable</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li><p>put</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Object k = maskNull(key);</span><br><span class=\"line\"></span><br><span class=\"line\">    retryAfterResize: <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Object[] tab = table;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = hash(k, len);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object item; (item = tab[i]) != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">             i = nextKeyIndex(i, len)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (item == k) &#123;</span><br><span class=\"line\">                <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\">                    V oldValue = (V) tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">                tab[i + <span class=\"number\">1</span>] = value;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> s = size + <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"comment\">// Use optimized form of 3 * s.</span></span><br><span class=\"line\">        <span class=\"comment\">// Next capacity is len, 2 * current capacity.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s + (s &lt;&lt; <span class=\"number\">1</span>) &gt; len &amp;&amp; resize(len))</span><br><span class=\"line\">            <span class=\"keyword\">continue</span> retryAfterResize;</span><br><span class=\"line\"></span><br><span class=\"line\">        modCount++;</span><br><span class=\"line\">        tab[i] = k;</span><br><span class=\"line\">        tab[i + <span class=\"number\">1</span>] = value;</span><br><span class=\"line\">        size = s;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>hashkeyvaluekeynull(NULL_KEY)<br>table[i]null(i)<br>s + (s &lt;&lt; 1) = s + (s * 2) = s(1=2) = 3s &gt; len,</p>\n</blockquote>\n</li>\n<li><p>get</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    Object[] tab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = hash(k, len);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">        Object item = tab[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == k)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (V) tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        i = nextKeyIndex(i, len);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>keynull,keykeykeynull</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>closeDeletion<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">closeDeletion</span><span class=\"params\">(<span class=\"keyword\">int</span> d)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Adapted from Knuth Section 6.4 Algorithm R</span></span><br><span class=\"line\">    Object[] tab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Look for items to swap into newly vacated slot</span></span><br><span class=\"line\">    <span class=\"comment\">// starting at index immediately following deletion,</span></span><br><span class=\"line\">    <span class=\"comment\">// and continuing until a null slot is seen, indicating</span></span><br><span class=\"line\">    <span class=\"comment\">// the end of a run of possibly-colliding keys.</span></span><br><span class=\"line\">    Object item;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = nextKeyIndex(d, len); (item = tab[i]) != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">         i = nextKeyIndex(i, len) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// The following test triggers if the item at slot i (which</span></span><br><span class=\"line\">        <span class=\"comment\">// hashes to be at slot r) should take the spot vacated by d.</span></span><br><span class=\"line\">        <span class=\"comment\">// If so, we swap it in, and then continue with d now at the</span></span><br><span class=\"line\">        <span class=\"comment\">// newly vacated i.  This process will terminate when we hit</span></span><br><span class=\"line\">        <span class=\"comment\">// the null slot at the end of this run.</span></span><br><span class=\"line\">        <span class=\"comment\">// The test is messy because we are using a circular table.</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> r = hash(item, len);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((i &lt; r &amp;&amp; (r &lt;= d || d &lt;= i)) || (r &lt;= d &amp;&amp; d &lt;= i)) &#123;</span><br><span class=\"line\">            tab[d] = item;</span><br><span class=\"line\">            tab[d + <span class=\"number\">1</span>] = tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">            tab[i] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            tab[i + <span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            d = i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;   </span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,,keyifkeyhash,</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>remove<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    Object[] tab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = hash(k, len);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">        Object item = tab[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == k) &#123;</span><br><span class=\"line\">            modCount++;</span><br><span class=\"line\">            size--;</span><br><span class=\"line\">            <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\">                V oldValue = (V) tab[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">            tab[i + <span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            tab[i] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            closeDeletion(i);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        i = nextKeyIndex(i, len);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>keyhash,key,closeDeletion</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><blockquote>\n<p>1IdentityHashMap nullnullMap<br>  2IdentityHashMap null<br>  3IdentityHashMap  32 <br>  4IdentityHashMap map</p>\n</blockquote>"},{"title":"AQSReentrantLock-Condition","date":"2018-10-29T07:53:09.000Z","copyright":true,"_content":"{% cq %} \njavadoopCondition\n{% endcq %}\n<!-- more -->\n\n* * *\n\n#### ReentrantLockCondition \n> \n\n\n#### ConditionDoug Lea \n```java\nimport java.util.concurrent.locks.Condition;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\nclass BoundedBuffer {\n    final Lock lock = new ReentrantLock();\n    // condition  lock \n    final Condition notFull = lock.newCondition();\n    final Condition notEmpty = lock.newCondition();\n\n    final Object[] items = new Object[100];\n    int putptr, takeptr, count;\n\n    // \n    public void put(Object x) throws InterruptedException {\n        lock.lock();\n        try {\n            while (count == items.length)\n                notFull.await();  //  not full \n            items[putptr] = x;\n            if (++putptr == items.length) putptr = 0;\n            ++count;\n            notEmpty.signal(); //  not empty \n        } finally {\n            lock.unlock();\n        }\n    }\n\n    // \n    public Object take() throws InterruptedException {\n        lock.lock();\n        try {\n            while (count == 0)\n                notEmpty.await(); //  not empty\n            Object x = items[takeptr];\n            if (++takeptr == items.length) takeptr = 0;\n            --count;\n            notFull.signal(); //  not full \n            return x;\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n```\n\n* * *\n\n#### \n\n##### await:\n```java\n//  awaitUninterruptibly()\n//  signal  signal()  signalAll()\npublic final void await() throws InterruptedException {\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    //  condition \n    Node node = addConditionWaiter();\n    //  state \n    int savedState = fullyRelease(node);\n    int interruptMode = 0;\n    // \n    // 1. isOnSyncQueue(node)  true node \n    // 2. checkInterruptWhileWaiting(node) != 0  break\n    while (!isOnSyncQueue(node)) {\n        LockSupport.park(this);\n        if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)\n            break;\n    }\n    // \n    if (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n        interruptMode = REINTERRUPT;\n    if (node.nextWaiter != null) // clean up if cancelled\n        unlinkCancelledWaiters();\n    if (interruptMode != 0)\n        reportInterruptAfterWait(interruptMode);\n}\n```\n> ,fullyRelease(node)ReentrantLockAQSrelease()\n> releaseunparkSuccessor(h)unpark,unpark\n> forparkawaitsingle\n> parkunparkpark\n\n##### addConditionWaiter:\n```java\n// \nprivate Node addConditionWaiter() {\n    Node t = lastWaiter;\n    // \n    if (t != null && t.waitStatus != Node.CONDITION) {\n        // \n        unlinkCancelledWaiters();\n        t = lastWaiter;\n    }\n    Node node = new Node(Thread.currentThread(), Node.CONDITION);\n    // \n    if (t == null)\n        firstWaiter = node;\n    else\n        t.nextWaiter = node;\n    lastWaiter = node;\n    return node;\n}\n```\n\n\n##### unlinkCancelledWaiters()\n```java\n// \n// \nprivate void unlinkCancelledWaiters() {\n    Node t = firstWaiter;\n    Node trail = null;\n    while (t != null) {\n        Node next = t.nextWaiter;\n        //  Node.CONDITION \n        if (t.waitStatus != Node.CONDITION) {\n            t.nextWaiter = null;\n            if (trail == null)\n                firstWaiter = next;\n            else\n                trail.nextWaiter = next;\n            if (next == null)\n                lastWaiter = trail;\n        }\n        else\n            trail = t;\n        t = next;\n    }\n}\n```\n\n##### fullyRelease\n```java\n//  savedState  release  state \n//  lock.lock() condition1.await()\n//          state  1  0 1\n//          lock  n savedState == n\n// \"\" IllegalMonitorStateException\nfinal int fullyRelease(Node node) {\n    boolean failed = true;\n    try {\n        int savedState = getState();\n        //  state  release  state  0\n        if (release(savedState)) {\n            failed = false;\n            return savedState;\n        } else {\n            throw new IllegalMonitorStateException();\n        }\n    } finally {\n        if (failed)\n            node.waitStatus = Node.CANCELLED;\n    }\n}\n```\n\n##### isOnSyncQueue:\n```java\n//  waitStatus = Node.CONDITION\n// signal \n//  node \nfinal boolean isOnSyncQueue(Node node) {\n    // node  waitStatus  0 signal \n    //  waitStatus  Node.CONDITION -2\n    //  node  prev  null \n    if (node.waitStatus == Node.CONDITION || node.prev == null)\n        return false;\n    //  node  next \n    if (node.next != null) \n        return true;\n\n    // \n\n    //  node.prev() != null  node \n    //  AQS  node.prev  tail\n    //  CAS  tail CAS \n\n    // \n    return findNodeFromTail(node);\n}\n\n//  true\nprivate boolean findNodeFromTail(Node node) {\n    Node t = tail;\n    for (;;) {\n        if (t == node)\n            return true;\n        if (t == null)\n            return false;\n        t = t.prev;\n    }\n}\n```\n\n##### signal\n```java\n// \n//  node \npublic final void signal() {\n    //  signal \n    if (!isHeldExclusively())\n        throw new IllegalMonitorStateException();\n    Node first = firstWaiter;\n    if (first != null)\n        doSignal(first);\n}\n\n//  node\n// \nprivate void doSignal(Node first) {\n    do {\n          //  firstWaiter  first \n        //  lastWaiter  null\n        if ( (firstWaiter = first.nextWaiter) == null)\n            lastWaiter = null;\n        //  first \n        first.nextWaiter = null;\n    } while (!transferForSignal(first) &&\n             (first = firstWaiter) != null);\n      //  while  first  first \n}\n\n// \n// true \n// false  signal \nfinal boolean transferForSignal(Node node) {\n\n    // CAS  node  waitStatus  Node.CONDITION\n    // \n    //  waitStatus  0\n    if (!compareAndSetWaitStatus(node, Node.CONDITION, 0))\n        return false;\n\n    // enq(node): \n    //  p  node \n    Node p = enq(node);\n    int ws = p.waitStatus;\n    // ws > 0  node  node \n    //  ws <= 0,  compareAndSetWaitStatus  Node.SIGNAL(-1)\n    if (ws > 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))\n        //  CAS \n        LockSupport.unpark(node.thread);\n    return true;\n}\n```\n> ws > 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL) ws <= 0 compareAndSetWaitStatus(p, ws, Node.SIGNAL)  true if  node  true signal \n\n CAS \n\n##### checkInterruptWhileWaiting\n>  interruptModeinterruptMode  REINTERRUPT1THROW_IE-10\n- REINTERRUPT  await \n- THROW_IE  await  InterruptedException \n- 0  await \n>  LockSupport.park(this); \n- signal ->  -> unpark\n-  park \n- signal CAS\n-  Object.wait() \n>  checkInterruptWhileWaiting(node)  signal  signal \n```java\n// 1.  signal  THROW_IE\n// 2.  signal  REINTERRUPT\n// 3.  0\nprivate int checkInterruptWhileWaiting(Node node) {\n    return Thread.interrupted() ?\n        (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :\n        0;\n}\n```\n> Thread.interrupted() true false REINTERRUPT \n\n signal \n```java\n// \n// \n//  true signal \nfinal boolean transferAfterCancelledWait(Node node) {\n    //  CAS  0 \n    //  CAS  signal  signal signal  waitStatus  0\n    if (compareAndSetWaitStatus(node, Node.CONDITION, 0)) {\n        // \n        // \n        enq(node);\n        return true;\n    }\n\n    //  CAS  signal  waitStatus  0\n    // signal \n    // signal \n    while (!isOnSyncQueue(node))\n        Thread.yield();\n    return false;\n}\n```\n> \n\n#### \nwhile\n```java\nif (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n    interruptMode = REINTERRUPT;\n```\n>  while \n>  acquireQueued(node, savedState)  node  enq(node)  savedState  state state == savedState\n>  acquireQueued(node, savedState)  true interruptMode != THROW_IE signal  interruptMode  REINTERRUPT\n\n\n```java\nif (node.nextWaiter != null) // clean up if cancelled\n    unlinkCancelledWaiters();\n```\n> node.nextWaiter != null  signal  node.nextWaiter = null\n>  signal   signal  node.nextWaiter = null \n>  unlinkCancelledWaiters \n\n:\n```java\nif (interruptMode != 0)\n    reportInterruptAfterWait(interruptMode);\n```\nreportInterruptAfterWait:\n```java\nprivate void reportInterruptAfterWait(int interruptMode)\n    throws InterruptedException {\n    if (interruptMode == THROW_IE)\n        throw new InterruptedException();\n    else if (interruptMode == REINTERRUPT)\n        selfInterrupt();\n}\n```\n> interruptMode\n- 0\n- THROW_IEawait  InterruptedException \n- REINTERRUPT\n> THROW_IE singlewaitstatus0\n> REINTERRUPTsinglecheckInterruptWhileWaiting(Node node)Thread.interrupted()\n","source":"_posts/java-AQS-02.md","raw":"---\ntitle: AQSReentrantLock-Condition\ndate: 2018-10-29 15:53:09\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n{% cq %} \njavadoopCondition\n{% endcq %}\n<!-- more -->\n\n* * *\n\n#### ReentrantLockCondition \n> \n\n\n#### ConditionDoug Lea \n```java\nimport java.util.concurrent.locks.Condition;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\nclass BoundedBuffer {\n    final Lock lock = new ReentrantLock();\n    // condition  lock \n    final Condition notFull = lock.newCondition();\n    final Condition notEmpty = lock.newCondition();\n\n    final Object[] items = new Object[100];\n    int putptr, takeptr, count;\n\n    // \n    public void put(Object x) throws InterruptedException {\n        lock.lock();\n        try {\n            while (count == items.length)\n                notFull.await();  //  not full \n            items[putptr] = x;\n            if (++putptr == items.length) putptr = 0;\n            ++count;\n            notEmpty.signal(); //  not empty \n        } finally {\n            lock.unlock();\n        }\n    }\n\n    // \n    public Object take() throws InterruptedException {\n        lock.lock();\n        try {\n            while (count == 0)\n                notEmpty.await(); //  not empty\n            Object x = items[takeptr];\n            if (++takeptr == items.length) takeptr = 0;\n            --count;\n            notFull.signal(); //  not full \n            return x;\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n```\n\n* * *\n\n#### \n\n##### await:\n```java\n//  awaitUninterruptibly()\n//  signal  signal()  signalAll()\npublic final void await() throws InterruptedException {\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    //  condition \n    Node node = addConditionWaiter();\n    //  state \n    int savedState = fullyRelease(node);\n    int interruptMode = 0;\n    // \n    // 1. isOnSyncQueue(node)  true node \n    // 2. checkInterruptWhileWaiting(node) != 0  break\n    while (!isOnSyncQueue(node)) {\n        LockSupport.park(this);\n        if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)\n            break;\n    }\n    // \n    if (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n        interruptMode = REINTERRUPT;\n    if (node.nextWaiter != null) // clean up if cancelled\n        unlinkCancelledWaiters();\n    if (interruptMode != 0)\n        reportInterruptAfterWait(interruptMode);\n}\n```\n> ,fullyRelease(node)ReentrantLockAQSrelease()\n> releaseunparkSuccessor(h)unpark,unpark\n> forparkawaitsingle\n> parkunparkpark\n\n##### addConditionWaiter:\n```java\n// \nprivate Node addConditionWaiter() {\n    Node t = lastWaiter;\n    // \n    if (t != null && t.waitStatus != Node.CONDITION) {\n        // \n        unlinkCancelledWaiters();\n        t = lastWaiter;\n    }\n    Node node = new Node(Thread.currentThread(), Node.CONDITION);\n    // \n    if (t == null)\n        firstWaiter = node;\n    else\n        t.nextWaiter = node;\n    lastWaiter = node;\n    return node;\n}\n```\n\n\n##### unlinkCancelledWaiters()\n```java\n// \n// \nprivate void unlinkCancelledWaiters() {\n    Node t = firstWaiter;\n    Node trail = null;\n    while (t != null) {\n        Node next = t.nextWaiter;\n        //  Node.CONDITION \n        if (t.waitStatus != Node.CONDITION) {\n            t.nextWaiter = null;\n            if (trail == null)\n                firstWaiter = next;\n            else\n                trail.nextWaiter = next;\n            if (next == null)\n                lastWaiter = trail;\n        }\n        else\n            trail = t;\n        t = next;\n    }\n}\n```\n\n##### fullyRelease\n```java\n//  savedState  release  state \n//  lock.lock() condition1.await()\n//          state  1  0 1\n//          lock  n savedState == n\n// \"\" IllegalMonitorStateException\nfinal int fullyRelease(Node node) {\n    boolean failed = true;\n    try {\n        int savedState = getState();\n        //  state  release  state  0\n        if (release(savedState)) {\n            failed = false;\n            return savedState;\n        } else {\n            throw new IllegalMonitorStateException();\n        }\n    } finally {\n        if (failed)\n            node.waitStatus = Node.CANCELLED;\n    }\n}\n```\n\n##### isOnSyncQueue:\n```java\n//  waitStatus = Node.CONDITION\n// signal \n//  node \nfinal boolean isOnSyncQueue(Node node) {\n    // node  waitStatus  0 signal \n    //  waitStatus  Node.CONDITION -2\n    //  node  prev  null \n    if (node.waitStatus == Node.CONDITION || node.prev == null)\n        return false;\n    //  node  next \n    if (node.next != null) \n        return true;\n\n    // \n\n    //  node.prev() != null  node \n    //  AQS  node.prev  tail\n    //  CAS  tail CAS \n\n    // \n    return findNodeFromTail(node);\n}\n\n//  true\nprivate boolean findNodeFromTail(Node node) {\n    Node t = tail;\n    for (;;) {\n        if (t == node)\n            return true;\n        if (t == null)\n            return false;\n        t = t.prev;\n    }\n}\n```\n\n##### signal\n```java\n// \n//  node \npublic final void signal() {\n    //  signal \n    if (!isHeldExclusively())\n        throw new IllegalMonitorStateException();\n    Node first = firstWaiter;\n    if (first != null)\n        doSignal(first);\n}\n\n//  node\n// \nprivate void doSignal(Node first) {\n    do {\n          //  firstWaiter  first \n        //  lastWaiter  null\n        if ( (firstWaiter = first.nextWaiter) == null)\n            lastWaiter = null;\n        //  first \n        first.nextWaiter = null;\n    } while (!transferForSignal(first) &&\n             (first = firstWaiter) != null);\n      //  while  first  first \n}\n\n// \n// true \n// false  signal \nfinal boolean transferForSignal(Node node) {\n\n    // CAS  node  waitStatus  Node.CONDITION\n    // \n    //  waitStatus  0\n    if (!compareAndSetWaitStatus(node, Node.CONDITION, 0))\n        return false;\n\n    // enq(node): \n    //  p  node \n    Node p = enq(node);\n    int ws = p.waitStatus;\n    // ws > 0  node  node \n    //  ws <= 0,  compareAndSetWaitStatus  Node.SIGNAL(-1)\n    if (ws > 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))\n        //  CAS \n        LockSupport.unpark(node.thread);\n    return true;\n}\n```\n> ws > 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL) ws <= 0 compareAndSetWaitStatus(p, ws, Node.SIGNAL)  true if  node  true signal \n\n CAS \n\n##### checkInterruptWhileWaiting\n>  interruptModeinterruptMode  REINTERRUPT1THROW_IE-10\n- REINTERRUPT  await \n- THROW_IE  await  InterruptedException \n- 0  await \n>  LockSupport.park(this); \n- signal ->  -> unpark\n-  park \n- signal CAS\n-  Object.wait() \n>  checkInterruptWhileWaiting(node)  signal  signal \n```java\n// 1.  signal  THROW_IE\n// 2.  signal  REINTERRUPT\n// 3.  0\nprivate int checkInterruptWhileWaiting(Node node) {\n    return Thread.interrupted() ?\n        (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :\n        0;\n}\n```\n> Thread.interrupted() true false REINTERRUPT \n\n signal \n```java\n// \n// \n//  true signal \nfinal boolean transferAfterCancelledWait(Node node) {\n    //  CAS  0 \n    //  CAS  signal  signal signal  waitStatus  0\n    if (compareAndSetWaitStatus(node, Node.CONDITION, 0)) {\n        // \n        // \n        enq(node);\n        return true;\n    }\n\n    //  CAS  signal  waitStatus  0\n    // signal \n    // signal \n    while (!isOnSyncQueue(node))\n        Thread.yield();\n    return false;\n}\n```\n> \n\n#### \nwhile\n```java\nif (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n    interruptMode = REINTERRUPT;\n```\n>  while \n>  acquireQueued(node, savedState)  node  enq(node)  savedState  state state == savedState\n>  acquireQueued(node, savedState)  true interruptMode != THROW_IE signal  interruptMode  REINTERRUPT\n\n\n```java\nif (node.nextWaiter != null) // clean up if cancelled\n    unlinkCancelledWaiters();\n```\n> node.nextWaiter != null  signal  node.nextWaiter = null\n>  signal   signal  node.nextWaiter = null \n>  unlinkCancelledWaiters \n\n:\n```java\nif (interruptMode != 0)\n    reportInterruptAfterWait(interruptMode);\n```\nreportInterruptAfterWait:\n```java\nprivate void reportInterruptAfterWait(int interruptMode)\n    throws InterruptedException {\n    if (interruptMode == THROW_IE)\n        throw new InterruptedException();\n    else if (interruptMode == REINTERRUPT)\n        selfInterrupt();\n}\n```\n> interruptMode\n- 0\n- THROW_IEawait  InterruptedException \n- REINTERRUPT\n> THROW_IE singlewaitstatus0\n> REINTERRUPTsinglecheckInterruptWhileWaiting(Node node)Thread.interrupted()\n","slug":"java-AQS-02","published":1,"updated":"2018-10-29T07:53:56.909Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6d000em9cg63zpfq9k","content":"<blockquote class=\"blockquote-center\"><p>javadoopCondition</p>\n</blockquote>\n<a id=\"more\"></a>\n<hr>\n<h4 id=\"ReentrantLockCondition-\"><a href=\"#ReentrantLockCondition-\" class=\"headerlink\" title=\"ReentrantLockCondition \"></a>ReentrantLockCondition </h4><blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"ConditionDoug-Lea-\"><a href=\"#ConditionDoug-Lea-\" class=\"headerlink\" title=\"ConditionDoug Lea \"></a>ConditionDoug Lea </h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Condition;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BoundedBuffer</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock();</span><br><span class=\"line\">    <span class=\"comment\">// condition  lock </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Condition notFull = lock.newCondition();</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Condition notEmpty = lock.newCondition();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Object[] items = <span class=\"keyword\">new</span> Object[<span class=\"number\">100</span>];</span><br><span class=\"line\">    <span class=\"keyword\">int</span> putptr, takeptr, count;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">put</span><span class=\"params\">(Object x)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (count == items.length)</span><br><span class=\"line\">                notFull.await();  <span class=\"comment\">//  not full </span></span><br><span class=\"line\">            items[putptr] = x;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (++putptr == items.length) putptr = <span class=\"number\">0</span>;</span><br><span class=\"line\">            ++count;</span><br><span class=\"line\">            notEmpty.signal(); <span class=\"comment\">//  not empty </span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">take</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (count == <span class=\"number\">0</span>)</span><br><span class=\"line\">                notEmpty.await(); <span class=\"comment\">//  not empty</span></span><br><span class=\"line\">            Object x = items[takeptr];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (++takeptr == items.length) takeptr = <span class=\"number\">0</span>;</span><br><span class=\"line\">            --count;</span><br><span class=\"line\">            notFull.signal(); <span class=\"comment\">//  not full </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"await\"><a href=\"#await\" class=\"headerlink\" title=\"await:\"></a>await:</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  awaitUninterruptibly()</span></span><br><span class=\"line\"><span class=\"comment\">//  signal  signal()  signalAll()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">await</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Thread.interrupted())</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</span><br><span class=\"line\">    <span class=\"comment\">//  condition </span></span><br><span class=\"line\">    Node node = addConditionWaiter();</span><br><span class=\"line\">    <span class=\"comment\">//  state </span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> savedState = fullyRelease(node);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> interruptMode = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// 1. isOnSyncQueue(node)  true node </span></span><br><span class=\"line\">    <span class=\"comment\">// 2. checkInterruptWhileWaiting(node) != 0  break</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!isOnSyncQueue(node)) &#123;</span><br><span class=\"line\">        LockSupport.park(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((interruptMode = checkInterruptWhileWaiting(node)) != <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class=\"line\">        interruptMode = REINTERRUPT;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node.nextWaiter != <span class=\"keyword\">null</span>) <span class=\"comment\">// clean up if cancelled</span></span><br><span class=\"line\">        unlinkCancelledWaiters();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (interruptMode != <span class=\"number\">0</span>)</span><br><span class=\"line\">        reportInterruptAfterWait(interruptMode);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,fullyRelease(node)ReentrantLockAQSrelease()<br>releaseunparkSuccessor(h)unpark,unpark<br>forparkawaitsingle<br>parkunparkpark</p>\n</blockquote>\n<h5 id=\"addConditionWaiter\"><a href=\"#addConditionWaiter\" class=\"headerlink\" title=\"addConditionWaiter:\"></a>addConditionWaiter:</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Node <span class=\"title\">addConditionWaiter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Node t = lastWaiter;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span> &amp;&amp; t.waitStatus != Node.CONDITION) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        unlinkCancelledWaiters();</span><br><span class=\"line\">        t = lastWaiter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Node node = <span class=\"keyword\">new</span> Node(Thread.currentThread(), Node.CONDITION);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (t == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        firstWaiter = node;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        t.nextWaiter = node;</span><br><span class=\"line\">    lastWaiter = node;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"unlinkCancelledWaiters-\"><a href=\"#unlinkCancelledWaiters-\" class=\"headerlink\" title=\"unlinkCancelledWaiters()\"></a>unlinkCancelledWaiters()</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">unlinkCancelledWaiters</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Node t = firstWaiter;</span><br><span class=\"line\">    Node trail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (t != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        Node next = t.nextWaiter;</span><br><span class=\"line\">        <span class=\"comment\">//  Node.CONDITION </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t.waitStatus != Node.CONDITION) &#123;</span><br><span class=\"line\">            t.nextWaiter = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (trail == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                firstWaiter = next;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                trail.nextWaiter = next;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (next == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                lastWaiter = trail;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            trail = t;</span><br><span class=\"line\">        t = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"fullyRelease\"><a href=\"#fullyRelease\" class=\"headerlink\" title=\"fullyRelease\"></a>fullyRelease</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  savedState  release  state </span></span><br><span class=\"line\"><span class=\"comment\">//  lock.lock() condition1.await()</span></span><br><span class=\"line\"><span class=\"comment\">//          state  1  0 1</span></span><br><span class=\"line\"><span class=\"comment\">//          lock  n savedState == n</span></span><br><span class=\"line\"><span class=\"comment\">// \"\" IllegalMonitorStateException</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">fullyRelease</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> failed = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> savedState = getState();</span><br><span class=\"line\">        <span class=\"comment\">//  state  release  state  0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (release(savedState)) &#123;</span><br><span class=\"line\">            failed = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> savedState;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalMonitorStateException();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (failed)</span><br><span class=\"line\">            node.waitStatus = Node.CANCELLED;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"isOnSyncQueue\"><a href=\"#isOnSyncQueue\" class=\"headerlink\" title=\"isOnSyncQueue:\"></a>isOnSyncQueue:</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  waitStatus = Node.CONDITION</span></span><br><span class=\"line\"><span class=\"comment\">// signal </span></span><br><span class=\"line\"><span class=\"comment\">//  node </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isOnSyncQueue</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// node  waitStatus  0 signal </span></span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus  Node.CONDITION -2</span></span><br><span class=\"line\">    <span class=\"comment\">//  node  prev  null </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node.waitStatus == Node.CONDITION || node.prev == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">//  node  next </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node.next != <span class=\"keyword\">null</span>) </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  node.prev() != null  node </span></span><br><span class=\"line\">    <span class=\"comment\">//  AQS  node.prev  tail</span></span><br><span class=\"line\">    <span class=\"comment\">//  CAS  tail CAS </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> findNodeFromTail(node);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  true</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">findNodeFromTail</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    Node t = tail;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == node)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        t = t.prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"signal\"><a href=\"#signal\" class=\"headerlink\" title=\"signal\"></a>signal</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//  node </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">signal</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//  signal </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isHeldExclusively())</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalMonitorStateException();</span><br><span class=\"line\">    Node first = firstWaiter;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (first != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        doSignal(first);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  node</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doSignal</span><span class=\"params\">(Node first)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">//  firstWaiter  first </span></span><br><span class=\"line\">        <span class=\"comment\">//  lastWaiter  null</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( (firstWaiter = first.nextWaiter) == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            lastWaiter = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//  first </span></span><br><span class=\"line\">        first.nextWaiter = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (!transferForSignal(first) &amp;&amp;</span><br><span class=\"line\">             (first = firstWaiter) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">      <span class=\"comment\">//  while  first  first </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// true </span></span><br><span class=\"line\"><span class=\"comment\">// false  signal </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">transferForSignal</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// CAS  node  waitStatus  Node.CONDITION</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus  0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!compareAndSetWaitStatus(node, Node.CONDITION, <span class=\"number\">0</span>))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// enq(node): </span></span><br><span class=\"line\">    <span class=\"comment\">//  p  node </span></span><br><span class=\"line\">    Node p = enq(node);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ws = p.waitStatus;</span><br><span class=\"line\">    <span class=\"comment\">// ws &gt; 0  node  node </span></span><br><span class=\"line\">    <span class=\"comment\">//  ws &lt;= 0,  compareAndSetWaitStatus  Node.SIGNAL(-1)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ws &gt; <span class=\"number\">0</span> || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))</span><br><span class=\"line\">        <span class=\"comment\">//  CAS </span></span><br><span class=\"line\">        LockSupport.unpark(node.thread);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL) ws &lt;= 0 compareAndSetWaitStatus(p, ws, Node.SIGNAL)  true if  node  true signal </p>\n</blockquote>\n<p> CAS </p>\n<h5 id=\"checkInterruptWhileWaiting\"><a href=\"#checkInterruptWhileWaiting\" class=\"headerlink\" title=\"checkInterruptWhileWaiting\"></a>checkInterruptWhileWaiting</h5><blockquote>\n<p> interruptModeinterruptMode  REINTERRUPT1THROW_IE-10</p>\n<ul>\n<li>REINTERRUPT  await </li>\n<li>THROW_IE  await  InterruptedException </li>\n<li>0  await <br> LockSupport.park(this); </li>\n<li>signal -&gt;  -&gt; unpark</li>\n<li> park </li>\n<li>signal CAS</li>\n<li> Object.wait() <br> checkInterruptWhileWaiting(node)  signal  signal <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.  signal  THROW_IE</span></span><br><span class=\"line\"><span class=\"comment\">// 2.  signal  REINTERRUPT</span></span><br><span class=\"line\"><span class=\"comment\">// 3.  0</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">checkInterruptWhileWaiting</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Thread.interrupted() ?</span><br><span class=\"line\">        (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :</span><br><span class=\"line\">        <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>Thread.interrupted() true false REINTERRUPT </p>\n</blockquote>\n<p> signal <br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//  true signal </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">transferAfterCancelledWait</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//  CAS  0 </span></span><br><span class=\"line\">    <span class=\"comment\">//  CAS  signal  signal signal  waitStatus  0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (compareAndSetWaitStatus(node, Node.CONDITION, <span class=\"number\">0</span>)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        enq(node);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  CAS  signal  waitStatus  0</span></span><br><span class=\"line\">    <span class=\"comment\">// signal </span></span><br><span class=\"line\">    <span class=\"comment\">// signal </span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!isOnSyncQueue(node))</span><br><span class=\"line\">        Thread.yield();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>while<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class=\"line\">    interruptMode = REINTERRUPT;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p> while <br> acquireQueued(node, savedState)  node  enq(node)  savedState  state state == savedState<br> acquireQueued(node, savedState)  true interruptMode != THROW_IE signal  interruptMode  REINTERRUPT</p>\n</blockquote>\n<p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (node.nextWaiter != <span class=\"keyword\">null</span>) <span class=\"comment\">// clean up if cancelled</span></span><br><span class=\"line\">    unlinkCancelledWaiters();</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>node.nextWaiter != null  signal  node.nextWaiter = null<br> signal   signal  node.nextWaiter = null <br> unlinkCancelledWaiters </p>\n</blockquote>\n<p>:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (interruptMode != <span class=\"number\">0</span>)</span><br><span class=\"line\">    reportInterruptAfterWait(interruptMode);</span><br></pre></td></tr></table></figure></p>\n<p>reportInterruptAfterWait:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">reportInterruptAfterWait</span><span class=\"params\">(<span class=\"keyword\">int</span> interruptMode)</span></span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (interruptMode == THROW_IE)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (interruptMode == REINTERRUPT)</span><br><span class=\"line\">        selfInterrupt();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>interruptMode</p>\n<ul>\n<li>0</li>\n<li>THROW_IEawait  InterruptedException </li>\n<li>REINTERRUPT<br>THROW_IE singlewaitstatus0<br>REINTERRUPTsinglecheckInterruptWhileWaiting(Node node)Thread.interrupted()</li>\n</ul>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>javadoopCondition</p>\n</blockquote>","more":"<hr>\n<h4 id=\"ReentrantLockCondition-\"><a href=\"#ReentrantLockCondition-\" class=\"headerlink\" title=\"ReentrantLockCondition \"></a>ReentrantLockCondition </h4><blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"ConditionDoug-Lea-\"><a href=\"#ConditionDoug-Lea-\" class=\"headerlink\" title=\"ConditionDoug Lea \"></a>ConditionDoug Lea </h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Condition;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BoundedBuffer</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock();</span><br><span class=\"line\">    <span class=\"comment\">// condition  lock </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Condition notFull = lock.newCondition();</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Condition notEmpty = lock.newCondition();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Object[] items = <span class=\"keyword\">new</span> Object[<span class=\"number\">100</span>];</span><br><span class=\"line\">    <span class=\"keyword\">int</span> putptr, takeptr, count;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">put</span><span class=\"params\">(Object x)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (count == items.length)</span><br><span class=\"line\">                notFull.await();  <span class=\"comment\">//  not full </span></span><br><span class=\"line\">            items[putptr] = x;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (++putptr == items.length) putptr = <span class=\"number\">0</span>;</span><br><span class=\"line\">            ++count;</span><br><span class=\"line\">            notEmpty.signal(); <span class=\"comment\">//  not empty </span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">take</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (count == <span class=\"number\">0</span>)</span><br><span class=\"line\">                notEmpty.await(); <span class=\"comment\">//  not empty</span></span><br><span class=\"line\">            Object x = items[takeptr];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (++takeptr == items.length) takeptr = <span class=\"number\">0</span>;</span><br><span class=\"line\">            --count;</span><br><span class=\"line\">            notFull.signal(); <span class=\"comment\">//  not full </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"await\"><a href=\"#await\" class=\"headerlink\" title=\"await:\"></a>await:</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  awaitUninterruptibly()</span></span><br><span class=\"line\"><span class=\"comment\">//  signal  signal()  signalAll()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">await</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Thread.interrupted())</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</span><br><span class=\"line\">    <span class=\"comment\">//  condition </span></span><br><span class=\"line\">    Node node = addConditionWaiter();</span><br><span class=\"line\">    <span class=\"comment\">//  state </span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> savedState = fullyRelease(node);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> interruptMode = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// 1. isOnSyncQueue(node)  true node </span></span><br><span class=\"line\">    <span class=\"comment\">// 2. checkInterruptWhileWaiting(node) != 0  break</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!isOnSyncQueue(node)) &#123;</span><br><span class=\"line\">        LockSupport.park(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((interruptMode = checkInterruptWhileWaiting(node)) != <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class=\"line\">        interruptMode = REINTERRUPT;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node.nextWaiter != <span class=\"keyword\">null</span>) <span class=\"comment\">// clean up if cancelled</span></span><br><span class=\"line\">        unlinkCancelledWaiters();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (interruptMode != <span class=\"number\">0</span>)</span><br><span class=\"line\">        reportInterruptAfterWait(interruptMode);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,fullyRelease(node)ReentrantLockAQSrelease()<br>releaseunparkSuccessor(h)unpark,unpark<br>forparkawaitsingle<br>parkunparkpark</p>\n</blockquote>\n<h5 id=\"addConditionWaiter\"><a href=\"#addConditionWaiter\" class=\"headerlink\" title=\"addConditionWaiter:\"></a>addConditionWaiter:</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Node <span class=\"title\">addConditionWaiter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Node t = lastWaiter;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span> &amp;&amp; t.waitStatus != Node.CONDITION) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        unlinkCancelledWaiters();</span><br><span class=\"line\">        t = lastWaiter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Node node = <span class=\"keyword\">new</span> Node(Thread.currentThread(), Node.CONDITION);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (t == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        firstWaiter = node;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        t.nextWaiter = node;</span><br><span class=\"line\">    lastWaiter = node;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"unlinkCancelledWaiters-\"><a href=\"#unlinkCancelledWaiters-\" class=\"headerlink\" title=\"unlinkCancelledWaiters()\"></a>unlinkCancelledWaiters()</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">unlinkCancelledWaiters</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Node t = firstWaiter;</span><br><span class=\"line\">    Node trail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (t != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        Node next = t.nextWaiter;</span><br><span class=\"line\">        <span class=\"comment\">//  Node.CONDITION </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t.waitStatus != Node.CONDITION) &#123;</span><br><span class=\"line\">            t.nextWaiter = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (trail == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                firstWaiter = next;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                trail.nextWaiter = next;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (next == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                lastWaiter = trail;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            trail = t;</span><br><span class=\"line\">        t = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"fullyRelease\"><a href=\"#fullyRelease\" class=\"headerlink\" title=\"fullyRelease\"></a>fullyRelease</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  savedState  release  state </span></span><br><span class=\"line\"><span class=\"comment\">//  lock.lock() condition1.await()</span></span><br><span class=\"line\"><span class=\"comment\">//          state  1  0 1</span></span><br><span class=\"line\"><span class=\"comment\">//          lock  n savedState == n</span></span><br><span class=\"line\"><span class=\"comment\">// \"\" IllegalMonitorStateException</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">fullyRelease</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> failed = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> savedState = getState();</span><br><span class=\"line\">        <span class=\"comment\">//  state  release  state  0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (release(savedState)) &#123;</span><br><span class=\"line\">            failed = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> savedState;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalMonitorStateException();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (failed)</span><br><span class=\"line\">            node.waitStatus = Node.CANCELLED;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"isOnSyncQueue\"><a href=\"#isOnSyncQueue\" class=\"headerlink\" title=\"isOnSyncQueue:\"></a>isOnSyncQueue:</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  waitStatus = Node.CONDITION</span></span><br><span class=\"line\"><span class=\"comment\">// signal </span></span><br><span class=\"line\"><span class=\"comment\">//  node </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isOnSyncQueue</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// node  waitStatus  0 signal </span></span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus  Node.CONDITION -2</span></span><br><span class=\"line\">    <span class=\"comment\">//  node  prev  null </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node.waitStatus == Node.CONDITION || node.prev == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">//  node  next </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node.next != <span class=\"keyword\">null</span>) </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  node.prev() != null  node </span></span><br><span class=\"line\">    <span class=\"comment\">//  AQS  node.prev  tail</span></span><br><span class=\"line\">    <span class=\"comment\">//  CAS  tail CAS </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> findNodeFromTail(node);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  true</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">findNodeFromTail</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    Node t = tail;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == node)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        t = t.prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"signal\"><a href=\"#signal\" class=\"headerlink\" title=\"signal\"></a>signal</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//  node </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">signal</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//  signal </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isHeldExclusively())</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalMonitorStateException();</span><br><span class=\"line\">    Node first = firstWaiter;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (first != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        doSignal(first);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  node</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">doSignal</span><span class=\"params\">(Node first)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">//  firstWaiter  first </span></span><br><span class=\"line\">        <span class=\"comment\">//  lastWaiter  null</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( (firstWaiter = first.nextWaiter) == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            lastWaiter = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//  first </span></span><br><span class=\"line\">        first.nextWaiter = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (!transferForSignal(first) &amp;&amp;</span><br><span class=\"line\">             (first = firstWaiter) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">      <span class=\"comment\">//  while  first  first </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// true </span></span><br><span class=\"line\"><span class=\"comment\">// false  signal </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">transferForSignal</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// CAS  node  waitStatus  Node.CONDITION</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">//  waitStatus  0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!compareAndSetWaitStatus(node, Node.CONDITION, <span class=\"number\">0</span>))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// enq(node): </span></span><br><span class=\"line\">    <span class=\"comment\">//  p  node </span></span><br><span class=\"line\">    Node p = enq(node);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ws = p.waitStatus;</span><br><span class=\"line\">    <span class=\"comment\">// ws &gt; 0  node  node </span></span><br><span class=\"line\">    <span class=\"comment\">//  ws &lt;= 0,  compareAndSetWaitStatus  Node.SIGNAL(-1)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ws &gt; <span class=\"number\">0</span> || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))</span><br><span class=\"line\">        <span class=\"comment\">//  CAS </span></span><br><span class=\"line\">        LockSupport.unpark(node.thread);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL) ws &lt;= 0 compareAndSetWaitStatus(p, ws, Node.SIGNAL)  true if  node  true signal </p>\n</blockquote>\n<p> CAS </p>\n<h5 id=\"checkInterruptWhileWaiting\"><a href=\"#checkInterruptWhileWaiting\" class=\"headerlink\" title=\"checkInterruptWhileWaiting\"></a>checkInterruptWhileWaiting</h5><blockquote>\n<p> interruptModeinterruptMode  REINTERRUPT1THROW_IE-10</p>\n<ul>\n<li>REINTERRUPT  await </li>\n<li>THROW_IE  await  InterruptedException </li>\n<li>0  await <br> LockSupport.park(this); </li>\n<li>signal -&gt;  -&gt; unpark</li>\n<li> park </li>\n<li>signal CAS</li>\n<li> Object.wait() <br> checkInterruptWhileWaiting(node)  signal  signal <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.  signal  THROW_IE</span></span><br><span class=\"line\"><span class=\"comment\">// 2.  signal  REINTERRUPT</span></span><br><span class=\"line\"><span class=\"comment\">// 3.  0</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">checkInterruptWhileWaiting</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Thread.interrupted() ?</span><br><span class=\"line\">        (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :</span><br><span class=\"line\">        <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>Thread.interrupted() true false REINTERRUPT </p>\n</blockquote>\n<p> signal <br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//  true signal </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">transferAfterCancelledWait</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//  CAS  0 </span></span><br><span class=\"line\">    <span class=\"comment\">//  CAS  signal  signal signal  waitStatus  0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (compareAndSetWaitStatus(node, Node.CONDITION, <span class=\"number\">0</span>)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        enq(node);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  CAS  signal  waitStatus  0</span></span><br><span class=\"line\">    <span class=\"comment\">// signal </span></span><br><span class=\"line\">    <span class=\"comment\">// signal </span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!isOnSyncQueue(node))</span><br><span class=\"line\">        Thread.yield();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>while<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class=\"line\">    interruptMode = REINTERRUPT;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p> while <br> acquireQueued(node, savedState)  node  enq(node)  savedState  state state == savedState<br> acquireQueued(node, savedState)  true interruptMode != THROW_IE signal  interruptMode  REINTERRUPT</p>\n</blockquote>\n<p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (node.nextWaiter != <span class=\"keyword\">null</span>) <span class=\"comment\">// clean up if cancelled</span></span><br><span class=\"line\">    unlinkCancelledWaiters();</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>node.nextWaiter != null  signal  node.nextWaiter = null<br> signal   signal  node.nextWaiter = null <br> unlinkCancelledWaiters </p>\n</blockquote>\n<p>:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (interruptMode != <span class=\"number\">0</span>)</span><br><span class=\"line\">    reportInterruptAfterWait(interruptMode);</span><br></pre></td></tr></table></figure></p>\n<p>reportInterruptAfterWait:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">reportInterruptAfterWait</span><span class=\"params\">(<span class=\"keyword\">int</span> interruptMode)</span></span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (interruptMode == THROW_IE)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (interruptMode == REINTERRUPT)</span><br><span class=\"line\">        selfInterrupt();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>interruptMode</p>\n<ul>\n<li>0</li>\n<li>THROW_IEawait  InterruptedException </li>\n<li>REINTERRUPT<br>THROW_IE singlewaitstatus0<br>REINTERRUPTsinglecheckInterruptWhileWaiting(Node node)Thread.interrupted()</li>\n</ul>\n</blockquote>"},{"title":"EnumMap","date":"2018-04-19T06:40:09.000Z","copyright":true,"_content":"\n{% cq %} \nspringtomcatJava,\njavaEnumMap\n{% endcq %}\n\n<!-- more -->\n\n### EnumMap\n{% qnimg /java-EnumMap/java-EnumMap01.png %}\n\n\n### EnumMap\n{% qnimg /java-EnumMap/java-EnumMap02.png %}\n\n\n### \n{% codeblock lang:java %}\npublic class EnumMap<K extends Enum<K>, V> extends AbstractMap<K, V> implements java.io.Serializable, Cloneable{\n    private final Class<K> keyType;\n    private transient K[] keyUniverse;\n    private transient Object[] vals;\n    private transient int size = 0;\n}\n{% endcodeblock %}\n\n:keyTypekeyUniversevalssize\n\n\n\n### \n\n\n{% codeblock lang:java %}\n/**\n * Class\n */\npublic EnumMap(Class<K> keyType) {\n    this.keyType = keyType;\n    keyUniverse = getKeyUniverse(keyType);\n    vals = new Object[keyUniverse.length];\n}\n\n/**\n * EnumMap\n */\npublic EnumMap(EnumMap<K, ? extends V> m) {\n     keyType = m.keyType;\n     keyUniverse = m.keyUniverse;\n     vals = m.vals.clone();\n     size = m.size;\n}\n\n/**\n * Map,key\n */\npublic EnumMap(Map<K, ? extends V> m) {\n    if (m instanceof EnumMap) {\n        EnumMap<K, ? extends V> em = (EnumMap<K, ? extends V>) m;\n        keyType = em.keyType;\n        keyUniverse = em.keyUniverse;\n        vals = em.vals.clone();\n        size = em.size;\n    } else {\n        if (m.isEmpty())\n            throw new IllegalArgumentException(\"Specified map is empty\");\n        keyType = m.keySet().iterator().next().getDeclaringClass();\n        keyUniverse = getKeyUniverse(keyType);\n        vals = new Object[keyUniverse.length];\n        putAll(m);\n    }\n}\n{% endcodeblock %}\n\n\n### put\n{% codeblock lang:java %}\npublic V put(K key, V value) {\n    typeCheck(key);\n    int index = key.ordinal();\n    Object oldValue = vals[index];\n    vals[index] = maskNull(value);\n    if (oldValue == null)\n        size++;\n    return unmaskNull(oldValue);\n}\n\nprivate void typeCheck(K key) {\n    Class keyClass = key.getClass();\n    if (keyClass != keyType && keyClass.getSuperclass() != keyType)\n        throw new ClassCastException(keyClass + \" != \" + keyType);\n}\n\n\nprivate Object maskNull(Object value) {\n    return (value == null ? NULL : value);\n}\n\nprivate V unmaskNull(Object value) {\n    return (V) (value == NULL ? null : value);\n}\n\nprivate static final Object NULL = new Object() {\n    public int hashCode() {\n        return 0;\n    }\n    public String toString() {\n        return \"java.util.EnumMap.NULL\";\n    }\n};\n\n{% endcodeblock %}\n\n\n- typeCheckkeyEnumMap()\n- EnumMapvaluenullnullEnumMapnullNULL\n  nullmaskNullunmaskNull\n- ordinal()key(),valsvalue\n- putkeyvalue.valuevalue\n\n\n\n### get\n{% codeblock lang:java %}\npublic V get(Object key) {\n    return (isValidKey(key) ?\n            unmaskNull(vals[((Enum)key).ordinal()]) : null);\n}\n\nprivate boolean isValidKey(Object key) {\n    if (key == null)\n        return false;\n    // Cheaper than instanceof Enum followed by getDeclaringClass\n    Class keyClass = key.getClass();\n    return keyClass == keyType || keyClass.getSuperclass() == keyType;\n}\n\n{% endcodeblock %}\n\n\n- keyget\n\n### remove\n\n{% codeblock lang:java %}\npublic V remove(Object key) {\n    if (!isValidKey(key))\n        return null;\n    int index = ((Enum<?>)key).ordinal();\n    Object oldValue = vals[index];\n    vals[index] = null;\n    if (oldValue != null)\n        size--;\n    return unmaskNull(oldValue);\n}\n{% endcodeblock %}\n\n- ,keykeymapnull\n- keykeyvaluevalvaluenullmapsize1\n- NULLvalueremovekey(keyUniverse[])keyUniverse[]mapEnumMap\n- ABAkeyvaluevaluesize--keyput,size,\n\n\n\n### \n\n{% codeblock lang:java %}\nimport java.util.EnumMap;\n\npublic class Main {\n    public static void main(String[] args) {\n        EnumMap<ResultEnum, String> map = new EnumMap<ResultEnum, String>(ResultEnum.class);\n        map.put(ResultEnum.SUCCESS,\"1\");\n        map.put(ResultEnum.SUCCESS,\"2\");\n        map.put(ResultEnum.FAIL,\"3\");\n        map.put(ResultEnum.DEALING,\"4\");\n        map.put(ResultEnum.UNKNOWN,\"5\");\n        System.out.println(map);\n    }\n}\n{% endcodeblock %}\n\n:\n{% codeblock lang:java %}\n{SUCCESS=2, FAIL=3, DEALING=4, UNKNOWN=5}\n{% endcodeblock %}\n\n\n###  \nEnumMapEmumMap:EnumMap\n\nMap\n\nEnumMapEnumMapMap\n  \n### \n\n> EnumMapnull\n  EnumMap:Map<EnumKey, V> m = Collections.synchronizedMap(new EnumMap<EnumKey, V>();\n\n","source":"_posts/java-EnumMap.md","raw":"---\ntitle: EnumMap\ndate: 2018-04-19 14:40:09\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n\n{% cq %} \nspringtomcatJava,\njavaEnumMap\n{% endcq %}\n\n<!-- more -->\n\n### EnumMap\n{% qnimg /java-EnumMap/java-EnumMap01.png %}\n\n\n### EnumMap\n{% qnimg /java-EnumMap/java-EnumMap02.png %}\n\n\n### \n{% codeblock lang:java %}\npublic class EnumMap<K extends Enum<K>, V> extends AbstractMap<K, V> implements java.io.Serializable, Cloneable{\n    private final Class<K> keyType;\n    private transient K[] keyUniverse;\n    private transient Object[] vals;\n    private transient int size = 0;\n}\n{% endcodeblock %}\n\n:keyTypekeyUniversevalssize\n\n\n\n### \n\n\n{% codeblock lang:java %}\n/**\n * Class\n */\npublic EnumMap(Class<K> keyType) {\n    this.keyType = keyType;\n    keyUniverse = getKeyUniverse(keyType);\n    vals = new Object[keyUniverse.length];\n}\n\n/**\n * EnumMap\n */\npublic EnumMap(EnumMap<K, ? extends V> m) {\n     keyType = m.keyType;\n     keyUniverse = m.keyUniverse;\n     vals = m.vals.clone();\n     size = m.size;\n}\n\n/**\n * Map,key\n */\npublic EnumMap(Map<K, ? extends V> m) {\n    if (m instanceof EnumMap) {\n        EnumMap<K, ? extends V> em = (EnumMap<K, ? extends V>) m;\n        keyType = em.keyType;\n        keyUniverse = em.keyUniverse;\n        vals = em.vals.clone();\n        size = em.size;\n    } else {\n        if (m.isEmpty())\n            throw new IllegalArgumentException(\"Specified map is empty\");\n        keyType = m.keySet().iterator().next().getDeclaringClass();\n        keyUniverse = getKeyUniverse(keyType);\n        vals = new Object[keyUniverse.length];\n        putAll(m);\n    }\n}\n{% endcodeblock %}\n\n\n### put\n{% codeblock lang:java %}\npublic V put(K key, V value) {\n    typeCheck(key);\n    int index = key.ordinal();\n    Object oldValue = vals[index];\n    vals[index] = maskNull(value);\n    if (oldValue == null)\n        size++;\n    return unmaskNull(oldValue);\n}\n\nprivate void typeCheck(K key) {\n    Class keyClass = key.getClass();\n    if (keyClass != keyType && keyClass.getSuperclass() != keyType)\n        throw new ClassCastException(keyClass + \" != \" + keyType);\n}\n\n\nprivate Object maskNull(Object value) {\n    return (value == null ? NULL : value);\n}\n\nprivate V unmaskNull(Object value) {\n    return (V) (value == NULL ? null : value);\n}\n\nprivate static final Object NULL = new Object() {\n    public int hashCode() {\n        return 0;\n    }\n    public String toString() {\n        return \"java.util.EnumMap.NULL\";\n    }\n};\n\n{% endcodeblock %}\n\n\n- typeCheckkeyEnumMap()\n- EnumMapvaluenullnullEnumMapnullNULL\n  nullmaskNullunmaskNull\n- ordinal()key(),valsvalue\n- putkeyvalue.valuevalue\n\n\n\n### get\n{% codeblock lang:java %}\npublic V get(Object key) {\n    return (isValidKey(key) ?\n            unmaskNull(vals[((Enum)key).ordinal()]) : null);\n}\n\nprivate boolean isValidKey(Object key) {\n    if (key == null)\n        return false;\n    // Cheaper than instanceof Enum followed by getDeclaringClass\n    Class keyClass = key.getClass();\n    return keyClass == keyType || keyClass.getSuperclass() == keyType;\n}\n\n{% endcodeblock %}\n\n\n- keyget\n\n### remove\n\n{% codeblock lang:java %}\npublic V remove(Object key) {\n    if (!isValidKey(key))\n        return null;\n    int index = ((Enum<?>)key).ordinal();\n    Object oldValue = vals[index];\n    vals[index] = null;\n    if (oldValue != null)\n        size--;\n    return unmaskNull(oldValue);\n}\n{% endcodeblock %}\n\n- ,keykeymapnull\n- keykeyvaluevalvaluenullmapsize1\n- NULLvalueremovekey(keyUniverse[])keyUniverse[]mapEnumMap\n- ABAkeyvaluevaluesize--keyput,size,\n\n\n\n### \n\n{% codeblock lang:java %}\nimport java.util.EnumMap;\n\npublic class Main {\n    public static void main(String[] args) {\n        EnumMap<ResultEnum, String> map = new EnumMap<ResultEnum, String>(ResultEnum.class);\n        map.put(ResultEnum.SUCCESS,\"1\");\n        map.put(ResultEnum.SUCCESS,\"2\");\n        map.put(ResultEnum.FAIL,\"3\");\n        map.put(ResultEnum.DEALING,\"4\");\n        map.put(ResultEnum.UNKNOWN,\"5\");\n        System.out.println(map);\n    }\n}\n{% endcodeblock %}\n\n:\n{% codeblock lang:java %}\n{SUCCESS=2, FAIL=3, DEALING=4, UNKNOWN=5}\n{% endcodeblock %}\n\n\n###  \nEnumMapEmumMap:EnumMap\n\nMap\n\nEnumMapEnumMapMap\n  \n### \n\n> EnumMapnull\n  EnumMap:Map<EnumKey, V> m = Collections.synchronizedMap(new EnumMap<EnumKey, V>();\n\n","slug":"java-EnumMap","published":1,"updated":"2018-10-11T11:23:53.626Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6h000im9cg1ma43fkw","content":"<blockquote class=\"blockquote-center\"><p>springtomcatJava,<br>javaEnumMap</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"EnumMap\"><a href=\"#EnumMap\" class=\"headerlink\" title=\"EnumMap\"></a>EnumMap</h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-EnumMap/java-EnumMap01.png\">\n<h3 id=\"EnumMap\"><a href=\"#EnumMap\" class=\"headerlink\" title=\"EnumMap\"></a>EnumMap</h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-EnumMap/java-EnumMap02.png\">\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EnumMap</span>&lt;<span class=\"title\">K</span> <span class=\"keyword\">extends</span> <span class=\"title\">Enum</span>&lt;<span class=\"title\">K</span>&gt;, <span class=\"title\">V</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">AbstractMap</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">java</span>.<span class=\"title\">io</span>.<span class=\"title\">Serializable</span>, <span class=\"title\">Cloneable</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Class&lt;K&gt; keyType;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> K[] keyUniverse;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> Object[] vals;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">int</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:keyTypekeyUniversevalssize</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Class</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">EnumMap</span><span class=\"params\">(Class&lt;K&gt; keyType)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.keyType = keyType;</span><br><span class=\"line\">    keyUniverse = getKeyUniverse(keyType);</span><br><span class=\"line\">    vals = <span class=\"keyword\">new</span> Object[keyUniverse.length];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * EnumMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">EnumMap</span><span class=\"params\">(EnumMap&lt;K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class=\"line\">     keyType = m.keyType;</span><br><span class=\"line\">     keyUniverse = m.keyUniverse;</span><br><span class=\"line\">     vals = m.vals.clone();</span><br><span class=\"line\">     size = m.size;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map,key</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">EnumMap</span><span class=\"params\">(Map&lt;K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (m <span class=\"keyword\">instanceof</span> EnumMap) &#123;</span><br><span class=\"line\">        EnumMap&lt;K, ? extends V&gt; em = (EnumMap&lt;K, ? extends V&gt;) m;</span><br><span class=\"line\">        keyType = em.keyType;</span><br><span class=\"line\">        keyUniverse = em.keyUniverse;</span><br><span class=\"line\">        vals = em.vals.clone();</span><br><span class=\"line\">        size = em.size;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m.isEmpty())</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Specified map is empty\"</span>);</span><br><span class=\"line\">        keyType = m.keySet().iterator().next().getDeclaringClass();</span><br><span class=\"line\">        keyUniverse = getKeyUniverse(keyType);</span><br><span class=\"line\">        vals = <span class=\"keyword\">new</span> Object[keyUniverse.length];</span><br><span class=\"line\">        putAll(m);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"put\"><a href=\"#put\" class=\"headerlink\" title=\"put\"></a>put</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    typeCheck(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> index = key.ordinal();</span><br><span class=\"line\">    Object oldValue = vals[index];</span><br><span class=\"line\">    vals[index] = maskNull(value);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        size++;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unmaskNull(oldValue);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">typeCheck</span><span class=\"params\">(K key)</span> </span>&#123;</span><br><span class=\"line\">    Class keyClass = key.getClass();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (keyClass != keyType &amp;&amp; keyClass.getSuperclass() != keyType)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ClassCastException(keyClass + <span class=\"string\">\" != \"</span> + keyType);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Object <span class=\"title\">maskNull</span><span class=\"params\">(Object value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (value == <span class=\"keyword\">null</span> ? NULL : value);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> V <span class=\"title\">unmaskNull</span><span class=\"params\">(Object value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (V) (value == NULL ? <span class=\"keyword\">null</span> : value);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object NULL = <span class=\"keyword\">new</span> Object() &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"java.util.EnumMap.NULL\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>typeCheckkeyEnumMap()</li>\n<li>EnumMapvaluenullnullEnumMapnullNULL<br>nullmaskNullunmaskNull</li>\n<li>ordinal()key(),valsvalue</li>\n<li>putkeyvalue.valuevalue</li>\n</ul>\n<h3 id=\"get\"><a href=\"#get\" class=\"headerlink\" title=\"get\"></a>get</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (isValidKey(key) ?</span><br><span class=\"line\">            unmaskNull(vals[((Enum)key).ordinal()]) : <span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isValidKey</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">// Cheaper than instanceof Enum followed by getDeclaringClass</span></span><br><span class=\"line\">    Class keyClass = key.getClass();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> keyClass == keyType || keyClass.getSuperclass() == keyType;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>keyget</li>\n</ul>\n<h3 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove\"></a>remove</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isValidKey(key))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> index = ((Enum&lt;?&gt;)key).ordinal();</span><br><span class=\"line\">    Object oldValue = vals[index];</span><br><span class=\"line\">    vals[index] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldValue != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        size--;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unmaskNull(oldValue);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>,keykeymapnull</li>\n<li>keykeyvaluevalvaluenullmapsize1</li>\n<li>NULLvalueremovekey(keyUniverse[])keyUniverse[]mapEnumMap</li>\n<li>ABAkeyvaluevaluesizekeyput,size,</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.EnumMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        EnumMap&lt;ResultEnum, String&gt; map = <span class=\"keyword\">new</span> EnumMap&lt;ResultEnum, String&gt;(ResultEnum.class);</span><br><span class=\"line\">        map.put(ResultEnum.SUCCESS,<span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.SUCCESS,<span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.FAIL,<span class=\"string\">\"3\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.DEALING,<span class=\"string\">\"4\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.UNKNOWN,<span class=\"string\">\"5\"</span>);</span><br><span class=\"line\">        System.out.println(map);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;SUCCESS=<span class=\"number\">2</span>, FAIL=<span class=\"number\">3</span>, DEALING=<span class=\"number\">4</span>, UNKNOWN=<span class=\"number\">5</span>&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>EnumMapEmumMap:EnumMap</p>\n<p>Map</p>\n<p>EnumMapEnumMapMap</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>EnumMapnull<br>  EnumMap:Map&lt;EnumKey, V&gt; m = Collections.synchronizedMap(new EnumMap&lt;EnumKey, V&gt;();</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>springtomcatJava,<br>javaEnumMap</p>\n</blockquote>","more":"<h3 id=\"EnumMap\"><a href=\"#EnumMap\" class=\"headerlink\" title=\"EnumMap\"></a>EnumMap</h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-EnumMap/java-EnumMap01.png\">\n<h3 id=\"EnumMap\"><a href=\"#EnumMap\" class=\"headerlink\" title=\"EnumMap\"></a>EnumMap</h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-EnumMap/java-EnumMap02.png\">\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EnumMap</span>&lt;<span class=\"title\">K</span> <span class=\"keyword\">extends</span> <span class=\"title\">Enum</span>&lt;<span class=\"title\">K</span>&gt;, <span class=\"title\">V</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">AbstractMap</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">java</span>.<span class=\"title\">io</span>.<span class=\"title\">Serializable</span>, <span class=\"title\">Cloneable</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Class&lt;K&gt; keyType;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> K[] keyUniverse;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> Object[] vals;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">int</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:keyTypekeyUniversevalssize</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Class</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">EnumMap</span><span class=\"params\">(Class&lt;K&gt; keyType)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.keyType = keyType;</span><br><span class=\"line\">    keyUniverse = getKeyUniverse(keyType);</span><br><span class=\"line\">    vals = <span class=\"keyword\">new</span> Object[keyUniverse.length];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * EnumMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">EnumMap</span><span class=\"params\">(EnumMap&lt;K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class=\"line\">     keyType = m.keyType;</span><br><span class=\"line\">     keyUniverse = m.keyUniverse;</span><br><span class=\"line\">     vals = m.vals.clone();</span><br><span class=\"line\">     size = m.size;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map,key</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">EnumMap</span><span class=\"params\">(Map&lt;K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (m <span class=\"keyword\">instanceof</span> EnumMap) &#123;</span><br><span class=\"line\">        EnumMap&lt;K, ? extends V&gt; em = (EnumMap&lt;K, ? extends V&gt;) m;</span><br><span class=\"line\">        keyType = em.keyType;</span><br><span class=\"line\">        keyUniverse = em.keyUniverse;</span><br><span class=\"line\">        vals = em.vals.clone();</span><br><span class=\"line\">        size = em.size;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m.isEmpty())</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Specified map is empty\"</span>);</span><br><span class=\"line\">        keyType = m.keySet().iterator().next().getDeclaringClass();</span><br><span class=\"line\">        keyUniverse = getKeyUniverse(keyType);</span><br><span class=\"line\">        vals = <span class=\"keyword\">new</span> Object[keyUniverse.length];</span><br><span class=\"line\">        putAll(m);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"put\"><a href=\"#put\" class=\"headerlink\" title=\"put\"></a>put</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    typeCheck(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> index = key.ordinal();</span><br><span class=\"line\">    Object oldValue = vals[index];</span><br><span class=\"line\">    vals[index] = maskNull(value);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        size++;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unmaskNull(oldValue);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">typeCheck</span><span class=\"params\">(K key)</span> </span>&#123;</span><br><span class=\"line\">    Class keyClass = key.getClass();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (keyClass != keyType &amp;&amp; keyClass.getSuperclass() != keyType)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ClassCastException(keyClass + <span class=\"string\">\" != \"</span> + keyType);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Object <span class=\"title\">maskNull</span><span class=\"params\">(Object value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (value == <span class=\"keyword\">null</span> ? NULL : value);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> V <span class=\"title\">unmaskNull</span><span class=\"params\">(Object value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (V) (value == NULL ? <span class=\"keyword\">null</span> : value);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object NULL = <span class=\"keyword\">new</span> Object() &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"java.util.EnumMap.NULL\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>typeCheckkeyEnumMap()</li>\n<li>EnumMapvaluenullnullEnumMapnullNULL<br>nullmaskNullunmaskNull</li>\n<li>ordinal()key(),valsvalue</li>\n<li>putkeyvalue.valuevalue</li>\n</ul>\n<h3 id=\"get\"><a href=\"#get\" class=\"headerlink\" title=\"get\"></a>get</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (isValidKey(key) ?</span><br><span class=\"line\">            unmaskNull(vals[((Enum)key).ordinal()]) : <span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isValidKey</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">// Cheaper than instanceof Enum followed by getDeclaringClass</span></span><br><span class=\"line\">    Class keyClass = key.getClass();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> keyClass == keyType || keyClass.getSuperclass() == keyType;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>keyget</li>\n</ul>\n<h3 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove\"></a>remove</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isValidKey(key))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> index = ((Enum&lt;?&gt;)key).ordinal();</span><br><span class=\"line\">    Object oldValue = vals[index];</span><br><span class=\"line\">    vals[index] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldValue != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        size--;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unmaskNull(oldValue);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>,keykeymapnull</li>\n<li>keykeyvaluevalvaluenullmapsize1</li>\n<li>NULLvalueremovekey(keyUniverse[])keyUniverse[]mapEnumMap</li>\n<li>ABAkeyvaluevaluesizekeyput,size,</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.EnumMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        EnumMap&lt;ResultEnum, String&gt; map = <span class=\"keyword\">new</span> EnumMap&lt;ResultEnum, String&gt;(ResultEnum.class);</span><br><span class=\"line\">        map.put(ResultEnum.SUCCESS,<span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.SUCCESS,<span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.FAIL,<span class=\"string\">\"3\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.DEALING,<span class=\"string\">\"4\"</span>);</span><br><span class=\"line\">        map.put(ResultEnum.UNKNOWN,<span class=\"string\">\"5\"</span>);</span><br><span class=\"line\">        System.out.println(map);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;SUCCESS=<span class=\"number\">2</span>, FAIL=<span class=\"number\">3</span>, DEALING=<span class=\"number\">4</span>, UNKNOWN=<span class=\"number\">5</span>&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>EnumMapEmumMap:EnumMap</p>\n<p>Map</p>\n<p>EnumMapEnumMapMap</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>EnumMapnull<br>  EnumMap:Map&lt;EnumKey, V&gt; m = Collections.synchronizedMap(new EnumMap&lt;EnumKey, V&gt;();</p>\n</blockquote>"},{"title":"WeakHashMap","date":"2018-05-05T09:34:06.000Z","copyright":true,"_content":"\n{% cq %}\nWeakHashMap\n{% endcq %}\n\n<!-- more -->\n\n\n### **IdentityHashMap **\n{% qnimg /java-WeakHashMap/map01.png %}\n### **IdentityHashMap **\n{% qnimg /java-WeakHashMap/map02.png %}\n\n\n### \n{% codeblock lang:java %}\n/**\n * \n */\nprivate static final int DEFAULT_INITIAL_CAPACITY = 16;\n\n\n/**\n * \n */\nprivate static final int MAXIMUM_CAPACITY = 1 << 30;\n\n\n/**\n *   0.75\n */\nprivate static final float DEFAULT_LOAD_FACTOR = 0.75f;\n\n\n/**\n * Entry\n */\nEntry<K,V>[] table;\n\n\n/**\n * \n */\nprivate int size;\n\n\n/**\n * (*)\n */\nprivate int threshold;\n\n\n/**\n * \n */\nprivate final float loadFactor;\n\n\n/**\n * ,GC\n */\nprivate final ReferenceQueue<Object> queue = new ReferenceQueue<>();\n\n\n/**\n * \n */\nint modCount;\n\n{% endcodeblock %}\n\n### ****\n\n- \n{% codeblock lang:java %}\npublic WeakHashMap(int initialCapacity, float loadFactor) {\n    if (initialCapacity < 0)\n        throw new IllegalArgumentException(\"Illegal Initial Capacity: \"+\n                                           initialCapacity);\n    if (initialCapacity > MAXIMUM_CAPACITY)\n        initialCapacity = MAXIMUM_CAPACITY;\n\n    if (loadFactor <= 0 || Float.isNaN(loadFactor))\n        throw new IllegalArgumentException(\"Illegal Load factor: \"+\n                                           loadFactor);\n    int capacity = 1;\n    while (capacity < initialCapacity)\n        capacity <<= 1;\n    table = newTable(capacity);\n    this.loadFactor = loadFactor;\n    threshold = (int)(capacity * loadFactor);\n}\n{% endcodeblock %}\n>,,threshold()\n\n- put\n{% codeblock lang:java %}\npublic V put(K key, V value) {\n    Object k = maskNull(key);\n    int h = hash(k);\n    Entry<K,V>[] tab = getTable();\n    int i = indexFor(h, tab.length);\n\n    for (Entry<K,V> e = tab[i]; e != null; e = e.next) {\n        if (h == e.hash && eq(k, e.get())) {\n            V oldValue = e.value;\n            if (value != oldValue)\n                e.value = value;\n            return oldValue;\n        }\n    }\n\n    modCount++;\n    Entry<K,V> e = tab[i];\n    tab[i] = new Entry<>(k, value, queue, h, e);\n    if (++size >= threshold)\n        resize(tab.length * 2);\n    return null;\n}\n{% endcodeblock %}\n>hash,hash,Entrykeykey\n\n\n- get\n{% codeblock lang:java %}\npublic V get(Object key) {\n    Object k = maskNull(key);\n    int h = hash(k);\n    Entry<K,V>[] tab = getTable();\n    int index = indexFor(h, tab.length);\n    Entry<K,V> e = tab[index];\n    while (e != null) {\n        if (e.hash == h && eq(k, e.get()))\n            return e.value;\n        e = e.next;\n    }\n    return null;\n}\n{% endcodeblock %}\n>put,keyhash,keyvalue\n\n\n- remove\n{% codeblock lang:java %}\npublic V remove(Object key) {\n    Object k = maskNull(key);\n    int h = hash(k);\n    Entry<K,V>[] tab = getTable();\n    int i = indexFor(h, tab.length);\n    Entry<K,V> prev = tab[i];\n    Entry<K,V> e = prev;\n\n    while (e != null) {\n        Entry<K,V> next = e.next;\n        if (h == e.hash && eq(k, e.get())) {\n            modCount++;\n            size--;\n            if (prev == e)\n                tab[i] = next;\n            else\n                prev.next = next;\n            return e.value;\n        }\n        prev = e;\n        e = next;\n    }\n\n    return null;\n}\n{% endcodeblock %}\n> keyhash,key,keyprev==e keyEntrytab[i]\n\n\n- Entry\n{% codeblock lang:java %}\nprivate static class Entry<K,V> extends WeakReference<Object> implements Map.Entry<K,V> {\n    V value;\n    final int hash;\n    Entry<K,V> next;\n\n    /**\n     * Creates new entry.\n     */\n    Entry(Object key, V value,\n          ReferenceQueue<Object> queue,\n          int hash, Entry<K,V> next) {\n        super(key, queue);\n        this.value = value;\n        this.hash  = hash;\n        this.next  = next;\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    public K getKey() {\n        return (K) WeakHashMap.unmaskNull(get());\n    }\n\n    public V getValue() {\n        return value;\n    }\n\n    public V setValue(V newValue) {\n        V oldValue = value;\n        value = newValue;\n        return oldValue;\n    }\n\n    public boolean equals(Object o) {\n        if (!(o instanceof Map.Entry))\n            return false;\n        Map.Entry<?,?> e = (Map.Entry<?,?>)o;\n        K k1 = getKey();\n        Object k2 = e.getKey();\n        if (k1 == k2 || (k1 != null && k1.equals(k2))) {\n            V v1 = getValue();\n            Object v2 = e.getValue();\n            if (v1 == v2 || (v1 != null && v1.equals(v2)))\n                return true;\n        }\n        return false;\n    }\n\n    public int hashCode() {\n        K k = getKey();\n        V v = getValue();\n        return Objects.hashCode(k) ^ Objects.hashCode(v);\n    }\n\n    public String toString() {\n        return getKey() + \"=\" + getValue();\n    }\n}\n{% endcodeblock %}\n> WeakHashMapEntry,weakhashmapweakhashMap\n\n\n### ****\n> WeakHashMaphashMap,hashWeakHashMapEntryweakHashMap\n> WeakHashMap,\n\n\n### ****\n> WeakHashMapkeynull,weakhashMapremove,\n\n{% codeblock lang:java %}\n@Test\npublic void testWeakHashMap(){\n\nWeakHashMap weakHashMap = new WeakHashMap();\nString a1 = \"a1\";\nString a2 = \"a2\";\nString a3 = new String(\"a3\");\nweakHashMap.put(a1 ,\"a1\");\nweakHashMap.put(a2, \"a2\");\nweakHashMap.put(a3, \"a3\");\nSystem.out.println(weakHashMap);\n\na3 = null;\nSystem.gc();\nSystem.out.println(weakHashMap);\n}\n{% endcodeblock %}\n> String a1 = \"a1\"  a1=null, weakHashMapa1a1a1GCweakHashMap","source":"_posts/java-WeakHashMap.md","raw":"---\ntitle: WeakHashMap\ndate: 2018-05-05 17:34:06\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n\n{% cq %}\nWeakHashMap\n{% endcq %}\n\n<!-- more -->\n\n\n### **IdentityHashMap **\n{% qnimg /java-WeakHashMap/map01.png %}\n### **IdentityHashMap **\n{% qnimg /java-WeakHashMap/map02.png %}\n\n\n### \n{% codeblock lang:java %}\n/**\n * \n */\nprivate static final int DEFAULT_INITIAL_CAPACITY = 16;\n\n\n/**\n * \n */\nprivate static final int MAXIMUM_CAPACITY = 1 << 30;\n\n\n/**\n *   0.75\n */\nprivate static final float DEFAULT_LOAD_FACTOR = 0.75f;\n\n\n/**\n * Entry\n */\nEntry<K,V>[] table;\n\n\n/**\n * \n */\nprivate int size;\n\n\n/**\n * (*)\n */\nprivate int threshold;\n\n\n/**\n * \n */\nprivate final float loadFactor;\n\n\n/**\n * ,GC\n */\nprivate final ReferenceQueue<Object> queue = new ReferenceQueue<>();\n\n\n/**\n * \n */\nint modCount;\n\n{% endcodeblock %}\n\n### ****\n\n- \n{% codeblock lang:java %}\npublic WeakHashMap(int initialCapacity, float loadFactor) {\n    if (initialCapacity < 0)\n        throw new IllegalArgumentException(\"Illegal Initial Capacity: \"+\n                                           initialCapacity);\n    if (initialCapacity > MAXIMUM_CAPACITY)\n        initialCapacity = MAXIMUM_CAPACITY;\n\n    if (loadFactor <= 0 || Float.isNaN(loadFactor))\n        throw new IllegalArgumentException(\"Illegal Load factor: \"+\n                                           loadFactor);\n    int capacity = 1;\n    while (capacity < initialCapacity)\n        capacity <<= 1;\n    table = newTable(capacity);\n    this.loadFactor = loadFactor;\n    threshold = (int)(capacity * loadFactor);\n}\n{% endcodeblock %}\n>,,threshold()\n\n- put\n{% codeblock lang:java %}\npublic V put(K key, V value) {\n    Object k = maskNull(key);\n    int h = hash(k);\n    Entry<K,V>[] tab = getTable();\n    int i = indexFor(h, tab.length);\n\n    for (Entry<K,V> e = tab[i]; e != null; e = e.next) {\n        if (h == e.hash && eq(k, e.get())) {\n            V oldValue = e.value;\n            if (value != oldValue)\n                e.value = value;\n            return oldValue;\n        }\n    }\n\n    modCount++;\n    Entry<K,V> e = tab[i];\n    tab[i] = new Entry<>(k, value, queue, h, e);\n    if (++size >= threshold)\n        resize(tab.length * 2);\n    return null;\n}\n{% endcodeblock %}\n>hash,hash,Entrykeykey\n\n\n- get\n{% codeblock lang:java %}\npublic V get(Object key) {\n    Object k = maskNull(key);\n    int h = hash(k);\n    Entry<K,V>[] tab = getTable();\n    int index = indexFor(h, tab.length);\n    Entry<K,V> e = tab[index];\n    while (e != null) {\n        if (e.hash == h && eq(k, e.get()))\n            return e.value;\n        e = e.next;\n    }\n    return null;\n}\n{% endcodeblock %}\n>put,keyhash,keyvalue\n\n\n- remove\n{% codeblock lang:java %}\npublic V remove(Object key) {\n    Object k = maskNull(key);\n    int h = hash(k);\n    Entry<K,V>[] tab = getTable();\n    int i = indexFor(h, tab.length);\n    Entry<K,V> prev = tab[i];\n    Entry<K,V> e = prev;\n\n    while (e != null) {\n        Entry<K,V> next = e.next;\n        if (h == e.hash && eq(k, e.get())) {\n            modCount++;\n            size--;\n            if (prev == e)\n                tab[i] = next;\n            else\n                prev.next = next;\n            return e.value;\n        }\n        prev = e;\n        e = next;\n    }\n\n    return null;\n}\n{% endcodeblock %}\n> keyhash,key,keyprev==e keyEntrytab[i]\n\n\n- Entry\n{% codeblock lang:java %}\nprivate static class Entry<K,V> extends WeakReference<Object> implements Map.Entry<K,V> {\n    V value;\n    final int hash;\n    Entry<K,V> next;\n\n    /**\n     * Creates new entry.\n     */\n    Entry(Object key, V value,\n          ReferenceQueue<Object> queue,\n          int hash, Entry<K,V> next) {\n        super(key, queue);\n        this.value = value;\n        this.hash  = hash;\n        this.next  = next;\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    public K getKey() {\n        return (K) WeakHashMap.unmaskNull(get());\n    }\n\n    public V getValue() {\n        return value;\n    }\n\n    public V setValue(V newValue) {\n        V oldValue = value;\n        value = newValue;\n        return oldValue;\n    }\n\n    public boolean equals(Object o) {\n        if (!(o instanceof Map.Entry))\n            return false;\n        Map.Entry<?,?> e = (Map.Entry<?,?>)o;\n        K k1 = getKey();\n        Object k2 = e.getKey();\n        if (k1 == k2 || (k1 != null && k1.equals(k2))) {\n            V v1 = getValue();\n            Object v2 = e.getValue();\n            if (v1 == v2 || (v1 != null && v1.equals(v2)))\n                return true;\n        }\n        return false;\n    }\n\n    public int hashCode() {\n        K k = getKey();\n        V v = getValue();\n        return Objects.hashCode(k) ^ Objects.hashCode(v);\n    }\n\n    public String toString() {\n        return getKey() + \"=\" + getValue();\n    }\n}\n{% endcodeblock %}\n> WeakHashMapEntry,weakhashmapweakhashMap\n\n\n### ****\n> WeakHashMaphashMap,hashWeakHashMapEntryweakHashMap\n> WeakHashMap,\n\n\n### ****\n> WeakHashMapkeynull,weakhashMapremove,\n\n{% codeblock lang:java %}\n@Test\npublic void testWeakHashMap(){\n\nWeakHashMap weakHashMap = new WeakHashMap();\nString a1 = \"a1\";\nString a2 = \"a2\";\nString a3 = new String(\"a3\");\nweakHashMap.put(a1 ,\"a1\");\nweakHashMap.put(a2, \"a2\");\nweakHashMap.put(a3, \"a3\");\nSystem.out.println(weakHashMap);\n\na3 = null;\nSystem.gc();\nSystem.out.println(weakHashMap);\n}\n{% endcodeblock %}\n> String a1 = \"a1\"  a1=null, weakHashMapa1a1a1GCweakHashMap","slug":"java-WeakHashMap","published":1,"updated":"2018-10-11T11:25:07.196Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6j000km9cg5dx8xiww","content":"<blockquote class=\"blockquote-center\"><p>WeakHashMap</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-WeakHashMap/map01.png\">\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-WeakHashMap/map02.png\">\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DEFAULT_INITIAL_CAPACITY = <span class=\"number\">16</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAXIMUM_CAPACITY = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *   0.75</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">float</span> DEFAULT_LOAD_FACTOR = <span class=\"number\">0.75f</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Entry</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Entry&lt;K,V&gt;[] table;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * (*)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> threshold;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">float</span> loadFactor;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ,GC</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReferenceQueue&lt;Object&gt; queue = <span class=\"keyword\">new</span> ReferenceQueue&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> modCount;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><ul>\n<li><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">WeakHashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity, <span class=\"keyword\">float</span> loadFactor)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal Initial Capacity: \"</span>+</span><br><span class=\"line\">                                           initialCapacity);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class=\"line\">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadFactor &lt;= <span class=\"number\">0</span> || Float.isNaN(loadFactor))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal Load factor: \"</span>+</span><br><span class=\"line\">                                           loadFactor);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> capacity = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (capacity &lt; initialCapacity)</span><br><span class=\"line\">        capacity &lt;&lt;= <span class=\"number\">1</span>;</span><br><span class=\"line\">    table = newTable(capacity);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.loadFactor = loadFactor;</span><br><span class=\"line\">    threshold = (<span class=\"keyword\">int</span>)(capacity * loadFactor);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,,threshold()</p>\n</blockquote>\n</li>\n<li><p>put</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = hash(k);</span><br><span class=\"line\">    Entry&lt;K,V&gt;[] tab = getTable();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = indexFor(h, tab.length);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Entry&lt;K,V&gt; e = tab[i]; e != <span class=\"keyword\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (h == e.hash &amp;&amp; eq(k, e.get())) &#123;</span><br><span class=\"line\">            V oldValue = e.value;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (value != oldValue)</span><br><span class=\"line\">                e.value = value;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    Entry&lt;K,V&gt; e = tab[i];</span><br><span class=\"line\">    tab[i] = <span class=\"keyword\">new</span> Entry&lt;&gt;(k, value, queue, h, e);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (++size &gt;= threshold)</span><br><span class=\"line\">        resize(tab.length * <span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>hash,hash,Entrykeykey</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>get<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = hash(k);</span><br><span class=\"line\">    Entry&lt;K,V&gt;[] tab = getTable();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> index = indexFor(h, tab.length);</span><br><span class=\"line\">    Entry&lt;K,V&gt; e = tab[index];</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (e != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e.hash == h &amp;&amp; eq(k, e.get()))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">        e = e.next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>put,keyhash,keyvalue</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>remove<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = hash(k);</span><br><span class=\"line\">    Entry&lt;K,V&gt;[] tab = getTable();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = indexFor(h, tab.length);</span><br><span class=\"line\">    Entry&lt;K,V&gt; prev = tab[i];</span><br><span class=\"line\">    Entry&lt;K,V&gt; e = prev;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (e != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        Entry&lt;K,V&gt; next = e.next;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (h == e.hash &amp;&amp; eq(k, e.get())) &#123;</span><br><span class=\"line\">            modCount++;</span><br><span class=\"line\">            size--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (prev == e)</span><br><span class=\"line\">                tab[i] = next;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                prev.next = next;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        prev = e;</span><br><span class=\"line\">        e = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>keyhash,key,keyprev==e keyEntrytab[i]</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>Entry<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">WeakReference</span>&lt;<span class=\"title\">Object</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> hash;</span><br><span class=\"line\">    Entry&lt;K,V&gt; next;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Creates new entry.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Entry(Object key, V value,</span><br><span class=\"line\">          ReferenceQueue&lt;Object&gt; queue,</span><br><span class=\"line\">          <span class=\"keyword\">int</span> hash, Entry&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(key, queue);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hash  = hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.next  = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> K <span class=\"title\">getKey</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (K) WeakHashMap.unmaskNull(get());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">getValue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">setValue</span><span class=\"params\">(V newValue)</span> </span>&#123;</span><br><span class=\"line\">        V oldValue = value;</span><br><span class=\"line\">        value = newValue;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(o <span class=\"keyword\">instanceof</span> Map.Entry))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class=\"line\">        K k1 = getKey();</span><br><span class=\"line\">        Object k2 = e.getKey();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (k1 == k2 || (k1 != <span class=\"keyword\">null</span> &amp;&amp; k1.equals(k2))) &#123;</span><br><span class=\"line\">            V v1 = getValue();</span><br><span class=\"line\">            Object v2 = e.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (v1 == v2 || (v1 != <span class=\"keyword\">null</span> &amp;&amp; v1.equals(v2)))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        K k = getKey();</span><br><span class=\"line\">        V v = getValue();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Objects.hashCode(k) ^ Objects.hashCode(v);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> getKey() + <span class=\"string\">\"=\"</span> + getValue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>WeakHashMapEntry,weakhashmapweakhashMap</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><blockquote>\n<p>WeakHashMaphashMap,hashWeakHashMapEntryweakHashMap<br>WeakHashMap,</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><blockquote>\n<p>WeakHashMapkeynull,weakhashMapremove,</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testWeakHashMap</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">WeakHashMap weakHashMap = <span class=\"keyword\">new</span> WeakHashMap();</span><br><span class=\"line\">String a1 = <span class=\"string\">\"a1\"</span>;</span><br><span class=\"line\">String a2 = <span class=\"string\">\"a2\"</span>;</span><br><span class=\"line\">String a3 = <span class=\"keyword\">new</span> String(<span class=\"string\">\"a3\"</span>);</span><br><span class=\"line\">weakHashMap.put(a1 ,<span class=\"string\">\"a1\"</span>);</span><br><span class=\"line\">weakHashMap.put(a2, <span class=\"string\">\"a2\"</span>);</span><br><span class=\"line\">weakHashMap.put(a3, <span class=\"string\">\"a3\"</span>);</span><br><span class=\"line\">System.out.println(weakHashMap);</span><br><span class=\"line\"></span><br><span class=\"line\">a3 = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">System.gc();</span><br><span class=\"line\">System.out.println(weakHashMap);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>String a1 = a1  a1=null, weakHashMapa1a1a1GCweakHashMap</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>WeakHashMap</p>\n</blockquote>","more":"<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-WeakHashMap/map01.png\">\n<h3 id=\"IdentityHashMap-\"><a href=\"#IdentityHashMap-\" class=\"headerlink\" title=\"IdentityHashMap \"></a><strong>IdentityHashMap </strong></h3><img src=\"http://qiniuyun.xanderxu.cn/static/images//java-WeakHashMap/map02.png\">\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DEFAULT_INITIAL_CAPACITY = <span class=\"number\">16</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAXIMUM_CAPACITY = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *   0.75</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">float</span> DEFAULT_LOAD_FACTOR = <span class=\"number\">0.75f</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Entry</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Entry&lt;K,V&gt;[] table;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * (*)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> threshold;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">float</span> loadFactor;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ,GC</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReferenceQueue&lt;Object&gt; queue = <span class=\"keyword\">new</span> ReferenceQueue&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> modCount;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><ul>\n<li><p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">WeakHashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity, <span class=\"keyword\">float</span> loadFactor)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal Initial Capacity: \"</span>+</span><br><span class=\"line\">                                           initialCapacity);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class=\"line\">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadFactor &lt;= <span class=\"number\">0</span> || Float.isNaN(loadFactor))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal Load factor: \"</span>+</span><br><span class=\"line\">                                           loadFactor);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> capacity = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (capacity &lt; initialCapacity)</span><br><span class=\"line\">        capacity &lt;&lt;= <span class=\"number\">1</span>;</span><br><span class=\"line\">    table = newTable(capacity);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.loadFactor = loadFactor;</span><br><span class=\"line\">    threshold = (<span class=\"keyword\">int</span>)(capacity * loadFactor);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>,,threshold()</p>\n</blockquote>\n</li>\n<li><p>put</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = hash(k);</span><br><span class=\"line\">    Entry&lt;K,V&gt;[] tab = getTable();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = indexFor(h, tab.length);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Entry&lt;K,V&gt; e = tab[i]; e != <span class=\"keyword\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (h == e.hash &amp;&amp; eq(k, e.get())) &#123;</span><br><span class=\"line\">            V oldValue = e.value;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (value != oldValue)</span><br><span class=\"line\">                e.value = value;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    Entry&lt;K,V&gt; e = tab[i];</span><br><span class=\"line\">    tab[i] = <span class=\"keyword\">new</span> Entry&lt;&gt;(k, value, queue, h, e);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (++size &gt;= threshold)</span><br><span class=\"line\">        resize(tab.length * <span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>hash,hash,Entrykeykey</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>get<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = hash(k);</span><br><span class=\"line\">    Entry&lt;K,V&gt;[] tab = getTable();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> index = indexFor(h, tab.length);</span><br><span class=\"line\">    Entry&lt;K,V&gt; e = tab[index];</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (e != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e.hash == h &amp;&amp; eq(k, e.get()))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">        e = e.next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>put,keyhash,keyvalue</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>remove<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Object k = maskNull(key);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h = hash(k);</span><br><span class=\"line\">    Entry&lt;K,V&gt;[] tab = getTable();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = indexFor(h, tab.length);</span><br><span class=\"line\">    Entry&lt;K,V&gt; prev = tab[i];</span><br><span class=\"line\">    Entry&lt;K,V&gt; e = prev;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (e != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        Entry&lt;K,V&gt; next = e.next;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (h == e.hash &amp;&amp; eq(k, e.get())) &#123;</span><br><span class=\"line\">            modCount++;</span><br><span class=\"line\">            size--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (prev == e)</span><br><span class=\"line\">                tab[i] = next;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                prev.next = next;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        prev = e;</span><br><span class=\"line\">        e = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>keyhash,key,keyprev==e keyEntrytab[i]</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>Entry<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">WeakReference</span>&lt;<span class=\"title\">Object</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> hash;</span><br><span class=\"line\">    Entry&lt;K,V&gt; next;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Creates new entry.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Entry(Object key, V value,</span><br><span class=\"line\">          ReferenceQueue&lt;Object&gt; queue,</span><br><span class=\"line\">          <span class=\"keyword\">int</span> hash, Entry&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(key, queue);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hash  = hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.next  = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> K <span class=\"title\">getKey</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (K) WeakHashMap.unmaskNull(get());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">getValue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">setValue</span><span class=\"params\">(V newValue)</span> </span>&#123;</span><br><span class=\"line\">        V oldValue = value;</span><br><span class=\"line\">        value = newValue;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(o <span class=\"keyword\">instanceof</span> Map.Entry))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class=\"line\">        K k1 = getKey();</span><br><span class=\"line\">        Object k2 = e.getKey();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (k1 == k2 || (k1 != <span class=\"keyword\">null</span> &amp;&amp; k1.equals(k2))) &#123;</span><br><span class=\"line\">            V v1 = getValue();</span><br><span class=\"line\">            Object v2 = e.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (v1 == v2 || (v1 != <span class=\"keyword\">null</span> &amp;&amp; v1.equals(v2)))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        K k = getKey();</span><br><span class=\"line\">        V v = getValue();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Objects.hashCode(k) ^ Objects.hashCode(v);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> getKey() + <span class=\"string\">\"=\"</span> + getValue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>WeakHashMapEntry,weakhashmapweakhashMap</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><blockquote>\n<p>WeakHashMaphashMap,hashWeakHashMapEntryweakHashMap<br>WeakHashMap,</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><blockquote>\n<p>WeakHashMapkeynull,weakhashMapremove,</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testWeakHashMap</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">WeakHashMap weakHashMap = <span class=\"keyword\">new</span> WeakHashMap();</span><br><span class=\"line\">String a1 = <span class=\"string\">\"a1\"</span>;</span><br><span class=\"line\">String a2 = <span class=\"string\">\"a2\"</span>;</span><br><span class=\"line\">String a3 = <span class=\"keyword\">new</span> String(<span class=\"string\">\"a3\"</span>);</span><br><span class=\"line\">weakHashMap.put(a1 ,<span class=\"string\">\"a1\"</span>);</span><br><span class=\"line\">weakHashMap.put(a2, <span class=\"string\">\"a2\"</span>);</span><br><span class=\"line\">weakHashMap.put(a3, <span class=\"string\">\"a3\"</span>);</span><br><span class=\"line\">System.out.println(weakHashMap);</span><br><span class=\"line\"></span><br><span class=\"line\">a3 = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">System.gc();</span><br><span class=\"line\">System.out.println(weakHashMap);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>String a1 = a1  a1=null, weakHashMapa1a1a1GCweakHashMap</p>\n</blockquote>"},{"title":"ThreadLocalExecutor","copyright":true,"date":"2018-08-12T12:33:00.000Z","_content":"\n{% cq %}\nBtraceThreadPoolExecutor\n{% endcq %}\n<!-- more -->\n\n### \n{% codeblock lang:java %}\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue<Runnable> workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler) {\n    if (corePoolSize < 0 ||\n        maximumPoolSize <= 0 ||\n        maximumPoolSize < corePoolSize ||\n        keepAliveTime < 0)\n        throw new IllegalArgumentException();\n    if (workQueue == null || threadFactory == null || handler == null)\n        throw new NullPointerException();\n    this.acc = System.getSecurityManager() == null ?\n            null :\n            AccessController.getContext();\n    this.corePoolSize = corePoolSize;\n    this.maximumPoolSize = maximumPoolSize;\n    this.workQueue = workQueue;\n    this.keepAliveTime = unit.toNanos(keepAliveTime);\n    this.threadFactory = threadFactory;\n    this.handler = handler;\n}\n{% endcodeblock %}\n- corePoolSize \n- maximumPoolSize \n- keepAliveTime \n- TimeUnit \n- BlockingQueue<Runnable> \n- ThreadFactory \n- RejectedExecutionHandler \n\n### \n{% codeblock lang:java %}\nprivate static final int COUNT_BITS = Integer.SIZE - 3;\nprivate static final int CAPACITY   = (1 << COUNT_BITS) - 1;\n\n// runState is stored in the high-order bits\nprivate static final int RUNNING    = -1 << COUNT_BITS;\nprivate static final int SHUTDOWN   =  0 << COUNT_BITS;\nprivate static final int STOP       =  1 << COUNT_BITS;\nprivate static final int TIDYING    =  2 << COUNT_BITS;\nprivate static final int TERMINATED =  3 << COUNT_BITS;\n\n// Packing and unpacking ctl\nprivate static int runStateOf(int c)     { return c & ~CAPACITY; }\nprivate static int workerCountOf(int c)  { return c & CAPACITY; }\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }\n{% endcodeblock %}\n> ThreadPoolExecutorInt3292^29-1\n- RUNNING -12911111....111111 << (29) 3111\n- SHUTDOWN 02900000.....000000 <<  (29) 3000\n- STOP 129000000.....00001 << (29) 3001\n- TIDYING 229000000...00002 << (29) 3002\n- TERMINATED 329000000...003 << (29) 3003\n- runStateOf \n- workerCountOf \n- ctlOf int\n\n### \n- 1.ThreadPoolExecutorexecute\n- 2.\n- 3.maximumPoolSize(RejectedExecutionHandler)\n\n### execute\n{% codeblock lang:java %}\npublic void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();\n    /*\n     * :\n     *\n     * 1.corepoolol\n     * addWorkerworkerCountfalse\n     *\n     * 2.()\n     * \n     *\n     * 3.\n     */\n    int c = ctl.get();\n    if (workerCountOf(c) < corePoolSize) {\n        if (addWorker(command, true))\n            return;\n        c = ctl.get();\n    }\n    if (isRunning(c) && workQueue.offer(command)) {\n        int recheck = ctl.get();\n        if (! isRunning(recheck) && remove(command))\n            reject(command);\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    else if (!addWorker(command, false))\n        reject(command);\n}\n{% endcodeblock %}\n> ():\n> 1.\n> 2.Running0\n> 3.\n\n### addWorker\n{% codeblock lang:java %}\nprivate boolean addWorker(Runnable firstTask, boolean core) {\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // Check if queue empty only if necessary.\n        if (rs >= SHUTDOWN &&\n            ! (rs == SHUTDOWN &&\n               firstTask == null &&\n               ! workQueue.isEmpty()))\n            return false;\n\n        for (;;) {\n            int wc = workerCountOf(c);\n            if (wc >= CAPACITY ||\n                wc >= (core ? corePoolSize : maximumPoolSize))\n                return false;\n            if (compareAndIncrementWorkerCount(c))\n                break retry;\n            c = ctl.get();  // Re-read ctl\n            if (runStateOf(c) != rs)\n                continue retry;\n            // else CAS failed due to workerCount change; retry inner loop\n        }\n    }\n\n    boolean workerStarted = false;\n    boolean workerAdded = false;\n    Worker w = null;\n    try {\n        w = new Worker(firstTask);\n        final Thread t = w.thread;\n        if (t != null) {\n            final ReentrantLock mainLock = this.mainLock;\n            mainLock.lock();\n            try {\n                // Recheck while holding lock.\n                // Back out on ThreadFactory failure or if\n                // shut down before lock acquired.\n                int rs = runStateOf(ctl.get());\n\n                if (rs < SHUTDOWN ||\n                    (rs == SHUTDOWN && firstTask == null)) {\n                    if (t.isAlive()) // precheck that t is startable\n                        throw new IllegalThreadStateException();\n                    workers.add(w);\n                    int s = workers.size();\n                    if (s > largestPoolSize)\n                        largestPoolSize = s;\n                    workerAdded = true;\n                }\n            } finally {\n                mainLock.unlock();\n            }\n            if (workerAdded) {\n                t.start();\n                workerStarted = true;\n            }\n        }\n    } finally {\n        if (! workerStarted)\n            addWorkerFailed(w);\n    }\n    return workerStarted;\n}\n{% endcodeblock %}\n\n- 1.\n- 2.\n- 3.WorkerWorkerAbstractQueuedSynchronizerRunnableWorkerAQS()\n- 4.\n- 5.,Runnablerun\n- 6.boolean\n\n\n### Shutdown\n{% codeblock lang:java %}\npublic void shutdown() {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        advanceRunState(SHUTDOWN);\n        interruptIdleWorkers();\n        onShutdown(); // hook for ScheduledThreadPoolExecutor\n    } finally {\n        mainLock.unlock();\n    }\n    tryTerminate();\n}\n{% endcodeblock %}\n\n- 1.\n- 2.SHUTDOWN\n- 3.()\n- 4.onShutdown() \n- 5.TERMINATED\n\n### \n> ThreadPoolExecutoraddWorker","source":"_posts/java-ThreadLocalExecutor.md","raw":"title: ThreadLocalExecutor\ncopyright: true\ntags:\n  - java\ncategories:\n  - java\ndate: 2018-08-12 20:33:00\n---\n\n{% cq %}\nBtraceThreadPoolExecutor\n{% endcq %}\n<!-- more -->\n\n### \n{% codeblock lang:java %}\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue<Runnable> workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler) {\n    if (corePoolSize < 0 ||\n        maximumPoolSize <= 0 ||\n        maximumPoolSize < corePoolSize ||\n        keepAliveTime < 0)\n        throw new IllegalArgumentException();\n    if (workQueue == null || threadFactory == null || handler == null)\n        throw new NullPointerException();\n    this.acc = System.getSecurityManager() == null ?\n            null :\n            AccessController.getContext();\n    this.corePoolSize = corePoolSize;\n    this.maximumPoolSize = maximumPoolSize;\n    this.workQueue = workQueue;\n    this.keepAliveTime = unit.toNanos(keepAliveTime);\n    this.threadFactory = threadFactory;\n    this.handler = handler;\n}\n{% endcodeblock %}\n- corePoolSize \n- maximumPoolSize \n- keepAliveTime \n- TimeUnit \n- BlockingQueue<Runnable> \n- ThreadFactory \n- RejectedExecutionHandler \n\n### \n{% codeblock lang:java %}\nprivate static final int COUNT_BITS = Integer.SIZE - 3;\nprivate static final int CAPACITY   = (1 << COUNT_BITS) - 1;\n\n// runState is stored in the high-order bits\nprivate static final int RUNNING    = -1 << COUNT_BITS;\nprivate static final int SHUTDOWN   =  0 << COUNT_BITS;\nprivate static final int STOP       =  1 << COUNT_BITS;\nprivate static final int TIDYING    =  2 << COUNT_BITS;\nprivate static final int TERMINATED =  3 << COUNT_BITS;\n\n// Packing and unpacking ctl\nprivate static int runStateOf(int c)     { return c & ~CAPACITY; }\nprivate static int workerCountOf(int c)  { return c & CAPACITY; }\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }\n{% endcodeblock %}\n> ThreadPoolExecutorInt3292^29-1\n- RUNNING -12911111....111111 << (29) 3111\n- SHUTDOWN 02900000.....000000 <<  (29) 3000\n- STOP 129000000.....00001 << (29) 3001\n- TIDYING 229000000...00002 << (29) 3002\n- TERMINATED 329000000...003 << (29) 3003\n- runStateOf \n- workerCountOf \n- ctlOf int\n\n### \n- 1.ThreadPoolExecutorexecute\n- 2.\n- 3.maximumPoolSize(RejectedExecutionHandler)\n\n### execute\n{% codeblock lang:java %}\npublic void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();\n    /*\n     * :\n     *\n     * 1.corepoolol\n     * addWorkerworkerCountfalse\n     *\n     * 2.()\n     * \n     *\n     * 3.\n     */\n    int c = ctl.get();\n    if (workerCountOf(c) < corePoolSize) {\n        if (addWorker(command, true))\n            return;\n        c = ctl.get();\n    }\n    if (isRunning(c) && workQueue.offer(command)) {\n        int recheck = ctl.get();\n        if (! isRunning(recheck) && remove(command))\n            reject(command);\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    else if (!addWorker(command, false))\n        reject(command);\n}\n{% endcodeblock %}\n> ():\n> 1.\n> 2.Running0\n> 3.\n\n### addWorker\n{% codeblock lang:java %}\nprivate boolean addWorker(Runnable firstTask, boolean core) {\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // Check if queue empty only if necessary.\n        if (rs >= SHUTDOWN &&\n            ! (rs == SHUTDOWN &&\n               firstTask == null &&\n               ! workQueue.isEmpty()))\n            return false;\n\n        for (;;) {\n            int wc = workerCountOf(c);\n            if (wc >= CAPACITY ||\n                wc >= (core ? corePoolSize : maximumPoolSize))\n                return false;\n            if (compareAndIncrementWorkerCount(c))\n                break retry;\n            c = ctl.get();  // Re-read ctl\n            if (runStateOf(c) != rs)\n                continue retry;\n            // else CAS failed due to workerCount change; retry inner loop\n        }\n    }\n\n    boolean workerStarted = false;\n    boolean workerAdded = false;\n    Worker w = null;\n    try {\n        w = new Worker(firstTask);\n        final Thread t = w.thread;\n        if (t != null) {\n            final ReentrantLock mainLock = this.mainLock;\n            mainLock.lock();\n            try {\n                // Recheck while holding lock.\n                // Back out on ThreadFactory failure or if\n                // shut down before lock acquired.\n                int rs = runStateOf(ctl.get());\n\n                if (rs < SHUTDOWN ||\n                    (rs == SHUTDOWN && firstTask == null)) {\n                    if (t.isAlive()) // precheck that t is startable\n                        throw new IllegalThreadStateException();\n                    workers.add(w);\n                    int s = workers.size();\n                    if (s > largestPoolSize)\n                        largestPoolSize = s;\n                    workerAdded = true;\n                }\n            } finally {\n                mainLock.unlock();\n            }\n            if (workerAdded) {\n                t.start();\n                workerStarted = true;\n            }\n        }\n    } finally {\n        if (! workerStarted)\n            addWorkerFailed(w);\n    }\n    return workerStarted;\n}\n{% endcodeblock %}\n\n- 1.\n- 2.\n- 3.WorkerWorkerAbstractQueuedSynchronizerRunnableWorkerAQS()\n- 4.\n- 5.,Runnablerun\n- 6.boolean\n\n\n### Shutdown\n{% codeblock lang:java %}\npublic void shutdown() {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        advanceRunState(SHUTDOWN);\n        interruptIdleWorkers();\n        onShutdown(); // hook for ScheduledThreadPoolExecutor\n    } finally {\n        mainLock.unlock();\n    }\n    tryTerminate();\n}\n{% endcodeblock %}\n\n- 1.\n- 2.SHUTDOWN\n- 3.()\n- 4.onShutdown() \n- 5.TERMINATED\n\n### \n> ThreadPoolExecutoraddWorker","slug":"java-ThreadLocalExecutor","published":1,"updated":"2018-10-11T10:51:22.124Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6l000pm9cgje7h1gox","content":"<blockquote class=\"blockquote-center\"><p>BtraceThreadPoolExecutor</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          <span class=\"keyword\">int</span> maximumPoolSize,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          <span class=\"keyword\">long</span> keepAliveTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          TimeUnit unit,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          ThreadFactory threadFactory,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (corePoolSize &lt; <span class=\"number\">0</span> ||</span><br><span class=\"line\">        maximumPoolSize &lt;= <span class=\"number\">0</span> ||</span><br><span class=\"line\">        maximumPoolSize &lt; corePoolSize ||</span><br><span class=\"line\">        keepAliveTime &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (workQueue == <span class=\"keyword\">null</span> || threadFactory == <span class=\"keyword\">null</span> || handler == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.acc = System.getSecurityManager() == <span class=\"keyword\">null</span> ?</span><br><span class=\"line\">            <span class=\"keyword\">null</span> :</span><br><span class=\"line\">            AccessController.getContext();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.corePoolSize = corePoolSize;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.workQueue = workQueue;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.threadFactory = threadFactory;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.handler = handler;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>corePoolSize </li>\n<li>maximumPoolSize </li>\n<li>keepAliveTime </li>\n<li>TimeUnit </li>\n<li>BlockingQueue<runnable> </runnable></li>\n<li>ThreadFactory </li>\n<li>RejectedExecutionHandler </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> COUNT_BITS = Integer.SIZE - <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CAPACITY   = (<span class=\"number\">1</span> &lt;&lt; COUNT_BITS) - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// runState is stored in the high-order bits</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> RUNNING    = -<span class=\"number\">1</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> SHUTDOWN   =  <span class=\"number\">0</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> STOP       =  <span class=\"number\">1</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> TIDYING    =  <span class=\"number\">2</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> TERMINATED =  <span class=\"number\">3</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Packing and unpacking ctl</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">runStateOf</span><span class=\"params\">(<span class=\"keyword\">int</span> c)</span>     </span>&#123; <span class=\"keyword\">return</span> c &amp; ~CAPACITY; &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">workerCountOf</span><span class=\"params\">(<span class=\"keyword\">int</span> c)</span>  </span>&#123; <span class=\"keyword\">return</span> c &amp; CAPACITY; &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">ctlOf</span><span class=\"params\">(<span class=\"keyword\">int</span> rs, <span class=\"keyword\">int</span> wc)</span> </span>&#123; <span class=\"keyword\">return</span> rs | wc; &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ThreadPoolExecutorInt3292^29-1</p>\n<ul>\n<li>RUNNING -12911111.111111 &lt;&lt; (29) 3111</li>\n<li>SHUTDOWN 02900000..000000 &lt;&lt;  (29) 3000</li>\n<li>STOP 129000000..00001 &lt;&lt; (29) 3001</li>\n<li>TIDYING 22900000000002 &lt;&lt; (29) 3002</li>\n<li>TERMINATED 329000000003 &lt;&lt; (29) 3003</li>\n<li>runStateOf </li>\n<li>workerCountOf </li>\n<li>ctlOf int</li>\n</ul>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li>1.ThreadPoolExecutorexecute</li>\n<li>2.</li>\n<li>3.maximumPoolSize(RejectedExecutionHandler)</li>\n</ul>\n<h3 id=\"execute\"><a href=\"#execute\" class=\"headerlink\" title=\"execute\"></a>execute</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable command)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (command == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * :</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.corepoolol</span></span><br><span class=\"line\"><span class=\"comment\">     * addWorkerworkerCountfalse</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.()</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> c = ctl.get();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (addWorker(command, <span class=\"keyword\">true</span>))</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        c = ctl.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> recheck = ctl.get();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class=\"line\">            reject(command);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (workerCountOf(recheck) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            addWorker(<span class=\"keyword\">null</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!addWorker(command, <span class=\"keyword\">false</span>))</span><br><span class=\"line\">        reject(command);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>():<br>1.<br>2.Running0<br>3.</p>\n</blockquote>\n<h3 id=\"addWorker\"><a href=\"#addWorker\" class=\"headerlink\" title=\"addWorker\"></a>addWorker</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">addWorker</span><span class=\"params\">(Runnable firstTask, <span class=\"keyword\">boolean</span> core)</span> </span>&#123;</span><br><span class=\"line\">    retry:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> c = ctl.get();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> rs = runStateOf(c);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Check if queue empty only if necessary.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class=\"line\">            ! (rs == SHUTDOWN &amp;&amp;</span><br><span class=\"line\">               firstTask == <span class=\"keyword\">null</span> &amp;&amp;</span><br><span class=\"line\">               ! workQueue.isEmpty()))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> wc = workerCountOf(c);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (wc &gt;= CAPACITY ||</span><br><span class=\"line\">                wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class=\"line\">                <span class=\"keyword\">break</span> retry;</span><br><span class=\"line\">            c = ctl.get();  <span class=\"comment\">// Re-read ctl</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (runStateOf(c) != rs)</span><br><span class=\"line\">                <span class=\"keyword\">continue</span> retry;</span><br><span class=\"line\">            <span class=\"comment\">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> workerStarted = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> workerAdded = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    Worker w = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        w = <span class=\"keyword\">new</span> Worker(firstTask);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Thread t = w.thread;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> ReentrantLock mainLock = <span class=\"keyword\">this</span>.mainLock;</span><br><span class=\"line\">            mainLock.lock();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Recheck while holding lock.</span></span><br><span class=\"line\">                <span class=\"comment\">// Back out on ThreadFactory failure or if</span></span><br><span class=\"line\">                <span class=\"comment\">// shut down before lock acquired.</span></span><br><span class=\"line\">                <span class=\"keyword\">int</span> rs = runStateOf(ctl.get());</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (rs &lt; SHUTDOWN ||</span><br><span class=\"line\">                    (rs == SHUTDOWN &amp;&amp; firstTask == <span class=\"keyword\">null</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (t.isAlive()) <span class=\"comment\">// precheck that t is startable</span></span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalThreadStateException();</span><br><span class=\"line\">                    workers.add(w);</span><br><span class=\"line\">                    <span class=\"keyword\">int</span> s = workers.size();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (s &gt; largestPoolSize)</span><br><span class=\"line\">                        largestPoolSize = s;</span><br><span class=\"line\">                    workerAdded = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                mainLock.unlock();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (workerAdded) &#123;</span><br><span class=\"line\">                t.start();</span><br><span class=\"line\">                workerStarted = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (! workerStarted)</span><br><span class=\"line\">            addWorkerFailed(w);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> workerStarted;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>1.</li>\n<li>2.</li>\n<li>3.WorkerWorkerAbstractQueuedSynchronizerRunnableWorkerAQS()</li>\n<li>4.</li>\n<li>5.,Runnablerun</li>\n<li>6.boolean</li>\n</ul>\n<h3 id=\"Shutdown\"><a href=\"#Shutdown\" class=\"headerlink\" title=\"Shutdown\"></a>Shutdown</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">shutdown</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> ReentrantLock mainLock = <span class=\"keyword\">this</span>.mainLock;</span><br><span class=\"line\">    mainLock.lock();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        checkShutdownAccess();</span><br><span class=\"line\">        advanceRunState(SHUTDOWN);</span><br><span class=\"line\">        interruptIdleWorkers();</span><br><span class=\"line\">        onShutdown(); <span class=\"comment\">// hook for ScheduledThreadPoolExecutor</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        mainLock.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    tryTerminate();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>1.</li>\n<li>2.SHUTDOWN</li>\n<li>3.()</li>\n<li>4.onShutdown() </li>\n<li>5.TERMINATED</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>ThreadPoolExecutoraddWorker</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>BtraceThreadPoolExecutor</p>\n</blockquote>","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          <span class=\"keyword\">int</span> maximumPoolSize,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          <span class=\"keyword\">long</span> keepAliveTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          TimeUnit unit,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          ThreadFactory threadFactory,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (corePoolSize &lt; <span class=\"number\">0</span> ||</span><br><span class=\"line\">        maximumPoolSize &lt;= <span class=\"number\">0</span> ||</span><br><span class=\"line\">        maximumPoolSize &lt; corePoolSize ||</span><br><span class=\"line\">        keepAliveTime &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (workQueue == <span class=\"keyword\">null</span> || threadFactory == <span class=\"keyword\">null</span> || handler == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.acc = System.getSecurityManager() == <span class=\"keyword\">null</span> ?</span><br><span class=\"line\">            <span class=\"keyword\">null</span> :</span><br><span class=\"line\">            AccessController.getContext();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.corePoolSize = corePoolSize;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.workQueue = workQueue;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.threadFactory = threadFactory;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.handler = handler;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>corePoolSize </li>\n<li>maximumPoolSize </li>\n<li>keepAliveTime </li>\n<li>TimeUnit </li>\n<li>BlockingQueue<runnable> </runnable></li>\n<li>ThreadFactory </li>\n<li>RejectedExecutionHandler </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> COUNT_BITS = Integer.SIZE - <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CAPACITY   = (<span class=\"number\">1</span> &lt;&lt; COUNT_BITS) - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// runState is stored in the high-order bits</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> RUNNING    = -<span class=\"number\">1</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> SHUTDOWN   =  <span class=\"number\">0</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> STOP       =  <span class=\"number\">1</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> TIDYING    =  <span class=\"number\">2</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> TERMINATED =  <span class=\"number\">3</span> &lt;&lt; COUNT_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Packing and unpacking ctl</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">runStateOf</span><span class=\"params\">(<span class=\"keyword\">int</span> c)</span>     </span>&#123; <span class=\"keyword\">return</span> c &amp; ~CAPACITY; &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">workerCountOf</span><span class=\"params\">(<span class=\"keyword\">int</span> c)</span>  </span>&#123; <span class=\"keyword\">return</span> c &amp; CAPACITY; &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">ctlOf</span><span class=\"params\">(<span class=\"keyword\">int</span> rs, <span class=\"keyword\">int</span> wc)</span> </span>&#123; <span class=\"keyword\">return</span> rs | wc; &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ThreadPoolExecutorInt3292^29-1</p>\n<ul>\n<li>RUNNING -12911111.111111 &lt;&lt; (29) 3111</li>\n<li>SHUTDOWN 02900000..000000 &lt;&lt;  (29) 3000</li>\n<li>STOP 129000000..00001 &lt;&lt; (29) 3001</li>\n<li>TIDYING 22900000000002 &lt;&lt; (29) 3002</li>\n<li>TERMINATED 329000000003 &lt;&lt; (29) 3003</li>\n<li>runStateOf </li>\n<li>workerCountOf </li>\n<li>ctlOf int</li>\n</ul>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li>1.ThreadPoolExecutorexecute</li>\n<li>2.</li>\n<li>3.maximumPoolSize(RejectedExecutionHandler)</li>\n</ul>\n<h3 id=\"execute\"><a href=\"#execute\" class=\"headerlink\" title=\"execute\"></a>execute</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable command)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (command == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * :</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.corepoolol</span></span><br><span class=\"line\"><span class=\"comment\">     * addWorkerworkerCountfalse</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.()</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> c = ctl.get();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (addWorker(command, <span class=\"keyword\">true</span>))</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        c = ctl.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> recheck = ctl.get();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class=\"line\">            reject(command);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (workerCountOf(recheck) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            addWorker(<span class=\"keyword\">null</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!addWorker(command, <span class=\"keyword\">false</span>))</span><br><span class=\"line\">        reject(command);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>():<br>1.<br>2.Running0<br>3.</p>\n</blockquote>\n<h3 id=\"addWorker\"><a href=\"#addWorker\" class=\"headerlink\" title=\"addWorker\"></a>addWorker</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">addWorker</span><span class=\"params\">(Runnable firstTask, <span class=\"keyword\">boolean</span> core)</span> </span>&#123;</span><br><span class=\"line\">    retry:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> c = ctl.get();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> rs = runStateOf(c);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Check if queue empty only if necessary.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class=\"line\">            ! (rs == SHUTDOWN &amp;&amp;</span><br><span class=\"line\">               firstTask == <span class=\"keyword\">null</span> &amp;&amp;</span><br><span class=\"line\">               ! workQueue.isEmpty()))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> wc = workerCountOf(c);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (wc &gt;= CAPACITY ||</span><br><span class=\"line\">                wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class=\"line\">                <span class=\"keyword\">break</span> retry;</span><br><span class=\"line\">            c = ctl.get();  <span class=\"comment\">// Re-read ctl</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (runStateOf(c) != rs)</span><br><span class=\"line\">                <span class=\"keyword\">continue</span> retry;</span><br><span class=\"line\">            <span class=\"comment\">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> workerStarted = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> workerAdded = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    Worker w = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        w = <span class=\"keyword\">new</span> Worker(firstTask);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Thread t = w.thread;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> ReentrantLock mainLock = <span class=\"keyword\">this</span>.mainLock;</span><br><span class=\"line\">            mainLock.lock();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Recheck while holding lock.</span></span><br><span class=\"line\">                <span class=\"comment\">// Back out on ThreadFactory failure or if</span></span><br><span class=\"line\">                <span class=\"comment\">// shut down before lock acquired.</span></span><br><span class=\"line\">                <span class=\"keyword\">int</span> rs = runStateOf(ctl.get());</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (rs &lt; SHUTDOWN ||</span><br><span class=\"line\">                    (rs == SHUTDOWN &amp;&amp; firstTask == <span class=\"keyword\">null</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (t.isAlive()) <span class=\"comment\">// precheck that t is startable</span></span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalThreadStateException();</span><br><span class=\"line\">                    workers.add(w);</span><br><span class=\"line\">                    <span class=\"keyword\">int</span> s = workers.size();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (s &gt; largestPoolSize)</span><br><span class=\"line\">                        largestPoolSize = s;</span><br><span class=\"line\">                    workerAdded = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                mainLock.unlock();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (workerAdded) &#123;</span><br><span class=\"line\">                t.start();</span><br><span class=\"line\">                workerStarted = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (! workerStarted)</span><br><span class=\"line\">            addWorkerFailed(w);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> workerStarted;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>1.</li>\n<li>2.</li>\n<li>3.WorkerWorkerAbstractQueuedSynchronizerRunnableWorkerAQS()</li>\n<li>4.</li>\n<li>5.,Runnablerun</li>\n<li>6.boolean</li>\n</ul>\n<h3 id=\"Shutdown\"><a href=\"#Shutdown\" class=\"headerlink\" title=\"Shutdown\"></a>Shutdown</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">shutdown</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> ReentrantLock mainLock = <span class=\"keyword\">this</span>.mainLock;</span><br><span class=\"line\">    mainLock.lock();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        checkShutdownAccess();</span><br><span class=\"line\">        advanceRunState(SHUTDOWN);</span><br><span class=\"line\">        interruptIdleWorkers();</span><br><span class=\"line\">        onShutdown(); <span class=\"comment\">// hook for ScheduledThreadPoolExecutor</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        mainLock.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    tryTerminate();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>1.</li>\n<li>2.SHUTDOWN</li>\n<li>3.()</li>\n<li>4.onShutdown() </li>\n<li>5.TERMINATED</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>ThreadPoolExecutoraddWorker</p>\n</blockquote>"},{"title":",EnumMap","date":"2018-04-22T15:49:25.000Z","copyright":true,"_content":"{% cq %}\nif elseEnumMap\n{% endcq %}\n\n<!-- more -->\n\n> (P2P)\n\n### \n{% codeblock lang:java %}\n/**\n * \n */\npublic enum StatusDefine {\n    SUCCESS,\n    FAILED,\n    DEALING,\n    UNKNOW;\n}\n{% endcodeblock %}\n\n### \n{% codeblock lang:java %}\n/**\n * \n */\npublic interface Action {\n    /**\n     * \n     */\n    public void convertStatus();\n}\n{% endcodeblock %}\n\n### \n{% codeblock lang:java %}\n\npublic enum StatusConvert{\n\n\n    /**  */\n    FAIL_TO_SUCCESS(StatusDefine.FAILED,StatusDefine.SUCCESS){\n        @Override\n        public void todoConvertStatus() {\n            doSomething(new Action() {\n                @Override\n                public void convertStatus() {\n                    System.out.println(\"->\");\n                }\n            });\n        }\n    },\n    DEALING_TO_SUCCESS(StatusDefine.DEALING,StatusDefine.SUCCESS){\n        @Override\n        public void todoConvertStatus() {\n            doSomething(new Action() {\n                @Override\n                public void convertStatus() {\n                    System.out.println(\"->\");\n                }\n            });\n        }\n    },\n    UNKNOWN_TO_SUCCESS(StatusDefine.UNKNOW,StatusDefine.SUCCESS){\n        @Override\n        public void todoConvertStatus() {\n            doSomething(new Action() {\n                @Override\n                public void convertStatus() {\n                    System.out.println(\"->\");\n                }\n            });\n        }\n    };\n\n    /**\n     * \n     */\n    public static final EnumMap<StatusDefine, EnumMap<StatusDefine, StatusConvert>> ALL_STATUS = new EnumMap<StatusDefine, EnumMap<StatusDefine, StatusConvert>>(StatusDefine.class);\n\n\n    /**\n     * \n     */\n    private StatusDefine start;\n    /**\n     * \n     */\n    private StatusDefine target;\n\n    /**\n     * ALL_STATUS\n     */\n    static {\n        for (StatusDefine statusDefine : StatusDefine.values()){\n            ALL_STATUS.put(statusDefine,new EnumMap<StatusDefine, StatusConvert>(StatusDefine.class));\n        }\n\n        for (StatusConvert statusConvert : StatusConvert.values()) {\n            ALL_STATUS.get(statusConvert.start).put(statusConvert.target, statusConvert);\n        }\n\n    }\n\n    StatusConvert(StatusDefine start, StatusDefine target) {\n        this.start = start;\n        this.target = target;\n    }\n\n    /**\n     * \n     */\n    abstract void todoConvertStatus();\n\n    /**\n     * \n     * @param action\n     */\n    protected void doSomething(Action action){\n        System.out.println(\"\");\n        action.convertStatus();\n        System.out.println(\"\");\n    }\n\n}\n{% endcodeblock %}\n\n### \n{% codeblock lang:java %}\npublic static void main(String[] args) {\n    StatusConvert.ALL_STATUS.get(StatusDefine.FAILED).get(StatusDefine.SUCCESS).todoConvertStatus()\n    System.out.println(\"***************\");\n    StatusConvert.DEALING_TO_SUCCESS.todoConvertStatus();\n}\n{% endcodeblock %}\n\n> \n\n### \n{% codeblock lang:java %}\n\n->\n\n***************\n\n->\n\n{% endcodeblock %}\n\n### \n\n> StatusDefine()\n\n\n### \n> \n\n\n\n\n\n\n","source":"_posts/java-stateMachine.md","raw":"---\ntitle: ,EnumMap\ndate: 2018-04-22 23:49:25\ncopyright: true\ntags:\n - java\ncategories:\n - java\n---\n{% cq %}\nif elseEnumMap\n{% endcq %}\n\n<!-- more -->\n\n> (P2P)\n\n### \n{% codeblock lang:java %}\n/**\n * \n */\npublic enum StatusDefine {\n    SUCCESS,\n    FAILED,\n    DEALING,\n    UNKNOW;\n}\n{% endcodeblock %}\n\n### \n{% codeblock lang:java %}\n/**\n * \n */\npublic interface Action {\n    /**\n     * \n     */\n    public void convertStatus();\n}\n{% endcodeblock %}\n\n### \n{% codeblock lang:java %}\n\npublic enum StatusConvert{\n\n\n    /**  */\n    FAIL_TO_SUCCESS(StatusDefine.FAILED,StatusDefine.SUCCESS){\n        @Override\n        public void todoConvertStatus() {\n            doSomething(new Action() {\n                @Override\n                public void convertStatus() {\n                    System.out.println(\"->\");\n                }\n            });\n        }\n    },\n    DEALING_TO_SUCCESS(StatusDefine.DEALING,StatusDefine.SUCCESS){\n        @Override\n        public void todoConvertStatus() {\n            doSomething(new Action() {\n                @Override\n                public void convertStatus() {\n                    System.out.println(\"->\");\n                }\n            });\n        }\n    },\n    UNKNOWN_TO_SUCCESS(StatusDefine.UNKNOW,StatusDefine.SUCCESS){\n        @Override\n        public void todoConvertStatus() {\n            doSomething(new Action() {\n                @Override\n                public void convertStatus() {\n                    System.out.println(\"->\");\n                }\n            });\n        }\n    };\n\n    /**\n     * \n     */\n    public static final EnumMap<StatusDefine, EnumMap<StatusDefine, StatusConvert>> ALL_STATUS = new EnumMap<StatusDefine, EnumMap<StatusDefine, StatusConvert>>(StatusDefine.class);\n\n\n    /**\n     * \n     */\n    private StatusDefine start;\n    /**\n     * \n     */\n    private StatusDefine target;\n\n    /**\n     * ALL_STATUS\n     */\n    static {\n        for (StatusDefine statusDefine : StatusDefine.values()){\n            ALL_STATUS.put(statusDefine,new EnumMap<StatusDefine, StatusConvert>(StatusDefine.class));\n        }\n\n        for (StatusConvert statusConvert : StatusConvert.values()) {\n            ALL_STATUS.get(statusConvert.start).put(statusConvert.target, statusConvert);\n        }\n\n    }\n\n    StatusConvert(StatusDefine start, StatusDefine target) {\n        this.start = start;\n        this.target = target;\n    }\n\n    /**\n     * \n     */\n    abstract void todoConvertStatus();\n\n    /**\n     * \n     * @param action\n     */\n    protected void doSomething(Action action){\n        System.out.println(\"\");\n        action.convertStatus();\n        System.out.println(\"\");\n    }\n\n}\n{% endcodeblock %}\n\n### \n{% codeblock lang:java %}\npublic static void main(String[] args) {\n    StatusConvert.ALL_STATUS.get(StatusDefine.FAILED).get(StatusDefine.SUCCESS).todoConvertStatus()\n    System.out.println(\"***************\");\n    StatusConvert.DEALING_TO_SUCCESS.todoConvertStatus();\n}\n{% endcodeblock %}\n\n> \n\n### \n{% codeblock lang:java %}\n\n->\n\n***************\n\n->\n\n{% endcodeblock %}\n\n### \n\n> StatusDefine()\n\n\n### \n> \n\n\n\n\n\n\n","slug":"java-stateMachine","published":1,"updated":"2018-08-12T08:44:32.083Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6m000sm9cgj3wa635j","content":"<blockquote class=\"blockquote-center\"><p>if elseEnumMap</p>\n</blockquote>\n<a id=\"more\"></a>\n<blockquote>\n<p>(P2P)</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> StatusDefine &#123;</span><br><span class=\"line\">    SUCCESS,</span><br><span class=\"line\">    FAILED,</span><br><span class=\"line\">    DEALING,</span><br><span class=\"line\">    UNKNOW;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Action</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> StatusConvert&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**  */</span></span><br><span class=\"line\">    FAIL_TO_SUCCESS(StatusDefine.FAILED,StatusDefine.SUCCESS)&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            doSomething(<span class=\"keyword\">new</span> Action() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"-&gt;\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    DEALING_TO_SUCCESS(StatusDefine.DEALING,StatusDefine.SUCCESS)&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            doSomething(<span class=\"keyword\">new</span> Action() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"-&gt;\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    UNKNOWN_TO_SUCCESS(StatusDefine.UNKNOW,StatusDefine.SUCCESS)&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            doSomething(<span class=\"keyword\">new</span> Action() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"-&gt;\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> EnumMap&lt;StatusDefine, EnumMap&lt;StatusDefine, StatusConvert&gt;&gt; ALL_STATUS = <span class=\"keyword\">new</span> EnumMap&lt;StatusDefine, EnumMap&lt;StatusDefine, StatusConvert&gt;&gt;(StatusDefine.class);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> StatusDefine start;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> StatusDefine target;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ALL_STATUS</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (StatusDefine statusDefine : StatusDefine.values())&#123;</span><br><span class=\"line\">            ALL_STATUS.put(statusDefine,<span class=\"keyword\">new</span> EnumMap&lt;StatusDefine, StatusConvert&gt;(StatusDefine.class));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (StatusConvert statusConvert : StatusConvert.values()) &#123;</span><br><span class=\"line\">            ALL_STATUS.get(statusConvert.start).put(statusConvert.target, statusConvert);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    StatusConvert(StatusDefine start, StatusDefine target) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.start = start;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.target = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> action</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">(Action action)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">        action.convertStatus();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    StatusConvert.ALL_STATUS.get(StatusDefine.FAILED).get(StatusDefine.SUCCESS).todoConvertStatus()</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"***************\"</span>);</span><br><span class=\"line\">    StatusConvert.DEALING_TO_SUCCESS.todoConvertStatus();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">***************</span><br><span class=\"line\"></span><br><span class=\"line\">-&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>StatusDefine()</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>if elseEnumMap</p>\n</blockquote>","more":"<blockquote>\n<p>(P2P)</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> StatusDefine &#123;</span><br><span class=\"line\">    SUCCESS,</span><br><span class=\"line\">    FAILED,</span><br><span class=\"line\">    DEALING,</span><br><span class=\"line\">    UNKNOW;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Action</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> StatusConvert&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**  */</span></span><br><span class=\"line\">    FAIL_TO_SUCCESS(StatusDefine.FAILED,StatusDefine.SUCCESS)&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            doSomething(<span class=\"keyword\">new</span> Action() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"-&gt;\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    DEALING_TO_SUCCESS(StatusDefine.DEALING,StatusDefine.SUCCESS)&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            doSomething(<span class=\"keyword\">new</span> Action() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"-&gt;\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    UNKNOWN_TO_SUCCESS(StatusDefine.UNKNOW,StatusDefine.SUCCESS)&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            doSomething(<span class=\"keyword\">new</span> Action() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">convertStatus</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"-&gt;\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> EnumMap&lt;StatusDefine, EnumMap&lt;StatusDefine, StatusConvert&gt;&gt; ALL_STATUS = <span class=\"keyword\">new</span> EnumMap&lt;StatusDefine, EnumMap&lt;StatusDefine, StatusConvert&gt;&gt;(StatusDefine.class);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> StatusDefine start;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> StatusDefine target;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ALL_STATUS</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (StatusDefine statusDefine : StatusDefine.values())&#123;</span><br><span class=\"line\">            ALL_STATUS.put(statusDefine,<span class=\"keyword\">new</span> EnumMap&lt;StatusDefine, StatusConvert&gt;(StatusDefine.class));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (StatusConvert statusConvert : StatusConvert.values()) &#123;</span><br><span class=\"line\">            ALL_STATUS.get(statusConvert.start).put(statusConvert.target, statusConvert);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    StatusConvert(StatusDefine start, StatusDefine target) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.start = start;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.target = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">todoConvertStatus</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> action</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">(Action action)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">        action.convertStatus();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    StatusConvert.ALL_STATUS.get(StatusDefine.FAILED).get(StatusDefine.SUCCESS).todoConvertStatus()</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"***************\"</span>);</span><br><span class=\"line\">    StatusConvert.DEALING_TO_SUCCESS.todoConvertStatus();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">***************</span><br><span class=\"line\"></span><br><span class=\"line\">-&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>StatusDefine()</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p></p>\n</blockquote>"},{"title":"springIOC","date":"2018-08-20T07:20:06.000Z","copyright":true,"_content":"\n{% cq %} \nSpringIOC\n{% endcq %}\n<!-- more -->\n\n### \n<https://javadoop.com/post/spring-ioc#profile>\n\n>beanSpringSpringIOC\n\n### \n\n#### \n> Springjava \n- Springidname\n-  Bean \n- ConversionService\n- BeanPostProcessor ","source":"_posts/spring-IOC.md","raw":"---\ntitle: springIOC\ndate: 2018-08-20 15:20:06\ncopyright: true\ntags:\n - spring\ncategories:\n - spring\n---\n\n{% cq %} \nSpringIOC\n{% endcq %}\n<!-- more -->\n\n### \n<https://javadoop.com/post/spring-ioc#profile>\n\n>beanSpringSpringIOC\n\n### \n\n#### \n> Springjava \n- Springidname\n-  Bean \n- ConversionService\n- BeanPostProcessor ","slug":"spring-IOC","published":1,"updated":"2018-08-20T08:29:30.571Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjottiq6n000vm9cglrthaeyj","content":"<blockquote class=\"blockquote-center\"><p>SpringIOC</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://javadoop.com/post/spring-ioc#profile\" target=\"_blank\" rel=\"noopener\">https://javadoop.com/post/spring-ioc#profile</a></p>\n<blockquote>\n<p>beanSpringSpringIOC</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><blockquote>\n<p>Springjava </p>\n<ul>\n<li>Springidname</li>\n<li> Bean </li>\n<li>ConversionService</li>\n<li>BeanPostProcessor </li>\n</ul>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote class=\"blockquote-center\"><p>SpringIOC</p>\n</blockquote>","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://javadoop.com/post/spring-ioc#profile\" target=\"_blank\" rel=\"noopener\">https://javadoop.com/post/spring-ioc#profile</a></p>\n<blockquote>\n<p>beanSpringSpringIOC</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><blockquote>\n<p>Springjava </p>\n<ul>\n<li>Springidname</li>\n<li> Bean </li>\n<li>ConversionService</li>\n<li>BeanPostProcessor </li>\n</ul>\n</blockquote>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjottiq270000m9cg0scxozmf","category_id":"cjottiq2b0001m9cgyjs8ylfl","_id":"cjottiq2e0004m9cgtvz2bx1a"},{"post_id":"cjottiq6c000dm9cgfml9vzv9","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6k000lm9cge4asuht9"},{"post_id":"cjottiq640005m9cgv0g9t37g","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6m000qm9cgbv8ppj38"},{"post_id":"cjottiq6d000em9cg63zpfq9k","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6n000tm9cgmxhhxjnb"},{"post_id":"cjottiq6h000im9cg1ma43fkw","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6o000wm9cge5mhrclm"},{"post_id":"cjottiq660007m9cgikhbckhz","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6o000ym9cgubww21nl"},{"post_id":"cjottiq6j000km9cg5dx8xiww","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6p0012m9cg2vgaca9q"},{"post_id":"cjottiq6l000pm9cgje7h1gox","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6p0014m9cgh1a084a9"},{"post_id":"cjottiq6a000bm9cgwr7g808t","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6q0016m9cg00uguhbd"},{"post_id":"cjottiq6m000sm9cgj3wa635j","category_id":"cjottiq690009m9cg80vrs96h","_id":"cjottiq6r0018m9cg32k75xl9"},{"post_id":"cjottiq6n000vm9cglrthaeyj","category_id":"cjottiq6p000zm9cgp2tw77e2","_id":"cjottiq6r0019m9cgc3kwqgti"}],"PostTag":[{"post_id":"cjottiq270000m9cg0scxozmf","tag_id":"cjottiq2c0002m9cgzii52a5r","_id":"cjottiq2d0003m9cgc795oo73"},{"post_id":"cjottiq6c000dm9cgfml9vzv9","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6h000hm9cg0usnbvuj"},{"post_id":"cjottiq640005m9cgv0g9t37g","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6j000jm9cgqp8500n9"},{"post_id":"cjottiq6d000em9cg63zpfq9k","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6l000om9cgmlg4nhp4"},{"post_id":"cjottiq6h000im9cg1ma43fkw","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6m000rm9cg47ovaiaj"},{"post_id":"cjottiq660007m9cgikhbckhz","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6n000um9cgzsp9lob9"},{"post_id":"cjottiq6j000km9cg5dx8xiww","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6o000xm9cggcmg7uuz"},{"post_id":"cjottiq6l000pm9cgje7h1gox","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6p0011m9cgjo36dnb1"},{"post_id":"cjottiq6a000bm9cgwr7g808t","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6p0013m9cgkxx92mcn"},{"post_id":"cjottiq6m000sm9cgj3wa635j","tag_id":"cjottiq69000am9cgco8xtrm2","_id":"cjottiq6q0015m9cgmouxr0ol"},{"post_id":"cjottiq6n000vm9cglrthaeyj","tag_id":"cjottiq6p0010m9cgogt1p0dl","_id":"cjottiq6q0017m9cgktvn2r43"}],"Tag":[{"name":"dataStructure","_id":"cjottiq2c0002m9cgzii52a5r"},{"name":"java","_id":"cjottiq69000am9cgco8xtrm2"},{"name":"spring","_id":"cjottiq6p0010m9cgogt1p0dl"}]}}